/*
 Navicat Premium Data Transfer

 Source Server         : local
 Source Server Type    : MySQL
 Source Server Version : 50732
 Source Host           : localhost:3306
 Source Schema         : forum

 Target Server Type    : MySQL
 Target Server Version : 50732
 File Encoding         : 65001

 Date: 03/05/2021 20:09:37
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for tb_admin_login_info
-- ----------------------------
DROP TABLE IF EXISTS `tb_admin_login_info`;
CREATE TABLE `tb_admin_login_info`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增ID',
  `ip` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT 'ip地址信息',
  `info` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '获取得到的地址信息',
  `time` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '登录时间',
  PRIMARY KEY (`id`, `ip`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 42 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_admin_login_info
-- ----------------------------
INSERT INTO `tb_admin_login_info` VALUES (1, '122.7.216.221', '暂无详细地址信息', '2021-03-18 10:40');
INSERT INTO `tb_admin_login_info` VALUES (2, '122.7.216.221', '暂无详细地址信息', '2021-03-18 14:04');
INSERT INTO `tb_admin_login_info` VALUES (3, '122.7.216.221', '暂无详细地址信息', '2021-03-18 14:45');
INSERT INTO `tb_admin_login_info` VALUES (4, '122.7.216.221', '暂无详细地址信息', '2021-03-18 16:54');
INSERT INTO `tb_admin_login_info` VALUES (5, '122.7.216.221', '暂无详细地址信息', '2021-03-18 20:11');
INSERT INTO `tb_admin_login_info` VALUES (6, '122.7.216.221', '暂无详细地址信息', '2021-03-18 21:55');
INSERT INTO `tb_admin_login_info` VALUES (7, '122.7.216.221', '暂无详细地址信息', '2021-03-22 13:11');
INSERT INTO `tb_admin_login_info` VALUES (8, '47.93.222.107', '暂无详细地址信息', '2021-03-24 20:11');
INSERT INTO `tb_admin_login_info` VALUES (9, '47.93.222.107', '暂无详细地址信息', '2021-03-24 21:21');
INSERT INTO `tb_admin_login_info` VALUES (10, '47.93.222.107', '暂无详细地址信息', '2021-03-25 00:07');
INSERT INTO `tb_admin_login_info` VALUES (11, '47.93.222.107', '暂无详细地址信息', '2021-04-09 09:40');
INSERT INTO `tb_admin_login_info` VALUES (12, '47.93.222.107', '暂无详细地址信息', '2021-04-09 09:59');
INSERT INTO `tb_admin_login_info` VALUES (13, '47.93.222.107', '暂无详细地址信息', '2021-04-09 10:27');
INSERT INTO `tb_admin_login_info` VALUES (14, '47.93.222.107', '暂无详细地址信息', '2021-04-09 10:31');
INSERT INTO `tb_admin_login_info` VALUES (15, '47.93.222.107', '暂无详细地址信息', '2021-04-24 14:55');
INSERT INTO `tb_admin_login_info` VALUES (16, '47.93.222.107', '暂无详细地址信息', '2021-04-24 15:58');
INSERT INTO `tb_admin_login_info` VALUES (17, '47.93.222.107', '暂无详细地址信息', '2021-04-24 16:56');
INSERT INTO `tb_admin_login_info` VALUES (18, '47.93.222.107', '暂无详细地址信息', '2021-04-26 13:55');
INSERT INTO `tb_admin_login_info` VALUES (19, '47.93.222.107', '暂无详细地址信息', '2021-04-27 08:28');
INSERT INTO `tb_admin_login_info` VALUES (20, '122.7.216.221', '暂无详细地址信息', '2021-04-27 17:06');
INSERT INTO `tb_admin_login_info` VALUES (21, '122.7.216.221', '暂无详细地址信息', '2021-04-27 18:36');
INSERT INTO `tb_admin_login_info` VALUES (22, '122.7.216.221', '暂无详细地址信息', '2021-04-27 20:57');
INSERT INTO `tb_admin_login_info` VALUES (23, '122.7.216.221', '暂无详细地址信息', '2021-04-27 21:19');
INSERT INTO `tb_admin_login_info` VALUES (24, '122.7.216.221', '暂无详细地址信息', '2021-04-27 21:25');
INSERT INTO `tb_admin_login_info` VALUES (25, '122.7.216.221', '暂无详细地址信息', '2021-04-27 21:29');
INSERT INTO `tb_admin_login_info` VALUES (26, '122.7.216.221', '暂无详细地址信息', '2021-04-28 19:53');
INSERT INTO `tb_admin_login_info` VALUES (27, '122.7.216.221', '暂无详细地址信息', '2021-04-28 20:08');
INSERT INTO `tb_admin_login_info` VALUES (28, '47.93.222.107', '暂无详细地址信息', '2021-04-29 11:53');
INSERT INTO `tb_admin_login_info` VALUES (29, '122.7.216.221', '暂无详细地址信息', '2021-04-30 09:53');
INSERT INTO `tb_admin_login_info` VALUES (30, '122.7.216.221', '暂无详细地址信息', '2021-04-30 15:55');
INSERT INTO `tb_admin_login_info` VALUES (31, '122.7.216.221', '暂无详细地址信息', '2021-04-30 16:18');
INSERT INTO `tb_admin_login_info` VALUES (32, '122.7.216.221', '暂无详细地址信息', '2021-04-30 16:31');
INSERT INTO `tb_admin_login_info` VALUES (33, '47.93.222.107', '暂无详细地址信息', '2021-04-30 16:41');
INSERT INTO `tb_admin_login_info` VALUES (34, '47.93.222.107', '暂无详细地址信息', '2021-04-30 22:50');
INSERT INTO `tb_admin_login_info` VALUES (35, '122.7.216.221', '暂无详细地址信息', '2021-04-30 23:15');
INSERT INTO `tb_admin_login_info` VALUES (36, '122.7.216.221', '暂无详细地址信息', '2021-05-01 00:05');
INSERT INTO `tb_admin_login_info` VALUES (37, '122.7.216.221', '暂无详细地址信息', '2021-05-01 00:06');
INSERT INTO `tb_admin_login_info` VALUES (38, '122.7.216.221', '暂无详细地址信息', '2021-05-01 02:38');
INSERT INTO `tb_admin_login_info` VALUES (39, '122.7.216.221', '暂无详细地址信息', '2021-05-01 12:28');
INSERT INTO `tb_admin_login_info` VALUES (40, '122.7.216.221', '暂无详细地址信息', '2021-05-01 12:32');
INSERT INTO `tb_admin_login_info` VALUES (41, '153.118.98.31', '暂无详细地址信息', '2021-05-02 16:17');

-- ----------------------------
-- Table structure for tb_categories
-- ----------------------------
DROP TABLE IF EXISTS `tb_categories`;
CREATE TABLE `tb_categories`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `category` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '分类名',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 7 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_categories
-- ----------------------------
INSERT INTO `tb_categories` VALUES (1, '开发语言');
INSERT INTO `tb_categories` VALUES (2, '平台框架');
INSERT INTO `tb_categories` VALUES (3, '服务器');
INSERT INTO `tb_categories` VALUES (4, '数据库');
INSERT INTO `tb_categories` VALUES (5, '开发工具');
INSERT INTO `tb_categories` VALUES (6, '其它');

-- ----------------------------
-- Table structure for tb_category_tag
-- ----------------------------
DROP TABLE IF EXISTS `tb_category_tag`;
CREATE TABLE `tb_category_tag`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增ID',
  `category_id` int(11) NOT NULL COMMENT '分类ID',
  `tag_id` int(11) NULL DEFAULT NULL COMMENT '标签ID',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 29 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_category_tag
-- ----------------------------
INSERT INTO `tb_category_tag` VALUES (1, 1, 1);
INSERT INTO `tb_category_tag` VALUES (2, 1, 2);
INSERT INTO `tb_category_tag` VALUES (3, 1, 3);
INSERT INTO `tb_category_tag` VALUES (4, 1, 4);
INSERT INTO `tb_category_tag` VALUES (5, 1, 5);
INSERT INTO `tb_category_tag` VALUES (6, 1, 6);
INSERT INTO `tb_category_tag` VALUES (7, 2, 7);
INSERT INTO `tb_category_tag` VALUES (8, 2, 9);
INSERT INTO `tb_category_tag` VALUES (9, 2, 8);
INSERT INTO `tb_category_tag` VALUES (10, 2, 10);
INSERT INTO `tb_category_tag` VALUES (11, 2, 11);
INSERT INTO `tb_category_tag` VALUES (12, 2, 12);
INSERT INTO `tb_category_tag` VALUES (13, 3, 13);
INSERT INTO `tb_category_tag` VALUES (14, 3, 14);
INSERT INTO `tb_category_tag` VALUES (15, 3, 15);
INSERT INTO `tb_category_tag` VALUES (16, 4, 16);
INSERT INTO `tb_category_tag` VALUES (17, 4, 17);
INSERT INTO `tb_category_tag` VALUES (18, 4, 18);
INSERT INTO `tb_category_tag` VALUES (19, 4, 19);
INSERT INTO `tb_category_tag` VALUES (20, 4, 20);
INSERT INTO `tb_category_tag` VALUES (21, 4, 21);
INSERT INTO `tb_category_tag` VALUES (22, 5, 22);
INSERT INTO `tb_category_tag` VALUES (23, 5, 23);
INSERT INTO `tb_category_tag` VALUES (24, 5, 24);
INSERT INTO `tb_category_tag` VALUES (25, 5, 25);
INSERT INTO `tb_category_tag` VALUES (26, 5, 26);
INSERT INTO `tb_category_tag` VALUES (27, 5, 27);
INSERT INTO `tb_category_tag` VALUES (28, 5, 28);

-- ----------------------------
-- Table structure for tb_collection
-- ----------------------------
DROP TABLE IF EXISTS `tb_collection`;
CREATE TABLE `tb_collection`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增ID',
  `u_id` int(11) NOT NULL COMMENT '收藏者Id',
  `question_id` int(11) NOT NULL COMMENT '收藏的问题ID',
  `publisher_id` int(11) NOT NULL COMMENT '发帖者ID',
  `time` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '收藏时间',
  `status` int(2) NOT NULL COMMENT '收藏状态',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 5 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_collection
-- ----------------------------
INSERT INTO `tb_collection` VALUES (1, 2, 1, 1, '2021-03-18 11:05', 1);
INSERT INTO `tb_collection` VALUES (2, 11, 36, 10, '2021-03-24 20:42', 0);
INSERT INTO `tb_collection` VALUES (3, 1, 34, 3, '2021-04-24 15:45', 1);
INSERT INTO `tb_collection` VALUES (4, 1, 81, 2, '2021-05-02 16:58', 1);

-- ----------------------------
-- Table structure for tb_comment
-- ----------------------------
DROP TABLE IF EXISTS `tb_comment`;
CREATE TABLE `tb_comment`  (
  `c_id` int(20) NOT NULL AUTO_INCREMENT COMMENT '评论ID',
  `comment` text CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '评论内容',
  `time` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '评论时间',
  `uid` int(11) NOT NULL COMMENT '评论者ID',
  `question_id` int(11) NOT NULL COMMENT '评论对应的问题ID',
  PRIMARY KEY (`c_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 15 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_comment
-- ----------------------------
INSERT INTO `tb_comment` VALUES (1, '写的真好<img src=\"http://localhost:8888/static/assets/libs/layui/images/face/39.gif\" alt=\"[鼓掌]\">', '2021-03-18 11:05', 2, 1);
INSERT INTO `tb_comment` VALUES (2, '怎么样？？？？', '2021-03-18 12:35', 1, 1);
INSERT INTO `tb_comment` VALUES (3, '好文，收获颇多！！！', '2021-03-18 14:32', 3, 2);
INSERT INTO `tb_comment` VALUES (4, 'test', '2021-03-22 13:01', 1, 2);
INSERT INTO `tb_comment` VALUES (5, '你走吧', '2021-03-24 20:42', 11, 36);
INSERT INTO `tb_comment` VALUES (6, '你走吧', '2021-03-24 20:42', 11, 36);
INSERT INTO `tb_comment` VALUES (7, '说得好<img src=\"http://abiao.me:8888/static/assets/libs/layui/images/face/37.gif\" alt=\"[色]\">', '2021-03-24 21:23', 1, 35);
INSERT INTO `tb_comment` VALUES (8, '好强，这就是大佬吗', '2021-03-25 20:27', 13, 2);
INSERT INTO `tb_comment` VALUES (9, '<img src=\"http://abiao.me:8888/static/assets/libs/layui/images/face/1.gif\" alt=\"[嘻嘻]\">&nbsp;写的很好', '2021-04-24 16:09', 1, 2);
INSERT INTO `tb_comment` VALUES (10, '<p><img src=\"http://abiao.me:6688/image/2021/04/25/gqRI0o5ic.png\" alt=\"imagesFile-1619339908180\">带图片的测试</p>', '2021-04-25 16:48', 2, 84);
INSERT INTO `tb_comment` VALUES (11, '正常评论', '2021-04-26 08:23', 2, 84);
INSERT INTO `tb_comment` VALUES (12, '1', '2021-04-26 08:24', 2, 84);
INSERT INTO `tb_comment` VALUES (13, '我是评论', '2021-05-01 01:59', 1, 90);
INSERT INTO `tb_comment` VALUES (14, '测试评论，', '2021-05-01 02:17', 1, 90);

-- ----------------------------
-- Table structure for tb_comment_like
-- ----------------------------
DROP TABLE IF EXISTS `tb_comment_like`;
CREATE TABLE `tb_comment_like`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增ID',
  `comment_id` int(11) NOT NULL COMMENT '评论ID',
  `comment_uid` int(11) NOT NULL COMMENT '评论者ID',
  `like_id` int(11) NOT NULL COMMENT '点赞者ID',
  `time` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '点赞时间',
  `status` int(1) NOT NULL DEFAULT 0 COMMENT '点赞状态 0-未点赞 1-已点赞',
  `question_id` int(11) NOT NULL COMMENT '关联的问题ID',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 3 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_comment_like
-- ----------------------------
INSERT INTO `tb_comment_like` VALUES (1, 2, 1, 2, '2021-03-18 12:35', 1, 1);
INSERT INTO `tb_comment_like` VALUES (2, 3, 3, 1, '2021-03-22 13:00', 1, 2);

-- ----------------------------
-- Table structure for tb_comment_notice
-- ----------------------------
DROP TABLE IF EXISTS `tb_comment_notice`;
CREATE TABLE `tb_comment_notice`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增主键ID',
  `parent_comment_id` int(11) NOT NULL COMMENT '父评论ID',
  `comment_id` int(11) NOT NULL COMMENT '回复者ID',
  `notice_id` int(11) NOT NULL COMMENT '被回复者ID',
  `content` text CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '回复内容',
  `time` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '回复时间',
  `question_id` int(11) NOT NULL COMMENT '关联的问题ID',
  `status` int(2) NOT NULL DEFAULT 0 COMMENT '是否被阅读过，0-未读，1-已读',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 21 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_comment_notice
-- ----------------------------
INSERT INTO `tb_comment_notice` VALUES (1, 1, 2, 1, '写的真好<img src=\"http://localhost:8888/static/assets/libs/layui/images/face/39.gif\" alt=\"[鼓掌]\">', '2021-03-18 11:05', 1, 0);
INSERT INTO `tb_comment_notice` VALUES (2, 2, 1, 1, '怎么样？？？？', '2021-03-18 12:35', 1, 0);
INSERT INTO `tb_comment_notice` VALUES (3, 2, 2, 1, '真好', '2021-03-18 12:35', 1, 0);
INSERT INTO `tb_comment_notice` VALUES (4, 2, 2, 1, '真好', '2021-03-18 12:35', 1, 0);
INSERT INTO `tb_comment_notice` VALUES (5, 3, 3, 1, '好文，收获颇多！！！', '2021-03-18 14:32', 2, 0);
INSERT INTO `tb_comment_notice` VALUES (6, 3, 1, 3, '是事实', '2021-03-22 13:00', 2, 0);
INSERT INTO `tb_comment_notice` VALUES (7, 3, 1, 3, 'test', '2021-03-22 13:01', 2, 0);
INSERT INTO `tb_comment_notice` VALUES (8, 4, 1, 1, 'test', '2021-03-22 13:01', 2, 0);
INSERT INTO `tb_comment_notice` VALUES (9, 5, 11, 10, '你走吧', '2021-03-24 20:42', 36, 0);
INSERT INTO `tb_comment_notice` VALUES (10, 6, 11, 10, '你走吧', '2021-03-24 20:42', 36, 0);
INSERT INTO `tb_comment_notice` VALUES (11, 7, 1, 4, '说得好<img src=\"http://abiao.me:8888/static/assets/libs/layui/images/face/37.gif\" alt=\"[色]\">', '2021-03-24 21:23', 35, 0);
INSERT INTO `tb_comment_notice` VALUES (12, 8, 13, 1, '好强，这就是大佬吗', '2021-03-25 20:27', 2, 0);
INSERT INTO `tb_comment_notice` VALUES (13, 8, 2, 13, '是  就是大佬', '2021-03-25 21:05', 2, 0);
INSERT INTO `tb_comment_notice` VALUES (14, 9, 1, 1, '<img src=\"http://abiao.me:8888/static/assets/libs/layui/images/face/1.gif\" alt=\"[嘻嘻]\">&nbsp;写的很好', '2021-04-24 16:09', 2, 0);
INSERT INTO `tb_comment_notice` VALUES (15, 9, 2, 1, '是呀', '2021-04-24 16:12', 2, 0);
INSERT INTO `tb_comment_notice` VALUES (16, 10, 2, 2, '<p><img src=\"http://abiao.me:6688/image/2021/04/25/gqRI0o5ic.png\" alt=\"imagesFile-1619339908180\">带图片的测试</p>', '2021-04-25 16:48', 84, 0);
INSERT INTO `tb_comment_notice` VALUES (17, 11, 2, 2, '正常评论', '2021-04-26 08:23', 84, 0);
INSERT INTO `tb_comment_notice` VALUES (18, 12, 2, 2, '1', '2021-04-26 08:24', 84, 0);
INSERT INTO `tb_comment_notice` VALUES (19, 13, 1, 1, '我是评论，法轮大法好', '2021-05-01 01:59', 90, 0);
INSERT INTO `tb_comment_notice` VALUES (20, 14, 1, 1, '测试评论，', '2021-05-01 02:17', 90, 0);

-- ----------------------------
-- Table structure for tb_comment_reply
-- ----------------------------
DROP TABLE IF EXISTS `tb_comment_reply`;
CREATE TABLE `tb_comment_reply`  (
  `r_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '评论回复ID',
  `r_content` text CHARACTER SET utf8 COLLATE utf8_general_ci NULL,
  `r_time` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL COMMENT '回复时间',
  `parent_comment_id` int(11) NOT NULL COMMENT '父评论ID',
  `touid` int(11) NOT NULL COMMENT '目标用户id，回复给谁',
  `r_uid` int(11) NOT NULL COMMENT '用户ID',
  PRIMARY KEY (`r_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 16 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_comment_reply
-- ----------------------------
INSERT INTO `tb_comment_reply` VALUES (1, '真好', '2021-03-18 12:35', 2, 1, 2);
INSERT INTO `tb_comment_reply` VALUES (2, '真好', '2021-03-18 12:35', 2, 1, 2);
INSERT INTO `tb_comment_reply` VALUES (3, '是事实', '2021-03-22 13:00', 3, 3, 1);
INSERT INTO `tb_comment_reply` VALUES (4, 'test', '2021-03-22 13:01', 3, 3, 1);
INSERT INTO `tb_comment_reply` VALUES (5, '是  就是大佬', '2021-03-25 21:05', 8, 13, 2);
INSERT INTO `tb_comment_reply` VALUES (6, '是呀', '2021-04-24 16:12', 9, 1, 2);
INSERT INTO `tb_comment_reply` VALUES (7, '21', '2021-05-01 02:02', 13, 1, 1);
INSERT INTO `tb_comment_reply` VALUES (8, 'test', '2021-05-01 02:08', 13, 1, 1);
INSERT INTO `tb_comment_reply` VALUES (9, '1', '2021-05-01 02:08', 13, 1, 1);
INSERT INTO `tb_comment_reply` VALUES (10, '1', '2021-05-01 02:08', 13, 1, 1);
INSERT INTO `tb_comment_reply` VALUES (11, '1', '2021-05-01 02:08', 13, 1, 1);
INSERT INTO `tb_comment_reply` VALUES (12, '1', '2021-05-01 02:10', 13, 1, 1);
INSERT INTO `tb_comment_reply` VALUES (13, '1', '2021-05-01 02:13', 13, 1, 1);
INSERT INTO `tb_comment_reply` VALUES (14, '1', '2021-05-01 02:13', 13, 1, 1);
INSERT INTO `tb_comment_reply` VALUES (15, '测试回复md', '2021-05-01 02:41', 14, 1, 1);

-- ----------------------------
-- Table structure for tb_email
-- ----------------------------
DROP TABLE IF EXISTS `tb_email`;
CREATE TABLE `tb_email`  (
  `e_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `u_id` int(11) NOT NULL COMMENT '对应的用户ID',
  `email` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '对应的用户邮箱',
  `check` int(11) NOT NULL DEFAULT 0 COMMENT '是否激活邮箱，0-未验证 1-已验证',
  PRIMARY KEY (`e_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 16 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_email
-- ----------------------------
INSERT INTO `tb_email` VALUES (1, 1, NULL, 0);
INSERT INTO `tb_email` VALUES (2, 2, NULL, 0);
INSERT INTO `tb_email` VALUES (3, 3, 'qlh3306@qq.com', 0);
INSERT INTO `tb_email` VALUES (4, 4, '1254673428@qq.com', 1);
INSERT INTO `tb_email` VALUES (5, 5, NULL, 0);
INSERT INTO `tb_email` VALUES (10, 10, NULL, 0);
INSERT INTO `tb_email` VALUES (11, 11, NULL, 0);
INSERT INTO `tb_email` VALUES (12, 12, NULL, 0);
INSERT INTO `tb_email` VALUES (13, 13, NULL, 0);
INSERT INTO `tb_email` VALUES (14, 14, NULL, 0);
INSERT INTO `tb_email` VALUES (15, 15, NULL, 0);

-- ----------------------------
-- Table structure for tb_follow
-- ----------------------------
DROP TABLE IF EXISTS `tb_follow`;
CREATE TABLE `tb_follow`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `user_id` int(11) NOT NULL COMMENT '被关注者的用户ID',
  `follow_id` int(11) NOT NULL COMMENT '点击关注者的ID',
  `time` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '关注时间',
  `status` int(2) NOT NULL COMMENT '关注状态 0-未关注 1-已关注',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 10 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_follow
-- ----------------------------
INSERT INTO `tb_follow` VALUES (1, 1, 2, '2021-03-18 12:34', 1);
INSERT INTO `tb_follow` VALUES (2, 1, 3, '2021-03-18 19:10', 1);
INSERT INTO `tb_follow` VALUES (3, 3, 1, '2021-03-18 19:11', 0);
INSERT INTO `tb_follow` VALUES (4, 2, 1, '2021-03-18 19:11', 1);
INSERT INTO `tb_follow` VALUES (5, 1, 4, '2021-03-24 17:20', 1);
INSERT INTO `tb_follow` VALUES (6, 3, 10, '2021-03-24 20:39', 1);
INSERT INTO `tb_follow` VALUES (7, 10, 11, '2021-03-24 20:42', 1);
INSERT INTO `tb_follow` VALUES (8, 4, 1, '2021-03-24 21:23', 1);
INSERT INTO `tb_follow` VALUES (9, 1, 11, '2021-04-09 20:45', 1);

-- ----------------------------
-- Table structure for tb_index_image
-- ----------------------------
DROP TABLE IF EXISTS `tb_index_image`;
CREATE TABLE `tb_index_image`  (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `url` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL,
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 31 CHARACTER SET = latin1 COLLATE = latin1_swedish_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_index_image
-- ----------------------------
INSERT INTO `tb_index_image` VALUES (28, 'http://abiao.me:6688/image/2021/04/28/1ak3IonB9.png');
INSERT INTO `tb_index_image` VALUES (29, 'http://abiao.me:6688/image/2021/04/28/gqQqWDezO.png');
INSERT INTO `tb_index_image` VALUES (30, 'http://abiao.me:6688/image/2021/04/28/2FL7p6Iw0.png');

-- ----------------------------
-- Table structure for tb_question
-- ----------------------------
DROP TABLE IF EXISTS `tb_question`;
CREATE TABLE `tb_question`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '问题id',
  `title` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '标题',
  `description` longtext CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '问题补充内容',
  `gmt_create` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '发帖时间',
  `gmt_modified` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '修改时间',
  `publisher_id` int(11) NOT NULL COMMENT '发帖用户ID',
  `comment_count` int(11) NOT NULL DEFAULT 0 COMMENT '评论数',
  `view_count` int(11) NOT NULL DEFAULT 0 COMMENT '阅读数',
  `like_count` int(11) NOT NULL DEFAULT 0 COMMENT '点赞数',
  `tag` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '问题标签',
  `is_ding` int(1) NOT NULL DEFAULT 0 COMMENT '0-未置顶 1-置顶',
  `is_jing` int(1) NOT NULL DEFAULT 0 COMMENT '0-未加精 1-加精',
  `status` int(1) NOT NULL DEFAULT 0 COMMENT '0-正常 1-删除',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 95 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_question
-- ----------------------------
INSERT INTO `tb_question` VALUES (1, 'Nginx+uWSGI+Django的部署过程', '<h2 id=\"1-创建一个-nginx-容器\">1. 创建一个 nginx 容器:</h2>\n<p><code>docker run -id --name 容器名 -v django_project:/root/www/django_project -p 80:80 -p 443:443 nginx</code></p>\n<h2 id=\"2-进入容器\">2. 进入容器:</h2>\n<p><code>docker exec -it 容器名 /bin/bash</code></p>\n<h2 id=\"3-安装-net-tools-与-procps-方便后期进行调试（可以不装）\">3. 安装 net-tools 与 procps 方便后期进行调试（可以不装）</h2>\n<figure class=\"highlight shell\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs shell\">apt update<br />apt install net-tools<br />apt install procps<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>由于容器自带 nginx, 所以我们只需要安装 uwsgi 即可:</p>\n<h2 id=\"4-首先我们需要先了解一下一下-WSGI\">4. 首先我们需要先了解一下一下 WSGI:</h2>\n<blockquote>\n<p>WSGI(Web Server Gateway Interface) WSGI 是一个规范，定义了 Web 服务器如何与 Python 应用程序进行交互，使得使用 Python 写的 Web 应用程序可以和 Web 服务器对接起来。</p>\n<p>作为一个低级接口,WSGI 就像是一座桥梁，一边连着 web 服务器(如 nginx)，另一边连着 Python 的应用程序 Application。但是呢，这个桥的功能很弱，有时候还需要别的桥来帮忙才能进行处理。</p>\n</blockquote>\n<p>那么什么是 uWSGI 呢?</p>\n<p>简单说, 他是一个实现了<strong>WSGI 协议</strong>的一个 web 服务器</p>\n<p>只要 web 服务器和 web 框架满足 WSGI 协议，它们就能相互搭配.</p>\n<p>所以我们只需要使用 uWSGI 就可以满足我们对网站功能的使用, 那么我们为什么要使用 nginx 呢?</p>\n<p>众所周知, nginx 作为一款高性能的<a href=\"https://baike.baidu.com/item/HTTP\">HTTP</a>和<a href=\"https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/7793488\">反向代理</a>web 服务器, nginx 可以解决高并发访问的负载问题,</p>\n<p>当然我这破网站不可能有什么过大负载, 1G 内存也不够开过多 docker, 所以此处使用 nginx 更多是一种练习作用</p>\n<p>我们可以让 nginx 负责静态资源的加载, nginx 负责动态资源的访问</p>\n<h2 id=\"5-接下来我们安装-uWSGI\">5. 接下来我们安装 uWSGI:</h2>\n<p>首先确保容器内有 pip3, 没有自行安装</p>\n<p><code>apt install python3-pip</code></p>\n<p>直接安装 uwsgi</p>\n<p><code>pip3 install uwsgi</code></p>\n<h2 id=\"6-开始配置\">6. 开始配置:</h2>\n<h3 id=\"6-1-在项目根目录创建-uwsgi-配置文件\">6.1 在项目根目录创建 uwsgi 配置文件</h3>\n<p><code>vim uwsgi.ini</code></p>\n<p>根据需求写入</p>\n<figure class=\"highlight ini\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs ini\"><span class=\"hljs-section\">[uwsgi]</span><br /><span class=\"hljs-attr\">chdir</span> = your_project_dir<br /><span class=\"hljs-attr\">module</span> = your_project.wsgi:application <span class=\"hljs-comment\">#此处的wsgi模块根据你的项目wsgi位置进行配置</span><br /><span class=\"hljs-attr\">master</span> = <span class=\"hljs-literal\">True</span><br /><span class=\"hljs-attr\">processes</span> = <span class=\"hljs-number\">4</span><br /><span class=\"hljs-attr\">max-requests</span> = <span class=\"hljs-number\">5000</span><br /><span class=\"hljs-attr\">harakiri</span> = <span class=\"hljs-number\">60</span><br /><span class=\"hljs-attr\">socket</span> = <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>:<span class=\"hljs-number\">8848</span>			<span class=\"hljs-comment\">#设置监听端口</span><br /><span class=\"hljs-attr\">daemonize</span> =  your_project_dir/mysite.log	<span class=\"hljs-comment\">#设置log位置</span><br /><span class=\"hljs-attr\">vacuum</span> = <span class=\"hljs-literal\">True</span><br /><span class=\"hljs-attr\">threads</span>=<span class=\"hljs-number\">2</span><br /><span class=\"hljs-attr\">pidfile</span>=uwsgi.pid<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>处理注释的地方, 其他的可以保持不变, 需要的话可以戳这里, 查看全部参数意义</p>\n<h3 id=\"6-2-开启一下\">6.2 开启一下:</h3>\n<p><code>uwsgi --ini uwsgi.ini</code></p>\n<p>出现这个提示就表示开启成功, 可以 cat 一下.log 查看日志</p>\n<p><a href=\"http://note.youdao.com/yws/res/8320/WEBRESOURCE9b106dead1b9c7bedda83889782801e8\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" alt=\"img\" data-original=\"http://note.youdao.com/yws/res/8320/WEBRESOURCE9b106dead1b9c7bedda83889782801e8\" /></a></p>\n<p>有的人可能会报这个错:Internal Server Error</p>\n<p>可以检查一下自己的 django 项目是否有未安装的包存在, 只要包安装正确理论上就没有问题了</p>\n<h3 id=\"6-3-配置-nginx\">6.3 配置 nginx:</h3>\n<p>在/etc/nginx/conf.d 下新建一个自己的配置文件:</p>\n<figure class=\"highlight crmsh\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs crmsh\"><span class=\"hljs-comment\"># 如: project.conf</span><br />upstream django {<br />\\<span class=\"hljs-comment\"># server unix:///path/to/your/mysite/mysite.sock; # for a file socket</span><br />server <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>:<span class=\"hljs-number\">8848</span>;	//此处的端口是uwsgi监听的端口<br />}<br />server {<br />listen  <span class=\"hljs-number\">80</span>;<br />server_name  blog;<br />charset UTF-<span class=\"hljs-number\">8</span>;<br />client_max_body_size <span class=\"hljs-number\">75M</span>;<br /><span class=\"hljs-keyword\">location</span> <span class=\"hljs-title\">/ {</span><br /><span class=\"hljs-title\">uwsgi_pass</span> <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>:<span class=\"hljs-number\">8848</span>;<br />include /etc/nginx/uwsgi_params;<br />}<br /><span class=\"hljs-keyword\">location</span> <span class=\"hljs-title\">/static</span> {<br />alias project_path/STATIC_URL;	<span class=\"hljs-comment\">#静态资源路(此处的STATIC_URL,需要替换为settings中的STATIC_URL, 下面的MEDIA_ROOT同</span><br />}<br /><span class=\"hljs-keyword\">location</span> <span class=\"hljs-title\">/media</span> {<br />alias project_path/MEDIA_ROOT; <span class=\"hljs-comment\">#上传资源路径</span><br />}<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"6-4-在-nginx-conf-中引入\">6.4 在 nginx.conf 中引入</h3>\n<p><code>include /etc/nginx/conf.d/project.conf;</code></p>\n<p><em>完成, 直接访问就可以了</em></p>\n<h2 id=\"7-有兴趣可以继续配置-https\">7. 有兴趣可以继续配置 https</h2>\n<h3 id=\"7-1-首先获取个-SSL-证书\">7.1 首先获取个 SSL 证书:</h3>\n<p>阿里云的点这里:<a href=\"https://yundun.console.aliyun.com/?spm=5176.12901015.0.i12901015.1398525c1Nfqeu&amp;p=cas#/overview/cn-hangzhou\">https://yundun.console.aliyun.com/?spm=5176.12901015.0.i12901015.1398525c1Nfqeu&amp;p=cas#/overview/cn-hangzhou</a></p>\n<h3 id=\"7-2-然后把证书下载传到服务器-传到-docker-内部\">7.2 然后把证书下载传到服务器, 传到 docker 内部</h3>\n<p>解压</p>\n<p>放到 nginx 配置目录(/etc/nginx/cert)目录下(没有 cert 目录自己创建)</p>\n<p>配置刚才的 project.conf</p>\n<p>修改为以下:</p>\n<figure class=\"highlight awk\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs awk\">upstream django {<br />\\<span class=\"hljs-comment\"># server unix:///path/to/your/mysite/mysite.sock; # for a file socket</span><br />server <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>:<span class=\"hljs-number\">8848</span>;<br />}<br />server {<br />listen <span class=\"hljs-number\">80</span>;<br />server_name kilic.site ;<br />rewrite ^(.*)$ https:<span class=\"hljs-regexp\">//</span><span class=\"hljs-variable\">$host</span><span class=\"hljs-variable\">$1</span> permanent;<span class=\"hljs-comment\">#自动转发https请求</span><br />}<br />server {<br />listen  <span class=\"hljs-number\">443</span> ssl;<br />server_name  kilic.site;<br />charset UTF-<span class=\"hljs-number\">8</span>;<br />client_max_body_size <span class=\"hljs-number\">75</span>M;<br />ssl_certificate cert/xxx.pem;	<span class=\"hljs-comment\">#此处为自己的证书名</span><br />ssl_certificate_key cert/xxx.key;	<span class=\"hljs-comment\">#此处为自己的私钥</span><br />ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;<br />ssl_protocols TLSv1 TLSv1.<span class=\"hljs-number\">1</span> TLSv1.<span class=\"hljs-number\">2</span>;<br />ssl_prefer_server_ciphers on;<br />location / {<br />uwsgi_pass <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>:<span class=\"hljs-number\">8848</span>;<br />include <span class=\"hljs-regexp\">/etc/</span>nginx/uwsgi_params;<br />}<br />location /static {<br />alias <span class=\"hljs-regexp\">/var/</span>www<span class=\"hljs-regexp\">/blog/</span>static/;<br />}<br />location /media {<br />alias <span class=\"hljs-regexp\">/var/</span>www<span class=\"hljs-regexp\">/blog/</span>blog<span class=\"hljs-regexp\">/media/</span>;<br />}<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>重启 nginx:</p>\n<p><code>nginx -s reload</code></p>\n<p>以上!</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-03-18 10:00', '2021-03-18 10:00', 1, 2, 28, 1, 'Django', 0, 0, 0);
INSERT INTO `tb_question` VALUES (2, '认识JavaScript细节(上)', '<h1 id=\"0-前戏\">0. 前戏</h1>\n<h2 id=\"0-1-弹框\">0.1 弹框</h2>\n<h3 id=\"0-1-1-alert-原理\">0.1.1 alert 原理</h3>\n<p>将 alert 传入的值运算，使用 toString 进行打印输出（<strong>类型为 string</strong>）</p>\n<h3 id=\"0-1-2-confirm\">0.1.2 confirm</h3>\n<p>确认请求框：原理与 alert 一致，有确定与取消两个框，可以接受选择的值</p>\n<figure class=\"highlight javascript\">\n<table style=\"height: 75px;\" width=\"543\">\n<tbody>\n<tr>\n<td class=\"code\" style=\"width: 528.929px;\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> flag = confirm(<span class=\"hljs-string\">\"msg\"</span>);<br />flag; <span class=\"hljs-comment\">//true 确定 false 取消</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"0-1-3-prompt\">0.1.3 prompt</h3>\n<p>在 confirm 基础上添加输入框，返回输入值</p>\n<h2 id=\"0-2-console\">0.2 console</h2>\n<h3 id=\"0-2-1-console-log\">0.2.1 console.log</h3>\n<p>控制台打印</p>\n<h3 id=\"0-2-2-console-dir\">0.2.2 console.dir</h3>\n<p>比 log 更详细</p>\n<h3 id=\"0-2-3-console-table\">0.2.3 console.table</h3>\n<p>把 json 按照表格输出</p>\n<h1 id=\"1-数据类型\">1. 数据类型</h1>\n<h2 id=\"1-1-基本数据类型\">1.1 基本数据类型</h2>\n<ul>\n<li>\n<p>number</p>\n<ul>\n<li>\n<p>普通数字</p>\n<p>parseInt/parseFloat：</p>\n<ol>\n<li>\n<p>parseInt：把字符串中的 int 值提取出来</p>\n</li>\n<li>\n<p>parseFloat：把字符串中的 float 解析出来</p>\n<figure class=\"highlight stylus\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs stylus\"><span class=\"hljs-function\"><span class=\"hljs-title\">parseInt</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\'0.5s\'</span>)</span></span> <span class=\"hljs-comment\">// 0</span><br /><span class=\"hljs-function\"><span class=\"hljs-title\">parseInt</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\'0.5s\'</span>)</span></span> <span class=\"hljs-comment\">// 0.5</span><br /><span class=\"hljs-function\"><span class=\"hljs-title\">parseInt</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\'s0.5\'</span>)</span></span> <span class=\"hljs-comment\">//NaN</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p><strong>从字符串最左边开始提取字符, 遇到第一个非有效字符略过</strong></p>\n</li>\n</ol>\n</li>\n<li>\n<p>NaN（not a number）</p>\n<p>isNan([value])可以来检测当前的值是否不是有效机制</p>\n<p>isNaN 检测机制：</p>\n<ol>\n<li>验证当前检测值是否为数字类型，如果不是浏览器会转换为数字类型</li>\n<li>如果当前数字是数字类型，是有效数字返回 false，不是返回 true</li>\n<li>其中数字类型转换规则：使用 Number([value])方法转换\n<ol>\n<li>字符串转换数字必须全部是有效字符，否则为 NaN，可识别小数</li>\n<li>boolean 转数字 true-&gt;1 flase-&gt;0</li>\n<li>引用转换数字：toString 转换字符串后用字符串转换机制转换</li>\n<li>其他：null-&gt;0 undefined-&gt;NaN [] -&gt; &lsquo;&rsquo; -&gt; 0</li>\n</ol>\n</li>\n</ol>\n<p>NaN 的比较：</p>\n<ol>\n<li>\n<p>NaN 与谁都不相等(包括 NaN 自己)</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">Number</span>(num) == <span class=\"hljs-literal\">NaN</span>; <span class=\"hljs-comment\">//必定false，错误用法</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p>string：</p>\n<ul>\n<li>字符串是存储在栈内存的</li>\n<li>js 的字符串有不可变长的特性</li>\n</ul>\n</li>\n<li>\n<p>boolean</p>\n<ul>\n<li>转换为 boolean\n<ol>\n<li>Boolean：(转换为数字，0 和 NaN 会转换为 flase，其他为 true)</li>\n<li>!：先把其他类型转 boolean 取反</li>\n<li>!!：不取反，与 Boolean 基本没有区别</li>\n</ol>\n</li>\n<li>规律：\n<ol>\n<li>只有 0 NaN &lsquo;&rsquo; null undefined 五个值转换为 boolean 的 flase，其余为 true</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p>null</p>\n<ul>\n<li>空对象指针：指预期之中不存在（人为），后期会操作</li>\n<li><code>typeof null === &rsquo;object&lsquo;</code>是 true 为什么 null 是个基本数据类型？\n<ul>\n<li>因为计算机存储将 000 开头标识为对象，null 存储时候将所有位置 0，所以会出现 typeof null === true，但是不能说明 null 是引用数据类型</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>undefined</p>\n<ul>\n<li>未定义：非预期不存在（变量提升等情况），是浏览器自主情况</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"1-2-引用类型\">1.2 引用类型</h2>\n<ul>\n<li>\n<p>对象（Object）</p>\n<ul>\n<li>\n<p>数组对象</p>\n</li>\n<li>\n<p>普通对象</p>\n<ul>\n<li>当我们存储属性名不是字符串或数字会转换为字符串（toString）存储</li>\n</ul>\n</li>\n<li>\n<p>正则对象</p>\n</li>\n<li>\n<p>&hellip;&hellip;</p>\n</li>\n</ul>\n</li>\n<li>\n<p>函数（function）</p>\n</li>\n</ul>\n<h2 id=\"1-3-Symbol-类型（ES6）\">1.3 Symbol 类型（ES6）</h2>\n<p>创建一个唯一的值</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> a = <span class=\"hljs-built_in\">Symbol</span>(<span class=\"hljs-string\">\"test\"</span>);<br /><span class=\"hljs-keyword\">var</span> b = <span class=\"hljs-built_in\">Symbol</span>(<span class=\"hljs-string\">\"test\"</span>);<br /><span class=\"hljs-built_in\">console</span>.log(a == b); <span class=\"hljs-comment\">//false</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"1-4-数据类型检测\">1.4 数据类型检测</h2>\n<p>四种方式</p>\n<ol>\n<li>typeof</li>\n<li>constructor</li>\n<li>Object.prototype.toString.call()</li>\n<li>instanceof</li>\n</ol>\n<h2 id=\"1-5-数据转换规则\">1.5 数据转换规则</h2>\n<ol>\n<li>\n<p>转化为 number：</p>\n<ol>\n<li>\n<p>情况：</p>\n<ol>\n<li>isNaN 检测时</li>\n<li>手动转换</li>\n<li>运算符计算自动转换</li>\n<li>==比较转换</li>\n</ol>\n</li>\n<li>\n<p>规律：</p>\n<ol>\n<li>string-&gt;number：Number() &lsquo;&rsquo;-&gt;0 &lsquo; &lsquo; -&gt; 0 &lsquo;\\n&rsquo; -&gt; 0 &lsquo;\\t&rsquo; -&gt; 0</li>\n<li>boolean-&gt;number：true-&gt;1 false-&gt;0</li>\n<li>没有转换：null-&gt;0 undefined -&gt; NaN</li>\n<li>引用转换：toString 后转换</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>\n<p>转换为 string：</p>\n<ol>\n<li>\n<p>情况：</p>\n<ol>\n<li>基于+进行字符串拼接时候</li>\n<li>吧引用转换为数字前</li>\n<li>给对象设置属性名</li>\n<li>手动调用 toString/toFixed/join/String 方法</li>\n</ol>\n</li>\n<li>\n<p>规律：</p>\n<ol>\n<li>number-&gt;&lsquo;number&rsquo;</li>\n<li>NaN -&gt; &lsquo;NaN&rsquo;</li>\n<li>[1,2,3] -&gt; 1,2,3 []-&gt;&lsquo;&rsquo;</li>\n<li>对象 -&gt; &lsquo;[object Object]&rsquo;</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>\n<p>特殊情况：</p>\n<p>在&lsquo;==&rsquo;进行比较时候如果左右数据类型不相等则转换相同类型后比较</p>\n<ol>\n<li>对象==对象：比较地址</li>\n<li>对象==数字：对象转数字</li>\n<li>对象==boolean：对象转数字，布尔转数字</li>\n<li>对象==字符串：对象转数字，字符串转数字</li>\n<li>字符串==数字：都转数字</li>\n<li>null == undefined：true</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"1-6-数组操作\">1.6 数组操作</h2>\n<ol>\n<li>\n<p>push(any):number：数组末尾追加新内容</p>\n</li>\n<li>\n<p>pop():any：删除最后一项</p>\n</li>\n<li>\n<p>shift():any：删除第一项</p>\n</li>\n<li>\n<p>unshift(any):number：向数组开头新增加内容</p>\n</li>\n<li>\n<p>splice(n:number[, m:number]):any：删除从 n 开始 m 个内容，返回删除内容</p>\n<p>不指定 m 则删除全部</p>\n<p>splice 可以使用 splice(2,0,&hellip;.)实现增加，也可以添加删除个数修改</p>\n</li>\n<li>\n<p>slice(n:number, m:number):array：按照条件查找数组内容</p>\n</li>\n<li>\n<p>concat(array&hellip;):array：实现多个数组拼接，返回拼接后数组，原数不变</p>\n</li>\n<li>\n<p>join(any)：指定连接符，对数组转换字符串拼接</p>\n</li>\n<li>\n<p>reverse():any：数组倒叙</p>\n</li>\n<li>\n<p>sort([function])：any：返回排序后数组</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">a, b</span>)</span>{<br />    <span class=\"hljs-keyword\">return</span> a-b;<span class=\"hljs-comment\">//升序 return b-a; 降序</span><br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n</li>\n<li>\n<p>indexOf/lastIndexOf(any):number：返回当前项在数组中第一次（最后一次）出现索引</p>\n</li>\n<li>\n<p>去重策略：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">//1. 分别取出每一项与后面向每一项比较，删除重复项</span><br /><span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; arr.length - <span class=\"hljs-number\">1</span>; i++) {<br />  <span class=\"hljs-keyword\">var</span> item = arr[i];<br />  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> k = i + <span class=\"hljs-number\">1</span>; k &lt; arr.length; k++) {<br />    <span class=\"hljs-keyword\">if</span> (item == arr[k]) {<br />      arr.splice(k, <span class=\"hljs-number\">1</span>);<br />      k--; <span class=\"hljs-comment\">//此处解决数组塌陷问题</span><br />    }<br />  }<br />}<br /><span class=\"hljs-comment\">//2. 创建空对象，遍历数组每一项，吧存储值当做key与value存储，添加前看属性是否已经存在key</span><br /><span class=\"hljs-comment\">//3. set去重</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"1-7-字符串操作\">1.7 字符串操作</h2>\n</li>\n</ol>\n<blockquote>\n<p>所有单引号和双引号包起来的都是字符串</p>\n</blockquote>\n<ol>\n<li>charAt、charCodeAt：根据所以呢获取指定位置字符（unicode 编码）</li>\n<li>indexOf、lastIndexOf</li>\n<li>slice：获取索引区间字符串，支持负索引</li>\n<li>subString：获取范围字符串，不支持负索引</li>\n<li>substr：获取从 m 开始 n 个字符</li>\n<li>toUpperCase、toLowerCase</li>\n<li>split：按指定字符切割</li>\n</ol>\n<h2 id=\"1-8-Math-运算\">1.8 Math 运算</h2>\n<ol>\n<li>abs：绝对值</li>\n<li>ceil、floor：向上向下取整</li>\n<li>round：四舍五入</li>\n<li>sqrt：开方</li>\n<li>pow：取幂</li>\n<li>max、min：获取多个数最大最小值</li>\n<li>PI：圆周率</li>\n<li>random：获取 0-1 随机数（Math.random()*(m-n)+n）</li>\n</ol>\n<h2 id=\"1-9-函数\">1.9 函数</h2>\n<ol>\n<li>arguments：一个类数组，不能使用数组方法，存储所有实参参数\n<ol>\n<li>length：长度</li>\n<li>callee：函数本身</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"2-语法细节\">2. 语法细节</h1>\n<h2 id=\"2-1-变量的提升\">2.1 变量的提升</h2>\n<h3 id=\"JS-作用域？\">JS 作用域？</h3>\n<p>没有 let 时候，JS 中只有三种作用域：全局，函数，eval</p>\n<p>js 作用域是静态的作用域（定义时候产生）</p>\n<p>执行函数时，会产生执行上下文（EC），这个 EC 会压入 EC 栈（ECS）</p>\n<h3 id=\"函数的执行\">函数的执行</h3>\n<p>分为创建阶段与执行阶段</p>\n<p>其中不得不提到 VO 与 AO</p>\n<h4 id=\"VO-与-AO\">VO 与 AO</h4>\n<p>可以理解 VO 为一个与执行上下文关联的对象，这个对象的属性是这个执行上下文中的声明的函数、变量、参数列表作为其属性。</p>\n<p>AO 可以肯做是与 VO 相同的东西，在函数调用时，VO 被激活成了 AO。</p>\n<p>未进入执行阶段之前，变量对象(VO)中的属性都不能访问！但是进入执行阶段之后，变量对象(VO)转变为了活动对象(AO)，里面的属性都能被访问了，然后开始进行执行阶段的操作。</p>\n<p>进入上下文阶段，AO 会做如下初始化：</p>\n<ul>\n<li>函数的所有形式参数</li>\n<li>所有函数声明，这个属性由一个函数对象的名称和值组成如果变量对象已经存在相同名称的属性，则完全替换这个属性</li>\n<li>所有变量声明，这个属性由变量名称和 undefined 值(系统默认初始值)组成；如果变量名称跟已经声明的形式参数或函数相同，则变量声明被忽略。</li>\n</ul>\n<p>下面举个 AO 构建的例子：</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs js\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">fn</span>(<span class=\"hljs-params\">a, b</span>)</span>{<br />  <span class=\"hljs-keyword\">var</span> c = <span class=\"hljs-number\">10</span>;<br />    <span class=\"hljs-keyword\">var</span> d = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>() </span>{}<br />    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">e</span>()</span>{}<br />}<br /><br /><span class=\"hljs-comment\">// Ao:</span><br />AO = {<br />    a: <span class=\"hljs-number\">10</span>,<br />    b: <span class=\"hljs-literal\">undefined</span>,<br />    e: <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ref</span> <span class=\"hljs-attr\">to</span> <span class=\"hljs-attr\">function</span> <span class=\"hljs-attr\">total</span>&gt;</span>.</span><br /><span class=\"xml\">    d: undefined</span><br /><span class=\"xml\">}</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>这也就揭示了所谓的变量提升机制。</p>\n<h2 id=\"2-2-带-var-与不带-var-区别\">2.2 带 var 与不带 var 区别</h2>\n<p>带 var 是一种变量声明，会将变量映射到 window 上</p>\n<p>不带 var 是一种对 window.A 变量的赋值动作，是一个为对象添加属性的行为</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-built_in\">window</span>.A); <span class=\"hljs-comment\">//undefined</span><br /><span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"A\"</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">window</span>); <span class=\"hljs-comment\">//true</span><br /><span class=\"hljs-keyword\">var</span> A;<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-built_in\">window</span>.A); <span class=\"hljs-comment\">//undefined</span><br /><span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"A\"</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">window</span>); <span class=\"hljs-comment\">//false</span><br />A = <span class=\"hljs-number\">1</span>;<br /><span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-built_in\">window</span>.A); <span class=\"hljs-comment\">//1</span><br /><span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"A\"</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">window</span>); <span class=\"hljs-comment\">//true</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"2-3-变量重名处理机制\">2.3 变量重名处理机制</h2>\n<p>对于一个变量，无论是属于 function 还是普通变量，只要在同一个作用域，比如全局作用域声明就会被映射为 window 的一个属性，其中显然 window 是不会存在两个同名的属性，所以会触发变量的重新赋值机制：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\">fn(); <span class=\"hljs-comment\">//this is a function</span><br /><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">fn</span>() </span>{<br />  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"this is a function\"</span>);<br />}<br /><span class=\"hljs-keyword\">var</span> fn = <span class=\"hljs-number\">1</span>;<br />fn(); <span class=\"hljs-comment\">//TypeError: fn is not a function</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"2-4-作用域链\">2.4 作用域链</h2>\n<p>带 var 的声明变量为当前作用域变量，与上级作用域无关</p>\n<p>不带 var 变量不是私有变量，会向上级作用域查找，如果是上级作用域的变量则为这个作用域变量，不是上级作用域则继续向上查找，一直找到 window 为止</p>\n<p>如果在 window 中仍然不存在这个属性则会为 window 添加这个属性</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">console</span>.log(a, b); <span class=\"hljs-comment\">//undefined undefined</span><br /><span class=\"hljs-keyword\">var</span> a = <span class=\"hljs-number\">1</span>,<br />  b = <span class=\"hljs-number\">2</span>;<br /><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">t</span>() </span>{<br />  <span class=\"hljs-built_in\">console</span>.log(a, b); <span class=\"hljs-comment\">//undefined 2	变量在作用域链查找</span><br />  <span class=\"hljs-keyword\">var</span> a = (b = <span class=\"hljs-number\">3</span>);<br />  <span class=\"hljs-built_in\">console</span>.log(a, b); <span class=\"hljs-comment\">//3 3</span><br />}<br />t();<br /><span class=\"hljs-built_in\">console</span>.log(a, b); <span class=\"hljs-comment\">//1 3</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>在 js 中存在以下几种作用域：</p>\n<ol>\n<li>全局作用域</li>\n<li>私有作用域（函数）</li>\n<li>块级作用域（ES6）：<strong>一般</strong>用大括号包含代码块，（对象的大括号不是）</li>\n</ol>\n<h2 id=\"2-5-ES6-的暂时性死区（TDZ）\">2.5 ES6 的暂时性死区（TDZ）</h2>\n<p>ES6 规定，如果区块中存在 let 和 const 命令，这个区块对这些命令声明的变量，从一开始就形成了封闭作用域。凡是在声明之前就使用这些变量，就会报错。在代码块内，使用 let 命令声明变量之前，该变量都是不可用的。</p>\n<p>同理，在 let 或 const 声明前使用 typeof 会造成错误</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-keyword\">typeof</span> a); <span class=\"hljs-comment\">//ReferenceError: Cannot access \'a\' before initialization</span><br /><span class=\"hljs-keyword\">const</span> a = <span class=\"hljs-number\">1</span>;<br /><br /><span class=\"hljs-keyword\">var</span> x = x; <span class=\"hljs-comment\">//true</span><br /><span class=\"hljs-keyword\">let</span> x = x; <span class=\"hljs-comment\">//false</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"2-6-全局变量与私有变量\">2.6 全局变量与私有变量</h2>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\">arr = [<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>];<br /><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">t</span>(<span class=\"hljs-params\">arr</span>) </span>{<br />  <span class=\"hljs-built_in\">console</span>.log(arr); <span class=\"hljs-comment\">//[3,2,1]</span><br />  arr[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-number\">1</span>;<br />  arr = [<span class=\"hljs-number\">100</span>];<br />  arr[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-number\">2</span>;<br />  <span class=\"hljs-built_in\">console</span>.log(arr); <span class=\"hljs-comment\">// [2]</span><br />}<br /><br />t(arr);<br /><span class=\"hljs-built_in\">console</span>.log(arr); <span class=\"hljs-comment\">//[1,2,1]</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"2-7-执行作用域\">2.7 执行作用域</h2>\n<blockquote>\n<p>非严格模式存在以下两个属性</p>\n<p>arguments.callee：当前函数本身</p>\n<p>arguments.callee.caller：当前函数调用的宿主环境，全局环境为 null</p>\n<p>在非严格模式下，arguments 中的变量与形参变量存在映射机制，如果修改 arguments 变量会修改实参的值</p>\n</blockquote>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> n = <span class=\"hljs-number\">1</span>;<br /><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">fn</span>() </span>{<br />  <span class=\"hljs-keyword\">var</span> n = <span class=\"hljs-number\">2</span>;<br />  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">f</span>() </span>{<br />    n++;<br />    <span class=\"hljs-built_in\">console</span>.log(n);<br />  }<br />  f();<br />  <span class=\"hljs-keyword\">return</span> f;<br />}<br /><span class=\"hljs-keyword\">var</span> x = fn(); <span class=\"hljs-comment\">//3</span><br />x(); <span class=\"hljs-comment\">//4</span><br />x(); <span class=\"hljs-comment\">//5</span><br /><span class=\"hljs-built_in\">console</span>.log(n); <span class=\"hljs-comment\">//1</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"2-8-闭包与应用\">2.8 闭包与应用</h2>\n<p>函数执行形成一个私有作用域，保护里面变量不受外接影响，这种机制叫做闭包。</p>\n<p>作用：</p>\n<ol>\n<li>保护私有变量不受外界变量影响</li>\n<li>形成不销毁的栈内存，把它保存下来方便调取</li>\n</ol>\n<p>格式：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">//惰性函数</span><br />(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />  <span class=\"hljs-keyword\">return</span> {<br />    <span class=\"hljs-comment\">//TODO</span><br />  };<br />})();<br /><br /><span class=\"hljs-comment\">//柯里化函数</span><br /><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">fn</span>() </span>{<br />  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">f</span>() </span>{<br />    <span class=\"hljs-comment\">//TODO</span><br />  }<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>应用：</p>\n<ol>\n<li>异步编程中保存状态</li>\n</ol>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">3</span>; i++) {<br />  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> {<br />    <span class=\"hljs-built_in\">console</span>.log(i);<br />  }, <span class=\"hljs-number\">0</span>);<br />} <span class=\"hljs-comment\">// 3 3 3</span><br /><span class=\"hljs-comment\">//使用闭包</span><br /><span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">3</span>; i++) {<br />  (<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">i</span>) </span>{<br />    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> {<br />      <span class=\"hljs-built_in\">console</span>.log(i);<br />    }, <span class=\"hljs-number\">0</span>);<br />  })(i);<br />} <span class=\"hljs-comment\">// 0 1 2</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>上面的例子，每次循环添加一个不销毁的私有作用域，使得可以存储私有值，这种方式很浪费性能，实际使用中可以使用 let 解决这个问题。</p>\n<ol start=\"2\">\n<li>封装业务开发模型：</li>\n</ol>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">let</span> productRender = (<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />  <span class=\"hljs-comment\">//AJAX获取数据</span><br />  <span class=\"hljs-keyword\">let</span> productData = <span class=\"hljs-literal\">null</span>;<br />  <span class=\"hljs-keyword\">let</span> getData = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />    <span class=\"hljs-comment\">//TODO</span><br />    <span class=\"hljs-keyword\">let</span> xhr = <span class=\"hljs-keyword\">new</span> XMLHttpRequest();<br />    xhr.open(<span class=\"hljs-string\">\"GET\"</span>, <span class=\"hljs-string\">\"json/product.json\"</span>, <span class=\"hljs-literal\">false</span>);<br />    xhr.onreadystatechange = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />      <span class=\"hljs-keyword\">if</span> (xhr.readyState === <span class=\"hljs-number\">4</span> &amp;&amp; xhr.status === <span class=\"hljs-number\">200</span>) {<br />        productData = <span class=\"hljs-built_in\">JSON</span>.parse(xhr.responseText);<br />      }<br />    };<br />    xhr.send(<span class=\"hljs-literal\">null</span>);<br />  };<br />  <span class=\"hljs-comment\">//数据绑定</span><br />  <span class=\"hljs-keyword\">let</span> bindHTML = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />    <span class=\"hljs-comment\">//TODO</span><br />  };<br />  <span class=\"hljs-keyword\">let</span> bindEvent = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />    <span class=\"hljs-comment\">//TODO</span><br />  };<br />  <span class=\"hljs-keyword\">return</span> {<br />    init: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />      getData();<br />      bindHTML();<br />    },<br />  };<br />})();<br /><br />productRender.init();<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>优点：</p>\n<ol>\n<li>将一个变量长期保存内存中</li>\n<li>避免全局变量污染；</li>\n<li>私有成员的存在。</li>\n</ol>\n<p>缺点：</p>\n<ol>\n<li>常驻内存，增加内存使用量；</li>\n<li>使用不当造成内存泄漏。</li>\n</ol>\n<h2 id=\"2-9-OOP\">2.9 OOP</h2>\n<h3 id=\"2-9-1-new\">2.9.1 new</h3>\n<p>对于函数使用 new 命令，相当于使用构造函数方式进行对象的创建，在复杂类型的创建过程中，字面值创建和构造函数创建没有区别，但是在基本数据类型的创建中存在一定不同：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> num1 = <span class=\"hljs-number\">1</span>;<br /><span class=\"hljs-keyword\">var</span> num2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Number</span>(<span class=\"hljs-number\">1</span>);<br /><span class=\"hljs-keyword\">typeof</span> num1; <span class=\"hljs-comment\">//number</span><br /><span class=\"hljs-keyword\">typeof</span> num2; <span class=\"hljs-comment\">//object</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>虽然两者的类型不同，但是同样可以使用原型链上提供的属性和方法</p>\n<p>下面我们来看 new 的原型机制：</p>\n<blockquote>\n<p>普通函数的执行中，存在以下几个步骤：</p>\n<ol>\n<li>形成私有作用域</li>\n<li>形参赋值</li>\n<li>变量提升</li>\n<li>代码执行</li>\n<li>栈内存释放</li>\n</ol>\n<p>构造函数执行中，存在以下几个步骤：</p>\n<ol>\n<li>形成私有作用域（栈内存）</li>\n<li>形参赋值</li>\n<li>变量提升</li>\n<li><strong>在当前私有栈创建一个对象，并让函数 this 指向这个对象</strong></li>\n<li>代码自上而下执行</li>\n<li><strong>代码执行完成后返回对象地址</strong></li>\n</ol>\n</blockquote>\n<p>细节：</p>\n<blockquote>\n<p>当我们的构造函数不存在 return 时，浏览器会返回自动构造的实例，但是如果自己返回了一个基本值时，对构造实例没有影响，但是若是返回了一个对象，会覆盖默认实例，如果必须使用 return 则使用 return;</p>\n<p>当构造函数不存在参数，可以省略小括号</p>\n</blockquote>\n<p>下面简单实现一个 new：</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs js\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">mockNew</span>(<span class=\"hljs-params\">constructorFunc, ...args</span>) </span>{<br />  <span class=\"hljs-keyword\">const</span> prototype = <span class=\"hljs-title\">constructorFunc</span>.<span class=\"hljs-title\">prototype</span>;<br />  <span class=\"hljs-keyword\">const</span> instance = <span class=\"hljs-built_in\">Object</span>.create(prototype);<br />  <span class=\"hljs-keyword\">const</span> ret = <span class=\"hljs-title\">constructorFunc</span>.<span class=\"hljs-title\">apply</span>(<span class=\"hljs-params\">instance, args</span>);<br />  <span class=\"hljs-keyword\">if</span> (ret <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-built_in\">Object</span>) {<br />    <span class=\"hljs-keyword\">return</span> ret;<br />  } <span class=\"hljs-keyword\">else</span> {<br />    <span class=\"hljs-keyword\">return</span> instance;<br />  }<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"2-9-2-原型链设计模式\">2.9.2 原型链设计模式</h3>\n<ul>\n<li>原型（prototype）</li>\n<li>原型链（__proto__)</li>\n</ul>\n<p>在 js 中，所有函数类型都自带一个属性：prototype，这个属性的值是一个对象，浏览器会为它开辟一个堆内存，而这个堆内存中存在一个属性：contructor，存储当前函数本身</p>\n<p>每一个对象都有__proto__属性，这个属性指向当前所属类的 prototype，如果不能确定是谁的实例就是 Object 实例</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">Array</span>.prototype.constructor === <span class=\"hljs-built_in\">Array</span>; <span class=\"hljs-comment\">//true</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p><a href=\"https://i.niupic.com/images/2020/05/04/7AhG.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://i.niupic.com/images/2020/05/04/7AhG.png\" alt=\"Selection_029\" data-original=\"https://i.niupic.com/images/2020/05/04/7AhG.png\" /></a></p>\n<p>原型链查找机制：</p>\n<p>当我们需要的属性在私有属性空间不存在时，会基于__proto<strong>找到所属类的 prototype，如果不存在则会基于_</strong>proto__继续查找，直到找到为止，否则会抛异常</p>\n<h2 id=\"2-10-this\">2.10 this</h2>\n<h3 id=\"2-10-1-指向总结\">2.10.1 指向总结</h3>\n<ol>\n<li>谁调用指向谁</li>\n<li>没人调用指向 window</li>\n<li>立即执行函数中 this 指向 window</li>\n<li>括号表达式含有多项时 this 为 window，只有一项时候为调用对象</li>\n</ol>\n<h3 id=\"2-10-2-apply-amp-call-amp-bind\">2.10.2 apply &amp; call &amp; bind</h3>\n<h4 id=\"call-的执行原理：\">call 的执行原理：</h4>\n<ol>\n<li>把函数关键字中的 this 替换为 call 方法第一个传递的实参</li>\n<li>把 call 方法第二个和以后的实参获得后，将要操作函数执行，并吧参数给予操作函数</li>\n</ol>\n<p>es3 实现方法大致如下：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">Function</span>.prototype.es3Call = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">context</span>) </span>{<br />  <span class=\"hljs-keyword\">var</span> content = context || <span class=\"hljs-built_in\">window</span>;<br />  content.fn = <span class=\"hljs-built_in\">this</span>;<br />  <span class=\"hljs-keyword\">var</span> args = [];<br />  <span class=\"hljs-comment\">// arguments是类数组对象，遍历之前需要保存长度，过滤出第一个传参</span><br />  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">1</span>, len = <span class=\"hljs-built_in\">arguments</span>.length; i &lt; len; i++) {<br />    <span class=\"hljs-comment\">// 避免object之类传入</span><br />    args.push(<span class=\"hljs-string\">\"arguments[\"</span> + i + <span class=\"hljs-string\">\"]\"</span>);<br />  }<br />  <span class=\"hljs-keyword\">var</span> result = <span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-string\">\"content.fn(\"</span> + args + <span class=\"hljs-string\">\")\"</span>);<br />  <span class=\"hljs-keyword\">delete</span> content.fn;<br />  <span class=\"hljs-keyword\">return</span> result;<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>上面的代码使用了 eval 执行的</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">fn1</span>() </span>{<br />  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">1</span>);<br />}<br /><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">fn2</span>() </span>{<br />  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">2</span>);<br />}<br />fn1.call(fn2); <span class=\"hljs-comment\">//1</span><br />fn1.call.call(fn2); <span class=\"hljs-comment\">//2</span><br /><span class=\"hljs-built_in\">Function</span>.prototype.call(fn1); <span class=\"hljs-comment\">//</span><br /><span class=\"hljs-built_in\">Function</span>.prototype.call.call(fn1); <span class=\"hljs-comment\">//1</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>上面的例子可以看到，</p>\n<p>首先第一个例子相当把 fn 中的 this 变成了 fn2，但是因为 fn1 没有使用 this，所以没有受到影响，直接运行 fn1。</p>\n<p>第二个例子中，首先调用第二个 call，将第一个 call 函数的 this 变为 fn2，并执行了第一个 call 函数，相当于执行了 this()函数</p>\n<p>第三个例子因为 call 只是向原型中的 call 传参，没有调用任何 call，所以不存在返回值</p>\n<p>第四个例子与第二个相同，都是相当于调用了第一个 call 时候执行 this()</p>\n<h4 id=\"apply-的执行原理\">apply 的执行原理</h4>\n<p>apply 与 call 基本相同，只是第二个参数为数组</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">Function</span>.prototype.es3Apply = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">context, arr</span>) </span>{<br />  <span class=\"hljs-keyword\">var</span> ctx = context || <span class=\"hljs-built_in\">window</span>;<br />  ctx.fn = <span class=\"hljs-built_in\">this</span>;<br />  <span class=\"hljs-keyword\">var</span> result;<br />  <span class=\"hljs-keyword\">if</span> (!arr) {<br />    result = ctx.fn();<br />  } <span class=\"hljs-keyword\">else</span> {<br />    <span class=\"hljs-keyword\">var</span> args = [];<br />    <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; arr.length; i++) {<br />      args.push(<span class=\"hljs-string\">\"arr[\"</span> + i + <span class=\"hljs-string\">\"]\"</span>);<br />    }<br />    result = <span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-string\">\"context.fn(\"</span> + args + <span class=\"hljs-string\">\")\"</span>);<br />  }<br />  <span class=\"hljs-keyword\">delete</span> context.fn;<br />  <span class=\"hljs-keyword\">return</span> result;<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h4 id=\"bind\">bind</h4>\n<p>bind 会返回一个新的函数，其中的 this 将会转换为第一个参数，之后的一序列参数会作为传递实参前的参数</p>\n<p>他有以下几个特点：</p>\n<ul>\n<li>bind 可以绑定 this 指向</li>\n<li>bind 可以返回绑定指向后的函数</li>\n<li>如果绑定后的函数被 new 了，则当前函数的 this 就是当前的实例</li>\n<li>new 的对象可以找到原函数的 ptototype</li>\n</ul>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">Function</span>.prototype.es6Bind = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">context, ...rest</span>) </span>{<br />  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-built_in\">this</span> !== <span class=\"hljs-string\">\"function\"</span>) <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>(<span class=\"hljs-string\">\"invalid invoked!\"</span>);<br />  <span class=\"hljs-keyword\">var</span> self = <span class=\"hljs-built_in\">this</span>;<br />  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">F</span>(<span class=\"hljs-params\">...args</span>) </span>{<br />    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span> <span class=\"hljs-keyword\">instanceof</span> F) {<br />      <span class=\"hljs-keyword\">const</span> obj = <span class=\"hljs-keyword\">new</span> self(...rest, ...args);<br />      obj.setPrototypeOf(self.prototype);<br />      <span class=\"hljs-keyword\">return</span> obj;<br />    }<br />    <span class=\"hljs-keyword\">return</span> self.apply(context, rest.concat(args));<br />  };<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"2-10-3-使用-apply-来获取最大值\">2.10.3 使用 apply 来获取最大值</h3>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">//正常方案</span><br /><span class=\"hljs-keyword\">let</span> arr = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">23</span>];<br /><span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-string\">\"Math.max(\"</span> + arr.toString() + <span class=\"hljs-string\">\")\"</span>);<br /><span class=\"hljs-built_in\">Math</span>.max(...arr);<br /><span class=\"hljs-comment\">//apply作为参数的方案</span><br /><span class=\"hljs-built_in\">Math</span>.max.apply(<span class=\"hljs-literal\">null</span>, arr);<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"2-11-优化\">2.11 优化</h2>\n<h2 id=\"2-11-1-DOM-的回流（reflow）和重绘（repaint）\">2.11.1 DOM 的回流（reflow）和重绘（repaint）</h2>\n<p>浏览器渲染页面有以下几个步骤:</p>\n<ol>\n<li>计算 DOM 结构（DOM tree）【仅仅计算结构】</li>\n<li>css 加载</li>\n<li>生成渲染树（render tree）【渲染样式】</li>\n<li>浏览器基于 GPU 开始按照 render tree 对页面进行构建</li>\n</ol>\n<p>重绘：就是当某一个元素的样式进行更改（位置没有更改）浏览器会按照最新样式重新绘制元素</p>\n<p>优化方案：</p>\n<p>​ 当修改多个样式时，可以使用 class 的切换来一次性更改，避免因为多次更改样式造成的重绘对页面性能的影响</p>\n<p>//TODO 后期继续补充</p>\n<h2 id=\"2-12-正则整理\">2.12 正则整理</h2>\n<p>js 正则与其他语言基本相同，此处只整理元字符和常用 API</p>\n<p>应用场景：</p>\n<ol>\n<li>正则匹配</li>\n<li>正则捕获</li>\n</ol>\n<p>正则创建：</p>\n<ol>\n<li><code>let reg = /......./g</code>：字面量方式</li>\n<li><code>let reg = new RegExp(\"^\\\\d+$\", \'g\')</code>：构造函数方式</li>\n</ol>\n<p>正则的元字符：</p>\n<table>\n<thead>\n<tr>\n<th>符号</th>\n<th>表示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\\d</td>\n<td>数字</td>\n</tr>\n<tr>\n<td>\\D</td>\n<td>除数字外所有字母</td>\n</tr>\n<tr>\n<td>\\w</td>\n<td>word 表示数字大小写和下划线</td>\n</tr>\n<tr>\n<td>\\W</td>\n<td>非 word 非数字大小写和下划线</td>\n</tr>\n<tr>\n<td>\\s</td>\n<td>空白字符[ \\t\\v\\n\\r\\f]</td>\n</tr>\n<tr>\n<td>\\S</td>\n<td>非空白字符</td>\n</tr>\n<tr>\n<td>.</td>\n<td>通配符</td>\n</tr>\n</tbody>\n</table>\n<p>正则的量词：</p>\n<table>\n<thead>\n<tr>\n<th>符号</th>\n<th>表示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>?</strong></td>\n<td>{0,1}</td>\n</tr>\n<tr>\n<td><strong>+</strong></td>\n<td>{1,}</td>\n</tr>\n<tr>\n<td><strong>+</strong></td>\n<td>{1,}</td>\n</tr>\n<tr>\n<td><strong>*</strong></td>\n<td>{0,}</td>\n</tr>\n</tbody>\n</table>\n<p>正则的修饰符：</p>\n<table>\n<thead>\n<tr>\n<th>修饰符</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>i</td>\n<td>执行对大小写不敏感匹配</td>\n</tr>\n<tr>\n<td>g</td>\n<td>全局</td>\n</tr>\n<tr>\n<td>m</td>\n<td>执行多行匹配</td>\n</tr>\n</tbody>\n</table>\n<p>正则函数：</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>test(s:string):boolean</td>\n<td>检测一个字符串是否匹配某个模式</td>\n</tr>\n<tr>\n<td>exec(s:string):array</td>\n<td>返回匹配第一个结果数组</td>\n</tr>\n<tr>\n<td>str.seach(reg):number</td>\n<td>返回匹配成功位置</td>\n</tr>\n<tr>\n<td>str.replace(reg, s)</td>\n<td>将匹配位置</td>\n</tr>\n<tr>\n<td>str.match(reg):array</td>\n<td>设置全局匹配所有结果到数组返回</td>\n</tr>\n</tbody>\n</table>\n<p>关于<code>[]</code>与<code>()</code>：</p>\n<ul>\n<li>\n<p>[]：</p>\n<ol>\n<li>一般的元字符都代表本身含义</li>\n<li>中括号中出现两位数，不是两位数，而是两个数字中的任意一个</li>\n</ol>\n</li>\n<li>\n<p>():括内</p>\n<ol>\n<li>改变匹配优先级</li>\n<li>分组捕获：使用 exec 捕获</li>\n<li>分组引用：\\1，\\2&hellip;.. 表示和第 1、n 个分组出现完全相同的内容（一括号一份组）</li>\n</ol>\n</li>\n</ul>\n<p>常用正则：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">//有效数字</span><br /><span class=\"hljs-keyword\">let</span> reg = <span class=\"hljs-regexp\">/^(+|-)?\\d|[1-9]\\d+\\.\\d+?$/</span>;<br /><span class=\"hljs-comment\">//电话号</span><br /><span class=\"hljs-keyword\">let</span> reg = <span class=\"hljs-regexp\">/^1\\d{10}$/</span>;<br /><span class=\"hljs-comment\">//中文姓名   汉字的unicode：[\\u4E00-\\u9FA5]</span><br /><span class=\"hljs-keyword\">let</span> reg = <span class=\"hljs-regexp\">/^[\\u4E00-\\u9FA5]{2,}(&middot;[\\u4E00-\\u9FA5]{2,})?$/</span>;<br /><span class=\"hljs-comment\">//邮箱</span><br /><span class=\"hljs-keyword\">let</span> reg = <span class=\"hljs-regexp\">/^\\w+((-\\w+)|(\\.\\w+))*@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$/</span>;<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>match 与 exec 之间的优缺点：</p>\n<ul>\n<li>match\n<ul>\n<li>设置为全局匹配后可以返回全部内容的分组，而不能匹配所有小正则分组</li>\n<li>match 设置非全局匹配时候，与 exec 效果相同</li>\n</ul>\n</li>\n<li>exec\n<ul>\n<li>exec 执行可以匹配到目标字符串中第一个匹配对象，并返回以 0 号位为大匹配对象 2 号位为小匹配对象的数组</li>\n<li>其中 exec 执行会保存 index，确定下次开始匹配的位置</li>\n<li>可以使用?:阻止分组捕获，只匹配不捕获</li>\n</ul>\n</li>\n<li>test\n<ul>\n<li>如果 reg 设置全局匹配，test 会修改 reg 的 lastIndex 的值，会对匹配产生影响</li>\n</ul>\n</li>\n</ul>\n<p>​</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-03-18 10:01', '2021-03-18 14:23', 1, 4, 47, 0, 'JavaScript', 0, 1, 0);
INSERT INTO `tb_question` VALUES (3, 'DOM&BOM', '<h1 id=\"DOM\">DOM</h1>\n<h2 id=\"1-定义\">1 定义</h2>\n<p>文档对象模型，是可扩展标记语言接口，可以该表网页内容，结构和样式</p>\n<p>分为：文档，元素，节点</p>\n<h2 id=\"2-API\">2 API</h2>\n<h3 id=\"2-1-获取元素\">2.1 获取元素</h3>\n<ul>\n<li>document,getElementById()：返回一个 DOM Element 对象</li>\n<li>document.getElementByTagName()：返回一个获取元素对象集合</li>\n<li>document.getElementByClassName(): HTML5 新增</li>\n<li>document.querySelector(&lsquo;.class&rsquo;)：获取第一个选择对象</li>\n<li>document.querySelectorAll(&lsquo;.class/tag&rsquo;)：获取所有的选择器对象</li>\n<li>docment.body：返回 body 对象</li>\n<li>document.documentElement：返回 html 元素对象</li>\n</ul>\n<h3 id=\"2-2-事件-触发响应的机制\">2.2 事件(触发响应的机制)</h3>\n<h4 id=\"组成\">组成</h4>\n<p>事件源：时间触发对象</p>\n<p>事件类型：如何触发，何时触发</p>\n<p>事件处理程序：通过函数赋值完成</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">//demo：</span><br /><span class=\"hljs-keyword\">var</span> el = <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">\"el\"</span>);<br />el.onclick = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"click\"</span>);<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h4 id=\"事件类型\">事件类型</h4>\n<table>\n<thead>\n<tr>\n<th>onclick</th>\n<th>鼠标点击左键</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>onmouseover</td>\n<td>鼠标经过触发</td>\n</tr>\n<tr>\n<td>onmouseout</td>\n<td>鼠标离开触发</td>\n</tr>\n<tr>\n<td>onfocus</td>\n<td>获得焦点触发</td>\n</tr>\n<tr>\n<td>onblur</td>\n<td>失去焦点触发</td>\n</tr>\n<tr>\n<td>onmousemove</td>\n<td>鼠标移动触发</td>\n</tr>\n<tr>\n<td>onmouseup</td>\n<td>鼠标弹起触发</td>\n</tr>\n<tr>\n<td>onmousedown</td>\n<td>鼠标按下触发</td>\n</tr>\n<tr>\n<td>onmouseover</td>\n<td>鼠标覆盖（冒泡）</td>\n</tr>\n<tr>\n<td>onmouseenter</td>\n<td>鼠标覆盖（不会冒泡）【与 mouseleave 配套】</td>\n</tr>\n<tr>\n<td>onscroll</td>\n<td>滚动事件</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2-3-修改元素内容\">2.3 修改元素内容</h3>\n<ul>\n<li>element.innerText：从起始位置到终止位置内容（不包含 html 标签，空格和换行）【非标准】</li>\n<li>element.innerHTML：包括 html 标签和空格和换行【W3C】</li>\n<li>src，href</li>\n<li>id，alt，title</li>\n</ul>\n<h3 id=\"2-4-修改元素样式\">2.4 修改元素样式</h3>\n<ul>\n<li>element.style（样式采用驼峰命名法）：仅可以获取行内样式</li>\n</ul>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> el = getElementById(<span class=\"hljs-string\">\"el\"</span>);<br />el.onclick = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />  <span class=\"hljs-built_in\">this</span>.style.backgroundColor = <span class=\"hljs-string\">\"pink\"</span>;<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<ul>\n<li>element.className：可以修改或添加类</li>\n<li>标准浏览器：window.getComputedStyle(&ldquo;元素&rdquo;， [伪类，一般为 null])</li>\n<li>IE6-8：获取经过计算的样式：el.currentStyle</li>\n</ul>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">let</span> getCss = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">currentEl, attr</span>) </span>{<br />  <span class=\"hljs-keyword\">if</span> (!(<span class=\"hljs-string\">\"getComputedStyle\"</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">window</span>)) {<br />    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Error</span>(<span class=\"hljs-string\">\"浏览器不兼容\"</span>);<br />  }<br />  <span class=\"hljs-keyword\">let</span> val = <span class=\"hljs-built_in\">window</span>.getComputedStyle(currentEl, <span class=\"hljs-literal\">null</span>);<br />  <span class=\"hljs-keyword\">let</span> reg = <span class=\"hljs-regexp\">/^-?\\d+(\\.\\d+)?(px|rem|em|pt)?$/i</span>;<br />  reg.test(val) ? (val = <span class=\"hljs-built_in\">parseFloat</span>(val)) : <span class=\"hljs-literal\">null</span>;<br />  <span class=\"hljs-keyword\">return</span> val;<br />};<br /><br /><span class=\"hljs-keyword\">let</span> setCss = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">currentEl, obj</span>) </span>{<br />  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> attr <span class=\"hljs-keyword\">in</span> obj) {<br />    <span class=\"hljs-keyword\">if</span> (!obj.hasOwnProperty(attr)) <span class=\"hljs-keyword\">break</span>;<br />    currentEl.style[attr] = obj[attr];<br />  }<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"2-5-操作元素属性\">2.5 操作元素属性</h3>\n<ul>\n<li>el.属性：获取内置属性（class 为 className）</li>\n<li>el.getAttribute(&lsquo;属性&rsquo;)：获取内置属性或自定义属性\n<ul>\n<li>h5 提出自定义属性需要以 data-开头做属性名</li>\n</ul>\n</li>\n<li>el.dataset.属性：h5 获取新增属性方法（只能获取 data-开头属性，以驼峰命名获取）ie11 以上支持</li>\n</ul>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> el = <span class=\"hljs-built_in\">document</span>.querySelector(<span class=\"hljs-string\">\"input\"</span>);<br /><span class=\"hljs-built_in\">console</span>.log(el.getAttribute(<span class=\"hljs-string\">\"attr\"</span>)); <span class=\"hljs-comment\">//attr test</span><br /><span class=\"hljs-built_in\">console</span>.log(el.getAttribute(<span class=\"hljs-string\">\"class\"</span>)); <span class=\"hljs-comment\">//classname</span><br /><span class=\"hljs-built_in\">console</span>.log(el.className); <span class=\"hljs-comment\">//classname</span><br /><span class=\"hljs-built_in\">console</span>.log(el.attr); <span class=\"hljs-comment\">//undefined</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<ul>\n<li>el.setAttribute(&lsquo;key&rsquo;, &lsquo;value&rsquo;)：修改内置或自定义</li>\n</ul>\n<h3 id=\"2-6-表单属性\">2.6 表单属性</h3>\n<ol>\n<li>\n<p>表单中的值通过 value 修改</p>\n</li>\n<li>\n<p>disabled(表单对象是否禁用 true、false)</p>\n</li>\n</ol>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> input = <span class=\"hljs-built_in\">document</span>.querySelector(<span class=\"hljs-string\">\"input\"</span>);<br /><span class=\"hljs-keyword\">var</span> btn = <span class=\"hljs-built_in\">document</span>.querySelector(<span class=\"hljs-string\">\"button\"</span>);<br />btn.onclick = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />  alert(input.value);<br />  input.value = <span class=\"hljs-string\">\"\"</span>;<br />  btn.disabled = <span class=\"hljs-literal\">true</span>;<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<ol start=\"3\">\n<li>通过 type 修改 input 属性（text、password&hellip;）</li>\n</ol>\n<h3 id=\"2-7-节点操作\">2.7 节点操作</h3>\n<h4 id=\"节点属性\">节点属性</h4>\n<p>nodeType，nodeName，nodeValue</p>\n<p>对于节点类型，元素节点 nodeType 为 1，属性节点 nodeType 为 2，文本节点为 3</p>\n<h4 id=\"API\">API</h4>\n<ul>\n<li>el.parentNode：获取与元素最近的父节点</li>\n<li>el.childNodes：获取元素的所有子节点（包含元素节点和文本节点等，使用 nodeType 过滤）</li>\n<li>el.children：获取所有子元素节点（非标准）</li>\n<li>el.firstChild：获取第一个子节点</li>\n<li>el.lastChild：后去最后一个子节点</li>\n<li>el.firstElementChild：获取第一个子元素节点（ie9 以上）</li>\n<li>el.lastElementChild：获取最后一个子元素节点（ie9 以上）</li>\n<li>el.nextSibling：下一个兄弟节点，包含元素或文本节点</li>\n<li>el.previousSibling：上一个兄弟节点</li>\n<li>el.nextElementSibling：下一个元素兄弟节点（ie9 以上）</li>\n<li>el.previousElementSibling：上一个兄弟节点（ie9 以上）</li>\n<li>document.createEelement(&lsquo;节点名&rsquo;)：创建节点，返回一个元素节点对象</li>\n<li>el.appendChild(child)：在节点中追加节点（el 是父级别）</li>\n<li>el.insertBefore(child，attributechildren)：在指定节点前添加元素</li>\n<li>el.removeChild(child)：删除父节点一个子节点</li>\n<li>el.cloneNode()：返回一个 el 节点副本，参数为空或 false 是浅拷贝，true 为深拷贝</li>\n<li>document.write(&lsquo;string&rsquo;)：文档流 会重绘</li>\n</ul>\n<h2 id=\"3-事件\">3 事件</h2>\n<h3 id=\"3-1-注册事件\">3.1 注册事件</h3>\n<p>传统注册事件以 on 开头有的事件</p>\n<ul>\n<li>特点：仅仅支持一个处理函数，后面处理函数将会覆盖前面的处理函数</li>\n</ul>\n<p>方法监听注册方式</p>\n<ul>\n<li>el.addEventListener(type，listener[，useCapture])：IE9 以上支持\n<ul>\n<li>type：事件类型（click，mouseover 等）</li>\n<li>listener：处理函数，事件发生调用</li>\n<li>useCapture：可选，默认为 false，true 表示捕获阶段，false 表示冒泡阶段</li>\n</ul>\n</li>\n<li>attachEvent(eventNameWithOn, callback)：全兼容(非标准)</li>\n</ul>\n<h3 id=\"3-2-事件注销\">3.2 事件注销</h3>\n<p>传统方式解绑</p>\n<ul>\n<li>el.event = null;</li>\n</ul>\n<p>方法监听移除事件</p>\n<ul>\n<li>el.removeEventListener(type, listener[,useCapture])</li>\n</ul>\n<h3 id=\"3-3-DOM-事件流\">3.3 DOM 事件流</h3>\n<p><a href=\"https://kilicmu.github.io/2020/02/28/%E8%AE%A4%E8%AF%86JavaScript%E7%BB%86%E8%8A%82(%E4%B8%8B)/Web%20APIS.assets/Selection_022.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" alt=\"Selection_022\" data-original=\"Web%20APIS.assets/Selection_022.png\" /></a></p>\n<h3 id=\"3-4-事件冒泡\">3.4 事件冒泡</h3>\n<p><strong>有些事件没有冒泡效果，如 onblur，onfocus，onmouseenter，onmouseleave 等</strong></p>\n<p>阻止事件冒泡方法：</p>\n<ul>\n<li>使用<code>e.stopPropagation()</code>函数停止冒泡</li>\n<li>使用<code>e.cancelBubble = true</code>停止传播</li>\n</ul>\n<h3 id=\"3-5-事件对象\">3.5 事件对象</h3>\n<p>事件对象是事件回调的参数，事件对象包含一系列和事件相关数据</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\">el.setEventListener(<span class=\"hljs-string\">\'click\'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">event</span>)</span>{});<br />el.onclick=<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">event</span>)</span>{};<br /><span class=\"hljs-comment\">//ie9以下需要使用</span><br />el.onclick=<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">e</span>)</span>{e = e ||  <span class=\"hljs-built_in\">window</span>.event)};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>常见属性方法：</p>\n<table>\n<thead>\n<tr>\n<th>对象属性</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>e.target</td>\n<td>事件触发对象（标准</td>\n</tr>\n<tr>\n<td>e.srcElement</td>\n<td>事件触发对象（非标准 IE6-8</td>\n</tr>\n<tr>\n<td>e.type</td>\n<td>事件类型（click 等</td>\n</tr>\n<tr>\n<td>e.cancelBubble</td>\n<td>阻止事件冒泡（非标准 ie6-8</td>\n</tr>\n<tr>\n<td>e.returnValue</td>\n<td>阻止默认事件（非标准 ie6-8 使用</td>\n</tr>\n<tr>\n<td>e.preventDefault()</td>\n<td>阻止默认事件不如不让链接跳转</td>\n</tr>\n<tr>\n<td>e.stopPropagation()</td>\n<td>阻止冒泡（标准</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"3-6-事件委托\">3.6 事件委托</h3>\n<p>原理：不给每个子节点添加事件监听器，给父节点添加事件监听器</p>\n<p>优点：提高了事件性能</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> ul = <span class=\"hljs-built_in\">document</span>.querySelector(<span class=\"hljs-string\">\'ul\'</span>);<br />ul.addEventListener(<span class=\"hljs-string\">\'click\'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">e</span>)</span>{<br />  e.target.style.backgroundColor = &ldquo;pink&rdquo;;<br />})<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"3-7-鼠标对象\">3.7 鼠标对象</h3>\n<h4 id=\"鼠标事件应用\">鼠标事件应用</h4>\n<ol>\n<li>禁止鼠标右键菜单</li>\n</ol>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">document</span>.addEventListener(<span class=\"hljs-string\">\"contextmenu\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">e</span>) </span>{<br />  e.preventDefault();<br />});<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<ol start=\"2\">\n<li>禁止选中</li>\n</ol>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">document</span>.addEventListener(<span class=\"hljs-string\">\"selectstart\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">e</span>) </span>{<br />  e.preventDefault();<br />});<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h4 id=\"鼠标事件对象\">鼠标事件对象</h4>\n<table>\n<thead>\n<tr>\n<th>鼠标事件对象</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>e.clientX</td>\n<td>返回鼠标对于浏览器窗口的可视区的 X 坐标</td>\n</tr>\n<tr>\n<td>e.clientY</td>\n<td>返回鼠标对于浏览器可视区 Y</td>\n</tr>\n<tr>\n<td>e.pageX</td>\n<td>返回鼠标对于文档页面的 X 坐标 ie9+支持</td>\n</tr>\n<tr>\n<td>e.pageY</td>\n<td>返回鼠标对于文档页面的 Y 坐标 ie9+支持</td>\n</tr>\n<tr>\n<td>e.screenX</td>\n<td>返回鼠标对于屏幕的 x 坐标</td>\n</tr>\n<tr>\n<td>e.screenY</td>\n<td>返回鼠标对于屏幕的 Y 坐标</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"3-8-键盘事件\">3.8 键盘事件</h3>\n<table>\n<thead>\n<tr>\n<th>键盘事件</th>\n<th>触发条件</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>onkeyup</td>\n<td>某个按键松开触发</td>\n</tr>\n<tr>\n<td>onkeydown</td>\n<td>按键按下触发</td>\n</tr>\n<tr>\n<td>onkeypress</td>\n<td>按键按下触发（不识别功能键）</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"键盘事件对象\">键盘事件对象</h4>\n<table>\n<thead>\n<tr>\n<th>键盘事件对象属性</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>keyCode</td>\n<td>返回键的 ASCII 值</td>\n</tr>\n</tbody>\n</table>\n<p>注意：keyup 与 keydown 不区分大小写，keypress 区分大小写</p>\n<h2 id=\"4-元素偏移量（offset）\">4 元素偏移量（offset）</h2>\n<p>offset 可以动态获取元素的位置（偏移量，大小等）</p>\n<h3 id=\"4-1-常用属性\">4.1 常用属性</h3>\n<table>\n<thead>\n<tr>\n<th>offset 属性</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>el.offsetParent</td>\n<td>返回作为元素带有定位的父级元素，若是没有定位返回 body</td>\n</tr>\n<tr>\n<td>el.offsetTop</td>\n<td>返回元素相对<strong>带有定位</strong>的父级元素上方的偏移</td>\n</tr>\n<tr>\n<td>el.offsetLeft</td>\n<td>返回元素相对带有定位父级元素左边框偏移</td>\n</tr>\n<tr>\n<td>el.offsetWidth</td>\n<td>返回自身包括 padding，边框，内容区域的宽度，返回数值不带单位</td>\n</tr>\n<tr>\n<td>el.offsetHeight</td>\n<td>返回自身包括 padding，边框，内容区域的高度，不带单位</td>\n</tr>\n</tbody>\n</table>\n<p>注意：offset 属性为只读属性，无法更改变元素位置</p>\n<h2 id=\"5-元素可视区（client）\">5 元素可视区（client）</h2>\n<p>client 可以动态得到元素边框大小，元素大小</p>\n<h3 id=\"5-1-常用属性\">5.1 常用属性</h3>\n<table>\n<thead>\n<tr>\n<th>client 系列属性</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>el.clientTop</td>\n<td>返回元素上边框大小</td>\n</tr>\n<tr>\n<td>el.clientLeft</td>\n<td>返回元素左边框大小</td>\n</tr>\n<tr>\n<td>el.clientWidth</td>\n<td>返回包括 padding，内容区的宽度，不含边框，返回数值不带单位</td>\n</tr>\n<tr>\n<td>el.clientHeight</td>\n<td>返回包含 padding，内容区高度，不含边框，返回数值不带单位</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"6-元素滚动区域（scroll）\">6 元素滚动区域（scroll）</h2>\n<p>scroll 系列可以动态得到元素大小，滚动距离</p>\n<h3 id=\"3-6-1-常用属性\">3.6.1 常用属性</h3>\n<table>\n<thead>\n<tr>\n<th>scroll 系列属性</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>el.scrollTop</td>\n<td>返回被卷上去的上侧距离（页面为 window.pageYoffset())</td>\n</tr>\n<tr>\n<td>el.scrollLeft</td>\n<td>返回被卷左侧距离</td>\n</tr>\n<tr>\n<td>el.scrollWidth</td>\n<td>返回自身实际宽度，不含边框</td>\n</tr>\n<tr>\n<td>el.scrollHeight</td>\n<td>返回自身实际高度，不含边框</td>\n</tr>\n</tbody>\n</table>\n<p><a href=\"https://kilicmu.github.io/2020/02/28/%E8%AE%A4%E8%AF%86JavaScript%E7%BB%86%E8%8A%82(%E4%B8%8B)/Web%20APIS.assets/Selection_025.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" alt=\"Selection_025\" data-original=\"Web%20APIS.assets/Selection_025.png\" /></a></p>\n<h1 id=\"BOM\">BOM</h1>\n<h2 id=\"1-window-对象\">1 window 对象</h2>\n<p>浏览器对象模型，为浏览器窗口做交互</p>\n<p><a href=\"https://kilicmu.github.io/2020/02/28/%E8%AE%A4%E8%AF%86JavaScript%E7%BB%86%E8%8A%82(%E4%B8%8B)/Web%20APIS.assets/Selection_023.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" alt=\"Selection_023\" data-original=\"Web%20APIS.assets/Selection_023.png\" /></a></p>\n<h3 id=\"1-1-window-对象常见事件\">1.1 window 对象常见事件</h3>\n<ol>\n<li>窗口加载事件</li>\n</ol>\n<p><code>window.onload=function(){}</code>或<code>window.addEventListener(\"loader\", function(){})</code></p>\n<p>​ 但是有时候图片很多只需要加载 dom 后就执行 js 脚本，可以使用：<code>document.addEventListener(\'DOMContentLoaded\',function(){})</code></p>\n<ol start=\"2\">\n<li>\n<p>window.onresize 事件，窗口尺寸变化事件</p>\n<p>可使用 window.addEventListener(&ldquo;resize&rdquo;， function())</p>\n</li>\n</ol>\n<h3 id=\"1-2-定时器\">1.2 定时器</h3>\n<p>window 提供了两种定时器</p>\n<ol>\n<li>window.setTimeout(callback, time)</li>\n<li>setInterval(callback，time)</li>\n</ol>\n<p>对于定时器，可以取一个名字用来取消定时器：<code>clearTimeout(定时器标识符)</code></p>\n<h3 id=\"1-3-数据存储\">1.3 数据存储</h3>\n<ol>\n<li>\n<p>window.sessionStorage</p>\n<ol>\n<li>生命周期为浏览器窗口</li>\n<li>同一个窗口下数据可共享</li>\n<li>以键值对存储</li>\n</ol>\n<p>API：</p>\n<ul>\n<li>sessionStorage.setItem(key, value);</li>\n<li>sessionStorage.getItem(key, value);</li>\n<li>sessionStorage.removeItem(key);</li>\n<li>sessionStorage.clear()：清除所有数据</li>\n</ul>\n</li>\n<li>\n<p>window.localStorage</p>\n<ol>\n<li>永久生命周期</li>\n<li>多窗口共享</li>\n<li>键值对存储</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"2-location-对象\">2 location 对象</h2>\n<h3 id=\"2-1-属性\">2.1 属性</h3>\n<table>\n<thead>\n<tr>\n<th>属性</th>\n<th>返回值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>location.href</td>\n<td>获取整个 url</td>\n</tr>\n<tr>\n<td>location.host</td>\n<td>&nbsp;</td>\n</tr>\n<tr>\n<td>location.port</td>\n<td>&nbsp;</td>\n</tr>\n<tr>\n<td>location.pathname</td>\n<td>&nbsp;</td>\n</tr>\n<tr>\n<td>location.search</td>\n<td>&nbsp;</td>\n</tr>\n<tr>\n<td>location.hash</td>\n<td>获取片段（#后内容</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2-2-方法\">2.2 方法</h3>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>返回值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>location.assign(url)</td>\n<td>和 href 一样可以跳转页面（记录 hishtory）</td>\n</tr>\n<tr>\n<td>location.replace(url)</td>\n<td>替换当前页面（不记录 history）</td>\n</tr>\n<tr>\n<td>location.reload(url)</td>\n<td>重新加载页面（相当于 f5，如果参数为 true 强制刷新）</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"3-navigator-对象\">3 navigator 对象</h2>\n<p>navigator 对象包含浏览器信息与操作系统信息等</p>\n<table>\n<thead>\n<tr>\n<th>属性</th>\n<th>对象</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>userAgent</td>\n<td>查看浏览器信息</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"4-hishtory-对象\">4 hishtory 对象</h2>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>back()</td>\n<td>回退</td>\n</tr>\n<tr>\n<td>forward()</td>\n<td>前进</td>\n</tr>\n<tr>\n<td>go(number)</td>\n<td>前进后退（1 为前进一个页面，-1 为后退一个页面）</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"5-移动端\">5. 移动端</h1>\n<h2 id=\"5-1-事件\">5.1 事件</h2>\n<table>\n<thead>\n<tr>\n<th>触屏 touch 事件</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>touchstart</td>\n<td>手指触摸到 DOM 元素触发</td>\n</tr>\n<tr>\n<td>touchmove</td>\n<td>手指在 DOM 滑动触发</td>\n</tr>\n<tr>\n<td>touchend</td>\n<td>手指从 DOM 元素移开触发</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"5-2-事件对象\">5.2 事件对象</h2>\n<table>\n<thead>\n<tr>\n<th>触摸列表</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>touches</td>\n<td>正在触摸屏幕的所有手指的列表(touchend 没有)</td>\n</tr>\n<tr>\n<td>targetTouches</td>\n<td>正在触摸当前 DOM 元素上的手指列表(touchend 没有)</td>\n</tr>\n<tr>\n<td>changedTouched</td>\n<td>手指状态发生改变的列表，从无到有，从有到无</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"5-3-特点：\">5.3 特点：</h2>\n<ol>\n<li>\n<p>300ms 延迟问题</p>\n<blockquote>\n<ol>\n<li>\n<p>可以通过使用&lt;meta name=&ldquo;viewport&rdquo; content=&rdquo;user0scalable=no&rdquo;解决 300ms 延迟</p>\n</li>\n<li>\n<p>通过 touch 事件解决延迟：</p>\n<ol>\n<li>记录触摸时间</li>\n<li>离开时间减去触摸时间</li>\n<li>时间小于 150mx 且没有滑动则，定义为点击</li>\n</ol>\n</li>\n<li>\n<p>一个 js 插件：fashclick.js</p>\n</li>\n</ol>\n</blockquote>\n</li>\n<li>\n<p>Swiper 插件</p>\n</li>\n<li>\n<p>移动端视频插件 zy.media.js</p>\n</li>\n<li>\n<p>点击穿透问题</p>\n<blockquote>\n<p>当有一个绝对定位或固定定位元素绑定了 touch 事件，那么覆盖在他之下的具有点击特性的元素也会被触发。</p>\n<p>比如: 有一个遮罩层 A 元素，他的底下有一个链接元素 B. 当这个遮罩层点击之后希望遮罩层消失，真实的状况是这时候点击遮罩层不见的同时会跳转页面。</p>\n</blockquote>\n<p>解决方案：</p>\n<blockquote>\n<p>下层元素不使用点击特性的元素</p>\n</blockquote>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">document</span>.addEventListener(<span class=\"hljs-string\">\"click\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">ev</span>) </span>{<br />  ev.preventDefault();<br />});<br /><span class=\"hljs-built_in\">document</span>.addEventListener(<span class=\"hljs-string\">\"touchstart\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">ev</span>) </span>{<br />  ev.preventDefault();<br />});<br /><br /><span class=\"hljs-comment\">/**</span><br /><span class=\"hljs-comment\"> * 按需加载</span><br /><span class=\"hljs-comment\"> * 添加a标签的点击事件。</span><br /><span class=\"hljs-comment\"> */</span><br />a.addEventListener(<span class=\"hljs-string\">\"touchstart\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">e</span>) </span>{<br />  <span class=\"hljs-built_in\">window</span>.location = <span class=\"hljs-built_in\">this</span>.href;<br />});</code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n</li>\n</ol>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-03-18 10:08', '2021-03-18 10:08', 2, 0, 8, 0, 'JavaScript', 0, 0, 0);
INSERT INTO `tb_question` VALUES (4, '异步机制整理', '<h1 id=\"起因\">起因</h1>\n<p>先看最近遇到的一段代码：</p>\n<p>&nbsp;</p>\n<figure class=\"highlight javascript\">\n<table style=\"height: 479px;\" width=\"555\">\n<tbody>\n<tr>\n<td class=\"code\" style=\"width: 540.929px; text-align: justify;\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">let</span> res = (<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />  <span class=\"hljs-keyword\">let</span> timer;<br />  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">init</span>() </span>{<br />    doit().then(<span class=\"hljs-function\">(<span class=\"hljs-params\">_</span>) =&gt;</span> {<br />      <span class=\"hljs-comment\">//微任务</span><br />      <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"ok\"</span>);<br />      timer &amp;&amp; <span class=\"hljs-built_in\">clearTimeout</span>(timer);<br />    });<br />  }<br />  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">doit</span>() </span>{<br />    timer = <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> {<br />      <span class=\"hljs-comment\">//创建宏任务</span><br />      <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"timeout\"</span>);<br />    }, <span class=\"hljs-number\">0</span>);<br />    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {<br />      <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">1000000</span>; i++); <span class=\"hljs-comment\">//延长微任务时间</span><br />      resolve();<br />    });<br />  }<br />  <span class=\"hljs-keyword\">return</span> {<br />    init,<br />  };<br />})();<br /><br />res.init(); <span class=\"hljs-comment\">//ok</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>这段代码的输出如上所示，虽然事后想明白了，但是当时还是犯了很蠢的问题，所以整理了一下有关于 js 的异步原理的整理。</p>\n<h2 id=\"什么是异步\">什么是异步</h2>\n<blockquote>\n<p>js 作为单线程语言，如果同步执行则会造成非常严重的性能问题，所以在 js 设计中使用了异步机制，异步任务指的是，不进入主线程、而进入&rdquo;任务队列&rdquo;（task queue）的任务，只有&rdquo;任务队列&rdquo;通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。</p>\n</blockquote>\n<h2 id=\"异步执行机制：\">异步执行机制：</h2>\n<p>所有同步任务都在主线程上执行，形成一个执行栈（execution context stack）。</p>\n<p>主线程之外，还存在一个&rdquo;任务队列&rdquo;（task queue）。只要异步任务有了运行结果，在&rdquo;任务队列&rdquo;之中放置一个事件。</p>\n<p>一旦&rdquo;执行栈&rdquo;中的所有同步任务执行完毕，系统就会读取&rdquo;任务队列&rdquo;，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。</p>\n<p>主线程不断重复</p>\n<h2 id=\"Event-Loop\">Event Loop</h2>\n<p>主线程从任务队列中不断读取事件，这个过程是循环不断的，此过程被称为 Event Loop</p>\n<p><a href=\"https://ae01.alicdn.com/kf/H88d770c5fdba4697855f28f31cd8559cP.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://ae01.alicdn.com/kf/H88d770c5fdba4697855f28f31cd8559cP.png\" alt=\"运行机制\" data-original=\"https://ae01.alicdn.com/kf/H88d770c5fdba4697855f28f31cd8559cP.png\" /></a></p>\n<p>在主线程运行时候，产生了堆和栈，其中，栈的代码调用了外部的 API，在任务队列中不断地加入时间，当栈中的代码执行完毕后，主线程会取执行任务队列，一次调用其中的回调函数，执行栈的同步任务总是会在异步任务前执行</p>\n<h2 id=\"宏任务与微任务\">宏任务与微任务</h2>\n<p>对于广义来说，可以定义同步任务和异步任务，但是对于异步还可以有更精细的划分，其中分为<strong>宏任务</strong>与<strong>微任务</strong></p>\n<p>宏任务分类：定时器，整体 script 代码</p>\n<p>微任务定义：Promise(then 的回调)，process.nextTick()</p>\n<p>对于同时存在宏任务和微任务的等待队列，首先会执行微任务，同时这也解释了开头那个问题中的定时器被清理的结果。</p>\n<p>画个图来表示一下：</p>\n<p><a href=\"https://i.niupic.com/images/2020/05/04/7AhE.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://i.niupic.com/images/2020/05/04/7AhE.png\" alt=\"运行机制\" data-original=\"https://i.niupic.com/images/2020/05/04/7AhE.png\" /></a></p>\n<p>对于定时器中的函数，作为宏任务，他的回调顺序是在微任务的回调之后的，这也就造成了定时器的代码无法顺利执行的结果。</p>\n<h2 id=\"Node-中的执行机制\">Node 中的执行机制</h2>\n<p>Node.js 也是单线程的 Event Loop，但是它的运行机制不同于浏览器环境。</p>\n<p><a href=\"https://i.niupic.com/images/2020/05/04/7AhD.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://i.niupic.com/images/2020/05/04/7AhD.png\" alt=\"node运行机制\" data-original=\"https://i.niupic.com/images/2020/05/04/7AhD.png\" /></a></p>\n<ol>\n<li>V8 引擎解析 JS 脚本</li>\n<li>调用 Node API</li>\n<li>libuv 库执行 Node API，同时，将不同任务分配给不同的线程，形成一个时间循环，以异步方式将任务执行结果返回给 V8 引擎</li>\n<li>V8 引擎将结果返还给用户</li>\n</ol>\n<p>其中，Node 中提供了一些特殊的与任务队列有关的 API：process.nextTick 和 setImmediate</p>\n<blockquote>\n<p>process.nextTick 方法可以在当前执行栈的尾部，下一次读取任务队列前触发回调</p>\n<p>setImmediate 方法则是在当前任务队列的尾部添加事件</p>\n</blockquote>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\">process.nextTick(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">A</span>() </span>{<br />  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">1</span>);<br />  process.nextTick(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">B</span>() </span>{<br />    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">2</span>);<br />  });<br />});<br /><br /><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">timeout</span>() </span>{<br />  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"TIMEOUT FIRED\"</span>);<br />}, <span class=\"hljs-number\">0</span>);<br /><span class=\"hljs-comment\">// 1</span><br /><span class=\"hljs-comment\">// 2</span><br /><span class=\"hljs-comment\">// TIMEOUT FIRED</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>如果有多个 process.nextTick 语句（不管它们是否嵌套），将全部在当前&rdquo;执行栈&rdquo;执行。</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\">setImmediate(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">A</span>() </span>{<br />  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">1</span>);<br />  setImmediate(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">B</span>() </span>{<br />    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">2</span>);<br />  });<br />});<br /><br /><span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">timeout</span>() </span>{<br />  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"TIMEOUT FIRED\"</span>);<br />}, <span class=\"hljs-number\">0</span>);<br /><br /><span class=\"hljs-comment\">// 1</span><br /><span class=\"hljs-comment\">// TIMEOUT FIRED</span><br /><span class=\"hljs-comment\">// 2</span><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>我们由此得到了 process.nextTick 和 setImmediate 的一个重要区别：多个 process.nextTick 语句总是在当前&rdquo;执行栈&rdquo;一次执行完，多个 setImmediate 可能则需要多次 loop 才能执行完。事实上，这正是 Node.js 10.0 版添加 setImmediate 方法的原因，否则像下面这样的递归调用 process.nextTick，将会没完没了，主线程根本不会去读取&rdquo;事件队列&rdquo;！</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-03-18 10:13', '2021-03-18 10:15', 1, 0, 13, 0, 'JavaScript', 0, 1, 0);
INSERT INTO `tb_question` VALUES (5, '这是文章', '<p>测试文章</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-03-18 14:03', '2021-03-18 14:03', 1, 0, 5, 0, 'test', 0, 0, 1);
INSERT INTO `tb_question` VALUES (6, ' 详解Promise', '<h2 id=\"Promise-A-规范\">Promise/A+规范</h2>\n<p><a href=\"https://promisesaplus.com/\">Promise/A+文档位置</a></p>\n<p>简单来说是一种被 ES6 采用的 Promise 规范，其实 Promise 的规范有很多，如 Promise/A、Promise/B、Promise/D 等，其中 Promise A+是 Promise A 的升级版</p>\n<p>两个重点：</p>\n<ol>\n<li>一个 Promise 中的当前状态仅可能是 pending，fulfilled，rejected 三者之一，切状态仅能单向从 pending 向其他两种状态转换，不可逆。</li>\n<li>Promise 中的 then 方法可接受两个可选参数作为 Promise 状态改变时的回调，且 then 会返回一个新的 Promise，可以被同一个 Promise 调用多次</li>\n</ol>\n<p>其他方法如：all，catch 等是 ES6 规范，不是 Promise/A+规范</p>\n<h2 id=\"实现\">实现</h2>\n<h3 id=\"骨架\">骨架</h3>\n<p>根据用户的使用方法，构建架构的骨架：</p>\n<figure class=\"highlight js\">\n<table style=\"height: 318px;\" width=\"804\">\n<tbody>\n<tr>\n<td class=\"code\" style=\"width: 790.071px; text-align: justify;\">\n<pre><code class=\"hljs js\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Promise</span> </span>{<br />  <span class=\"hljs-function\"><span class=\"hljs-title\">constructor</span>(<span class=\"hljs-params\">execute</span>)</span> {<br />    <span class=\"hljs-built_in\">this</span>.state = STATES.PENDING;<br />    <span class=\"hljs-built_in\">this</span>.value = <span class=\"hljs-literal\">null</span>;<br />    <span class=\"hljs-built_in\">this</span>.reason = <span class=\"hljs-literal\">null</span>;<br />    <span class=\"hljs-built_in\">this</span>.fullfilledCbs = [];<br />    <span class=\"hljs-built_in\">this</span>.rejectedCbs = [];<br />    <span class=\"hljs-keyword\">const</span> resolve = <span class=\"hljs-function\">() =&gt;</span> {};<br />    <span class=\"hljs-keyword\">const</span> reject = <span class=\"hljs-function\">() =&gt;</span> {};<br />    execute(resolve, reject);<br />  }<br /><br />  <span class=\"hljs-function\"><span class=\"hljs-title\">then</span>(<span class=\"hljs-params\">fullfilledCb, rejectedCb</span>)</span> {<br />    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>();<br />  }<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>先不去考虑各种情况，只是去单纯的实现一不去考虑异步，返回值等条件的结构</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs JavaScript\"><span class=\"hljs-keyword\">const</span> STATE = {<br />  PENDING: <span class=\"hljs-string\">\'PENDING\'</span>,<br />  FULFILLED: <span class=\"hljs-string\">\'FULFILLED\'</span>,<br />  REJECTED: <span class=\"hljs-string\">\'REJECTED\'</span>,<br />}<br /><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Promise</span> </span>{<br />  <span class=\"hljs-function\"><span class=\"hljs-title\">constructor</span>(<span class=\"hljs-params\">execute</span>)</span> {<br />    <span class=\"hljs-built_in\">this</span>.status = STATE.PENDING<br />    <span class=\"hljs-built_in\">this</span>.value = <span class=\"hljs-literal\">null</span><br />    <span class=\"hljs-built_in\">this</span>.reason = <span class=\"hljs-literal\">null</span><br /><br />    <span class=\"hljs-keyword\">let</span> resolve = <span class=\"hljs-function\">(<span class=\"hljs-params\">value</span>) =&gt;</span> {<br />      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.PENDING) {<br />        <span class=\"hljs-built_in\">this</span>.value = value<br />        <span class=\"hljs-built_in\">this</span>.status = STATE.FULFILLED<br />        <span class=\"hljs-built_in\">this</span>.fulfilledCbs.forEach(<span class=\"hljs-function\">(<span class=\"hljs-params\">_i</span>) =&gt;</span> _i())<br />      }<br />    }<br /><br />    <span class=\"hljs-keyword\">let</span> reject = <span class=\"hljs-function\">(<span class=\"hljs-params\">err</span>) =&gt;</span> {<br />      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.PENDING) {<br />        <span class=\"hljs-built_in\">this</span>.reason = err<br />        <span class=\"hljs-built_in\">this</span>.status = STATE.REJECTED<br />        <span class=\"hljs-built_in\">this</span>.rejectedCbs.forEach(<span class=\"hljs-function\">(<span class=\"hljs-params\">_i</span>) =&gt;</span> _i())<br />      }<br />    }<br /><br />    <span class=\"hljs-keyword\">try</span> {<br />      execute(resolve, reject)<br />    } <span class=\"hljs-keyword\">catch</span> (e) {<br />      reject(e)<br />    }<br />  }<br /><br />  <span class=\"hljs-function\"><span class=\"hljs-title\">then</span>(<span class=\"hljs-params\">onFulfilled, onRejected</span>)</span> {<br />    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.FULFILLED) {<br />      onFulfilled(<span class=\"hljs-built_in\">this</span>.value)<br />    } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.REJECTED) {<br />      onRejected(<span class=\"hljs-built_in\">this</span>.reason)<br />    }<br />  }<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>可以看出这个结构还是很清晰的，只需要保存状态然后根据状态去执行响应的处理 then 中的处理函数。</p>\n<p>这里还用几个问题，then 函数需要返回一个新的 Promise，用来支持链式调用，同时还有 return 处理，then 的参数可选等问题。我们接下来一个一个处理。</p>\n<p>首先处理简单的参数可选。</p>\n<h3 id=\"添加参数可选\">添加参数可选</h3>\n<p>可以在 then 的函数执行前加入一段判断，做无参数默认处理</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> onFulfilled !== <span class=\"hljs-string\">\"function\"</span>) {<br />  onFulfilled = <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-built_in\">this</span>.value;<br />}<br /><span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> onRejected !== <span class=\"hljs-string\">\"function\"</span>) {<br />  onRejected = <span class=\"hljs-function\">() =&gt;</span> {<br />    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-built_in\">this</span>.reason;<br />  };<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"兼容异步\">兼容异步</h3>\n<p>添加属性：回调数组</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">this</span>.fulfilledCbs = [];<br /><span class=\"hljs-built_in\">this</span>.rejectedCbs = [];<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>如果是 then 中的函数为异步 resolve/reject，则先不去执行处理状态转换的回调，而是注册入相应的回调数组。等到状态转换后再循环调用这些函数。</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">let</span> resolve = <span class=\"hljs-function\">(<span class=\"hljs-params\">value</span>) =&gt;</span> {<br />  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.PENDING) {<br />     <span class=\"hljs-built_in\">this</span>.value = value<br />     <span class=\"hljs-built_in\">this</span>.status = <span class=\"hljs-string\">\'fulfilled\'</span><br />     <span class=\"hljs-built_in\">this</span>.status = STATE.FULFILLED<br />     <span class=\"hljs-built_in\">this</span>.fulfilledCbs.forEach(<span class=\"hljs-function\">(<span class=\"hljs-params\">_i</span>) =&gt;</span> _i())<br />  }<br />}<br /><br /><span class=\"hljs-keyword\">let</span> reject = <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {<br />  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === <span class=\"hljs-string\">\'pending\'</span>) {<br />    <span class=\"hljs-built_in\">this</span>.value = e<br />    <span class=\"hljs-built_in\">this</span>.status = <span class=\"hljs-string\">\'rejected\'</span><br />  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.PENDING) {<br />    <span class=\"hljs-built_in\">this</span>.reason = e<br />    <span class=\"hljs-built_in\">this</span>.status = STATE.REJECTED<br />    <span class=\"hljs-built_in\">this</span>.rejectedCbs.forEach(<span class=\"hljs-function\">(<span class=\"hljs-params\">_i</span>) =&gt;</span> _i())<br />  }<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>然后我们可以在 then 中添加一个 PANDING 状态处理：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">else</span> {<br />  <span class=\"hljs-comment\">// 处理异步resolve</span><br />  <span class=\"hljs-built_in\">this</span>.fulfilledCbs.push(<span class=\"hljs-function\">() =&gt;</span> onFulfilled(<span class=\"hljs-built_in\">this</span>.value))<br />  <span class=\"hljs-built_in\">this</span>.rejectedCbs.push(<span class=\"hljs-function\">() =&gt;</span> onRejected(<span class=\"hljs-built_in\">this</span>.reason))<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"返回-Promise\">返回 Promise</h3>\n<p>这里我们需要重构 then 函数：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-function\"><span class=\"hljs-title\">then</span>(<span class=\"hljs-params\">onFulfilled, onRejected</span>)</span> {<br />  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> onFulfilled !== <span class=\"hljs-string\">\'function\'</span>) {<br />    onFulfilled = <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-built_in\">this</span>.value<br />  }<br />  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> onRejected !== <span class=\"hljs-string\">\'function\'</span>) {<br />    onRejected = <span class=\"hljs-function\">() =&gt;</span> {<br />      <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-built_in\">this</span>.reason<br />    }<br />  }<br /><br />  <span class=\"hljs-keyword\">const</span> _promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {<br />    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.FULFILLED) {<br />      <span class=\"hljs-comment\">// 为了获取_promise</span><br />      setImmediate(<span class=\"hljs-function\">() =&gt;</span> {<br />        <span class=\"hljs-keyword\">try</span> {<br />          <span class=\"hljs-keyword\">const</span> x = onFulfilled(<span class=\"hljs-built_in\">this</span>.value)<br />          _resolve(_promise, x, resolve, reject)<br />        } <span class=\"hljs-keyword\">catch</span> (e) {<br />          reject(e)<br />        }<br />      })<br />    } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.REJECTED) {<br />      setImmediate(<span class=\"hljs-function\">() =&gt;</span> {<br />        <span class=\"hljs-keyword\">try</span> {<br />          <span class=\"hljs-keyword\">const</span> x = onRejected(<span class=\"hljs-built_in\">this</span>.reason)<br />          _resolve(_promise, x, resolve, reject)<br />        } <span class=\"hljs-keyword\">catch</span> (e) {<br />          reject(e)<br />        }<br />      })<br />    } <span class=\"hljs-keyword\">else</span> {<br />      <span class=\"hljs-built_in\">this</span>.fulfilledCbs.push(<span class=\"hljs-function\">() =&gt;</span> {<br />        setImmediate(<span class=\"hljs-function\">() =&gt;</span> {<br />          <span class=\"hljs-keyword\">try</span> {<br />            <span class=\"hljs-keyword\">const</span> x = onFulfilled(<span class=\"hljs-built_in\">this</span>.value)<br />            _resolve(_promise, x, resolve, reject)<br />          } <span class=\"hljs-keyword\">catch</span> (e) {<br />            reject(e)<br />          }<br />        })<br />      })<br />      <span class=\"hljs-built_in\">this</span>.rejectedCbs.push(<span class=\"hljs-function\">() =&gt;</span> {<br />        setImmediate(<span class=\"hljs-function\">() =&gt;</span> {<br />          <span class=\"hljs-keyword\">try</span> {<br />            <span class=\"hljs-keyword\">const</span> x = onRejected(<span class=\"hljs-built_in\">this</span>.reason)<br />            _resolve(_promise, x, resolve, reject)<br />          } <span class=\"hljs-keyword\">catch</span> (e) {<br />            reject(e)<br />          }<br />        })<br />      })<br />    }<br />  })<br />  <span class=\"hljs-keyword\">return</span> _promise<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>_resolve 是一个对 then 的返回值的处理函数，在 PromiseA+规范中，return 的值会作为当前的 resolve 的实参，下一个 then 第一个参数的形参。此处假设我们已经实现了它。</p>\n<p>_resolve 需要获取到返回的 Promise，但是这个 Promise 我们还没有 new 出来，我把它放在下一轮执行。所以为每一个_resolve 的处理做一个任务转换此处使用了 setImmediate。</p>\n<h3 id=\"处理-then-中的-return\">处理 then 中的 return</h3>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> _resolve = <span class=\"hljs-function\">(<span class=\"hljs-params\">_promise, x, resolve, reject</span>) =&gt;</span> {<br />  <span class=\"hljs-keyword\">let</span> called = <span class=\"hljs-literal\">false</span>;<br />  <span class=\"hljs-keyword\">if</span> (_promise === x) {<br />    <span class=\"hljs-keyword\">return</span> reject(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>(<span class=\"hljs-string\">\"Chaining cycle detected for promise\"</span>));<br />  }<br /><br />  <span class=\"hljs-keyword\">if</span> ((<span class=\"hljs-keyword\">typeof</span> x === <span class=\"hljs-string\">\"object\"</span> &amp;&amp; x != <span class=\"hljs-literal\">null</span>) || <span class=\"hljs-keyword\">typeof</span> x === <span class=\"hljs-string\">\"function\"</span>) {<br />    <span class=\"hljs-keyword\">try</span> {<br />      <span class=\"hljs-keyword\">let</span> then = x.then;<br />      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> then === <span class=\"hljs-string\">\"function\"</span>) {<br />        then.call(<br />          x,<br />          (y) =&gt; {<br />            <span class=\"hljs-keyword\">if</span> (called) <span class=\"hljs-keyword\">return</span>;<br />            called = <span class=\"hljs-literal\">true</span>;<br />            _resolve(_promise, y, resolve, reject);<br />          },<br />          (e) =&gt; {<br />            <span class=\"hljs-keyword\">if</span> (called) <span class=\"hljs-keyword\">return</span>;<br />            called = <span class=\"hljs-literal\">true</span>;<br />            reject(e);<br />          }<br />        );<br />      } <span class=\"hljs-keyword\">else</span> {<br />        resolve(x);<br />      }<br />    } <span class=\"hljs-keyword\">catch</span> (e) {<br />      <span class=\"hljs-keyword\">if</span> (called) <span class=\"hljs-keyword\">return</span>;<br />      called = <span class=\"hljs-literal\">true</span>;<br />      reject(e);<br />    }<br />  } <span class=\"hljs-keyword\">else</span> {<br />    resolve(x);<br />  }<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"汇总\">汇总</h3>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> STATE = {<br />  PENDING: <span class=\"hljs-string\">\"PENDING\"</span>,<br />  FULFILLED: <span class=\"hljs-string\">\"FULFILLED\"</span>,<br />  REJECTED: <span class=\"hljs-string\">\"REJECTED\"</span>,<br />};<br /><br /><span class=\"hljs-keyword\">const</span> _resolve = <span class=\"hljs-function\">(<span class=\"hljs-params\">_promise, x, resolve, reject</span>) =&gt;</span> {<br />  <span class=\"hljs-keyword\">let</span> called = <span class=\"hljs-literal\">false</span>;<br />  <span class=\"hljs-keyword\">if</span> (_promise === x) {<br />    <span class=\"hljs-keyword\">return</span> reject(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>(<span class=\"hljs-string\">\"Chaining cycle detected for promise\"</span>));<br />  }<br /><br />  <span class=\"hljs-keyword\">if</span> ((<span class=\"hljs-keyword\">typeof</span> x === <span class=\"hljs-string\">\"object\"</span> &amp;&amp; x != <span class=\"hljs-literal\">null</span>) || <span class=\"hljs-keyword\">typeof</span> x === <span class=\"hljs-string\">\"function\"</span>) {<br />    <span class=\"hljs-keyword\">try</span> {<br />      <span class=\"hljs-keyword\">let</span> then = x.then;<br />      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> then === <span class=\"hljs-string\">\"function\"</span>) {<br />        then.call(<br />          x,<br />          (y) =&gt; {<br />            <span class=\"hljs-keyword\">if</span> (called) <span class=\"hljs-keyword\">return</span>;<br />            called = <span class=\"hljs-literal\">true</span>;<br />            _resolve(_promise, y, resolve, reject);<br />          },<br />          (e) =&gt; {<br />            <span class=\"hljs-keyword\">if</span> (called) <span class=\"hljs-keyword\">return</span>;<br />            called = <span class=\"hljs-literal\">true</span>;<br />            reject(e);<br />          }<br />        );<br />      } <span class=\"hljs-keyword\">else</span> {<br />        resolve(x);<br />      }<br />    } <span class=\"hljs-keyword\">catch</span> (e) {<br />      <span class=\"hljs-keyword\">if</span> (called) <span class=\"hljs-keyword\">return</span>;<br />      called = <span class=\"hljs-literal\">true</span>;<br />      reject(e);<br />    }<br />  } <span class=\"hljs-keyword\">else</span> {<br />    resolve(x);<br />  }<br />};<br /><br /><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Promise</span> </span>{<br />  <span class=\"hljs-function\"><span class=\"hljs-title\">constructor</span>(<span class=\"hljs-params\">execute</span>)</span> {<br />    <span class=\"hljs-built_in\">this</span>.status = STATE.PENDING;<br />    <span class=\"hljs-built_in\">this</span>.value = <span class=\"hljs-literal\">null</span>;<br />    <span class=\"hljs-built_in\">this</span>.reason = <span class=\"hljs-literal\">null</span>;<br />    <span class=\"hljs-built_in\">this</span>.fulfilledCbs = [];<br />    <span class=\"hljs-built_in\">this</span>.rejectedCbs = [];<br /><br />    <span class=\"hljs-keyword\">let</span> resolve = <span class=\"hljs-function\">(<span class=\"hljs-params\">value</span>) =&gt;</span> {<br />      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.PENDING) {<br />        <span class=\"hljs-built_in\">this</span>.value = value;<br />        <span class=\"hljs-built_in\">this</span>.status = STATE.FULFILLED;<br />        <span class=\"hljs-built_in\">this</span>.fulfilledCbs.forEach(<span class=\"hljs-function\">(<span class=\"hljs-params\">_i</span>) =&gt;</span> _i());<br />      }<br />    };<br /><br />    <span class=\"hljs-keyword\">let</span> reject = <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {<br />      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.PENDING) {<br />        <span class=\"hljs-built_in\">this</span>.reason = e;<br />        <span class=\"hljs-built_in\">this</span>.status = STATE.REJECTED;<br />        <span class=\"hljs-built_in\">this</span>.rejectedCbs.forEach(<span class=\"hljs-function\">(<span class=\"hljs-params\">_i</span>) =&gt;</span> _i());<br />      }<br />    };<br /><br />    <span class=\"hljs-keyword\">try</span> {<br />      execute(resolve, reject);<br />    } <span class=\"hljs-keyword\">catch</span> (e) {<br />      reject(e);<br />    }<br />  }<br /><br />  <span class=\"hljs-function\"><span class=\"hljs-title\">then</span>(<span class=\"hljs-params\">onFulfilled, onRejected</span>)</span> {<br />    <span class=\"hljs-comment\">/** onFulfilled和onRejected都是可选参数 */</span><br />    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> onFulfilled !== <span class=\"hljs-string\">\"function\"</span>) {<br />      onFulfilled = <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-built_in\">this</span>.value;<br />    }<br />    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> onRejected !== <span class=\"hljs-string\">\"function\"</span>) {<br />      onRejected = <span class=\"hljs-function\">() =&gt;</span> {<br />        <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-built_in\">this</span>.reason;<br />      };<br />    }<br /><br />    <span class=\"hljs-keyword\">const</span> _promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {<br />      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.FULFILLED) {<br />        <span class=\"hljs-comment\">// 为了获取_promise</span><br />        setImmediate(<span class=\"hljs-function\">() =&gt;</span> {<br />          <span class=\"hljs-keyword\">try</span> {<br />            <span class=\"hljs-keyword\">const</span> x = onFulfilled(<span class=\"hljs-built_in\">this</span>.value);<br />            _resolve(_promise, x, resolve, reject);<br />          } <span class=\"hljs-keyword\">catch</span> (e) {<br />            reject(e);<br />          }<br />        });<br />      } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.status === STATE.REJECTED) {<br />        setImmediate(<span class=\"hljs-function\">() =&gt;</span> {<br />          <span class=\"hljs-keyword\">try</span> {<br />            <span class=\"hljs-keyword\">const</span> x = onRejected(<span class=\"hljs-built_in\">this</span>.reason);<br />            _resolve(_promise, x, resolve, reject);<br />          } <span class=\"hljs-keyword\">catch</span> (e) {<br />            reject(e);<br />          }<br />        });<br />      } <span class=\"hljs-keyword\">else</span> {<br />        <span class=\"hljs-comment\">// 处理异步resolve/reject</span><br />        <span class=\"hljs-built_in\">this</span>.fulfilledCbs.push(<span class=\"hljs-function\">() =&gt;</span> {<br />          setImmediate(<span class=\"hljs-function\">() =&gt;</span> {<br />            <span class=\"hljs-keyword\">try</span> {<br />              <span class=\"hljs-keyword\">const</span> x = onFulfilled(<span class=\"hljs-built_in\">this</span>.value);<br />              _resolve(_promise, x, resolve, reject);<br />            } <span class=\"hljs-keyword\">catch</span> (e) {<br />              reject(e);<br />            }<br />          });<br />        });<br />        <span class=\"hljs-built_in\">this</span>.rejectedCbs.push(<span class=\"hljs-function\">() =&gt;</span> {<br />          setImmediate(<span class=\"hljs-function\">() =&gt;</span> {<br />            <span class=\"hljs-keyword\">try</span> {<br />              <span class=\"hljs-keyword\">const</span> x = onRejected(<span class=\"hljs-built_in\">this</span>.reason);<br />              _resolve(_promise, x, resolve, reject);<br />            } <span class=\"hljs-keyword\">catch</span> (e) {<br />              reject(e);<br />            }<br />          });<br />        });<br />      }<br />    });<br />    <span class=\"hljs-keyword\">return</span> _promise;<br />  }<br />}<br /><br /><span class=\"hljs-comment\">// 做测试</span><br /><span class=\"hljs-built_in\">Promise</span>.defer = <span class=\"hljs-built_in\">Promise</span>.deferred = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> () </span>{<br />  <span class=\"hljs-keyword\">let</span> dfd = {};<br />  dfd.promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {<br />    dfd.resolve = resolve;<br />    dfd.reject = reject;<br />  });<br />  <span class=\"hljs-keyword\">return</span> dfd;<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p><code>promises-aplus-tests index.js</code></p>\n<p><a href=\"https://i.niupic.com/images/2020/05/24/7Wfv.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://i.niupic.com/images/2020/05/24/7Wfv.png\" alt=\"测试\" data-original=\"https://i.niupic.com/images/2020/05/24/7Wfv.png\" /></a></p>\n<p>项目地址：<a href=\"https://github.com/kilicmu/PromiseDemo\">PromiseDemo</a></p>\n<h2 id=\"其他一些常用方法实现\">其他一些常用方法实现</h2>\n<p>由于标准不同，同样的函数可能有不同的实现，此处的函数可能与部分规范效果不同。</p>\n<p>下面都很简单直接 po 出来代码：</p>\n<p>resolve 的实现：</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-function\"><span class=\"hljs-title\">resolve</span>(<span class=\"hljs-params\">value</span>)</span> {<br />    <span class=\"hljs-keyword\">const</span> _promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {<br />      setImmediate(<span class=\"hljs-function\">() =&gt;</span> _resolve(_promise, value, resolve, reject))<br />    })<br />    <span class=\"hljs-keyword\">return</span> _promise<br />  }<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>reject 的实现：</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-function\"><span class=\"hljs-title\">reject</span>(<span class=\"hljs-params\">e</span>)</span> {<br />    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {<br />      reject(e)<br />    })<br />  }<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>catch 的实现：</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">catch</span>(onRejected) {<br />    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">this</span>.then(<span class=\"hljs-literal\">null</span>, onRejected)<br />  }<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>all 的实现：</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-function\"><span class=\"hljs-title\">all</span>(<span class=\"hljs-params\">promiseArray</span>)</span> {<br />    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {<br />      <span class=\"hljs-keyword\">const</span> length = promiseArray.length<br />      <span class=\"hljs-keyword\">const</span> resultArray = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Array</span>(length)<br />      <span class=\"hljs-keyword\">let</span> count = <span class=\"hljs-number\">0</span><br />      promiseArray.forEach(<span class=\"hljs-function\">(<span class=\"hljs-params\">_i, i</span>) =&gt;</span> {<br />        <span class=\"hljs-built_in\">Promise</span>.resolve(_i).then(<br />          (value) =&gt; {<br />            resultArray[i] = value<br />            <span class=\"hljs-keyword\">if</span> (++count === length) {<br />              resolve(resultArray)<br />            }<br />          },<br />          (e) =&gt; {<br />            reject(e)<br />          }<br />        )<br />      })<br />    })<br />  }<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>finally 的实现：</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs js\"><span class=\"hljs-function\"><span class=\"hljs-title\">finally</span>(<span class=\"hljs-params\">fn</span>)</span> {<br />    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">this</span>.then(<br />      (v) =&gt; {<br />        setImmediate(fn) <span class=\"hljs-comment\">//放在所以then的下一轮执行</span><br />        <span class=\"hljs-keyword\">return</span> v<br />      },<br />      (e) =&gt; {<br />        setImmediate(fn)<br />        <span class=\"hljs-keyword\">throw</span> e<br />      }<br />    )<br />  }<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>以上~</p>', '2021-03-18 14:08', '2021-03-18 14:08', 3, 0, 42, 0, '前端', 0, 0, 0);
INSERT INTO `tb_question` VALUES (34, 'Webpack快速配置', '<h1 id=\"webpack4-x\">webpack4.x</h1>\n<h2 id=\"1-npm-init\">1.<code>npm init</code></h2>\n<h2 id=\"2-创建目录结构\">2. 创建目录结构:</h2>\n<p>| - project</p>\n<p>​ | - dist</p>\n<p>​ | - src</p>\n<p>​ | - main.js</p>\n<p>​ | - index.html</p>\n<h2 id=\"3-安装-webpack-与-webpack-cli\">3. 安装 webpack 与 webpack-cli</h2>\n<p><code>yarn add webpack -dev</code></p>\n<p><code>yarn add webpack-cli -dev</code></p>\n<h2 id=\"4-写-webpack-config-js\">4. 写 webpack.config.js</h2>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs js\">moudle.exports = {<br />  mode: <span class=\"hljs-string\">\"development\"</span>, <span class=\"hljs-comment\">//development不压缩 production压缩</span><br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p><strong>webpack4.x 中约定大于配置，默认打包入口为 src-&gt;index.js，输出为 dist -&gt; main.js</strong></p>\n<h2 id=\"5-添加-webpack-dev-server\">5. 添加 webpack-dev-server</h2>\n<p>在 package.json 添加构建脚本：</p>\n<p>参数：</p>\n<ul>\n<li>&ndash;open [chrome/firefox/iexplore]：打开浏览器</li>\n<li>&ndash;port port：端口号</li>\n<li>&ndash;hot：开启热更新</li>\n<li>&ndash;compress：压缩</li>\n<li>&ndash;host 127.0.0.1：打开域名</li>\n</ul>\n<p><code>&ldquo;dev&rdquo;：\"webpack-dev-server\"</code></p>\n<p>webpack-dev-server 打包文件默认存在项目根目录，存在内存中</p>\n<h2 id=\"6-添加-html-webpack-plugin-插件\">6. 添加 html-webpack-plugin 插件</h2>\n<ol>\n<li>\n<p><code>yarn add html-webpack-plugin -dev</code></p>\n</li>\n<li>\n<p>实例化 html-webpack-plugin 插件：</p>\n</li>\n</ol>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> HtmlWebPackPlugin = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"html-webpack-plugin\"</span>);<br /><br /><span class=\"hljs-keyword\">const</span> htmlPlugin = <span class=\"hljs-keyword\">new</span> HtmlWebPackPlugin({<br />  template: path.join(__dirname, <span class=\"hljs-string\">\"src/index.html\"</span>),<br />  filename: <span class=\"hljs-string\">\"index.html\"</span>, <span class=\"hljs-comment\">//生成内存中首页名称</span><br />});<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<ol start=\"3\">\n<li>在 package.json 中添加插件</li>\n</ol>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs js\">plugins: [htmlPlugin];<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"7-配置-babel：\">7. 配置 babel：</h2>\n<ol>\n<li>运行<code>yarn add babel-core babel-loader babel-plugin-transform-runtime --dev</code></li>\n<li>运行<code>yarn add babel-preset-env babel-preset-stage-0 &ndash;dev</code></li>\n</ol>\n<p>可选：</p>\n<ol start=\"3\">\n<li><code>yarn add babel-preset-react -D</code>支持 jsx 转换</li>\n</ol>\n<p>webpack.config.js 添加 rules：</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs js\"><span class=\"hljs-built_in\">module</span>: {<br />  rules: [{ <span class=\"hljs-attr\">test</span>: <span class=\"hljs-regexp\">/\\.js|.jsx$/</span>, use: <span class=\"hljs-string\">\"babel-loader\"</span>, <span class=\"hljs-attr\">exclude</span>: <span class=\"hljs-regexp\">/node_modules/</span> }];<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>配置.babelrc：</p>\n<figure class=\"highlight json\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs json\">{<br />  <span class=\"hljs-attr\">\"presets\"</span>: [<span class=\"hljs-string\">\"env\"</span>, <span class=\"hljs-string\">\"stage-0\"</span>, <span class=\"hljs-string\">\"react\"</span>],<br />  <span class=\"hljs-attr\">\"plugins\"</span>: [<span class=\"hljs-string\">\"transform-runtime\"</span>]<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"8-配置-resolved\">8. 配置 resolved</h2>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs js\">resolved:{<br />  extensions:[<span class=\"hljs-string\">\'.js\'</span>, <span class=\"hljs-string\">\'.jsx\'</span>, <span class=\"hljs-string\">\'.json\'</span>]<span class=\"hljs-comment\">//表示下列后缀名可省略</span><br />    alias:{<br />        <span class=\"hljs-string\">\'@\'</span>:path.join(__dirname, <span class=\"hljs-string\">\'./src\'</span>)<br />    }<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"9-添加-css-解析\">9. 添加 css 解析</h2>\n<p><code>npm install style-loader css-loader</code></p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs js\"><span class=\"hljs-built_in\">module</span>: {<br />  rules: [<br />    { <span class=\"hljs-attr\">test</span>: <span class=\"hljs-regexp\">/\\.js|.jsx$/</span>, use: <span class=\"hljs-string\">\"babel-loader\"</span>, <span class=\"hljs-attr\">exclude</span>: <span class=\"hljs-regexp\">/node_modules/</span> },<br />    { <span class=\"hljs-attr\">test</span>: <span class=\"hljs-regexp\">/\\.css$/</span>, use: [<span class=\"hljs-string\">\"style-loader\"</span>, <span class=\"hljs-string\">\"css-loader?modules\"</span>] },<br />  ];<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>可以再 css-loaders 中添加中加 modules 来模块化：</p>\n<p><a href=\"https://i.niupic.com/images/2020/05/04/7AhF.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" alt=\"Selection_028\" data-original=\"https://i.niupic.com/images/2020/05/04/7AhF.png\" /></a></p>\n<p>:global(类名)：可以接受所有的</p>\n<p>只针对类选择器和 id 选择器模块化，不会模块化标签选择器</p>\n<p><strong>如果启用第三方模块化，那么我们使用的样式需要用.sass/.less 结尾，而.css 结尾用来处理其他如 bootstrap 库</strong></p>', '2021-03-18 22:10', '2021-03-18 22:10', 3, 0, 6, 1, '前端', 0, 0, 0);
INSERT INTO `tb_question` VALUES (35, '系统开发', '<p>开发之路非常坎坷</p>', '2021-03-24 17:19', '2021-03-24 17:19', 4, 1, 9, 0, 'SpringBoot', 0, 0, 0);
INSERT INTO `tb_question` VALUES (36, '舔狗怎们治理比较好', '<p>辉少我来了，我是你的舔狗啊！！！！！</p>', '2021-03-24 20:40', '2021-03-24 20:40', 10, 2, 6, 0, '舔狗', 0, 0, 1);
INSERT INTO `tb_question` VALUES (37, '一个强大搜索应实现的功能', '<p>select&nbsp; *** from *** where ***=***</p>', '2021-03-25 20:29', '2021-03-25 20:29', 13, 0, 14, 0, '搜索,Java,sql', 0, 0, 1);
INSERT INTO `tb_question` VALUES (81, 'test', '<p><strong>测试</strong></p>\n<p><strong><audio style=\"display: none;\" controls=\"controls\"></audio></strong></p>', '2021-03-25 20:59', '2021-03-25 20:59', 2, 0, 8, 1, 'Java', 0, 0, 0);
INSERT INTO `tb_question` VALUES (82, '规范设计RESTfulAPI', '<section class=\"content\">\n<h2 id=\"如何理解-RESTful-架构？\">如何理解 RESTful 架构？</h2>\n<h3 id=\"特点：\">特点：</h3>\n<ul>\n<li>每一个 URI 代表一种资源</li>\n<li>客户端与服务器之间，传递这种资源的某种表现层</li>\n<li>客户端通过四个 HTTP 动词对服务端资源进行操作</li>\n</ul>\n<h3 id=\"资源\">资源</h3>\n<p><strong>所谓&rdquo;资源&rdquo;，就是网络上的一个实体，或者说是网络上的一个具体信息。</strong></p>\n<p>可以用一个 URI（统一资源定位符）指向它，每种资源对应一个特定的 URI。</p>\n<h3 id=\"表现层\">表现层</h3>\n<p><strong>把&rdquo;资源&rdquo;具体呈现出来的形式，叫做它的&rdquo;表现层&rdquo;</strong>.</p>\n<p>URI 只代表资源的实体，不代表它的形式。应该在 HTTP 请求的头信息中用 Accept 和 Content-Type 字段指定，这两个字段才是对&rdquo;表现层&rdquo;的描述。</p>\n<h3 id=\"状态转化\">状态转化</h3>\n<p>如果客户端想要操作服务器，必须通过某种手段，让服务器端发生&rdquo;状态转化&rdquo;（State Transfer）。而这种转化是建立在表现层之上的，所以就是&rdquo;表现层状态转化&rdquo;。</p>\n<p>是 HTTP 协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。</p>\n<h2 id=\"RESTful-API-设计规范\">RESTful API 设计规范</h2>\n<h3 id=\"1-协议的规范：\">1. 协议的规范：</h3>\n<p>与服务器的通信总是使用 HTTP 协议</p>\n<h3 id=\"2-域名：\">2. 域名：</h3>\n<p>应该吧 API 部署到专属域名上</p>\n<p>如：<code>https://api.kilic.site</code></p>\n<p>若是 API 为简单 API，可以放在主域名下：<code>https://kilic.site/api</code></p>\n<h3 id=\"3-版本：\">3. 版本：</h3>\n<p>将 API 的版本号放入 URL。</p>\n<p>如：<code>https://api.kilic.site/v1</code>;</p>\n<h3 id=\"4-路径：\">4. 路径：</h3>\n<p>每一种路径代表一种资源，所以资源的设计应该是名词（错误示范：我一直都是用动词短语做的〒 ▽ 〒），所用的名词往往与数据库的表格名对应。</p>\n<p>数据库的表一般有多个字段，所以这里的名词需要是负数形式，比如：</p>\n<p><code>https://api.kilic.site/v1/consumers</code></p>\n<p><code>https://api.kilic.site/v1/stores</code></p>\n<h3 id=\"5-HTTP-动词：\">5. HTTP 动词：</h3>\n<p>动词使用 HTTP 请求头的 Method 字段进行表示：</p>\n<ul>\n<li>GET &mdash;&mdash;&gt; SELECT</li>\n<li>POST &mdash;&mdash;&gt; GREATE</li>\n<li>PUT &mdash;&mdash;&gt; UPDATE （客户端提供完整资源）</li>\n<li>PATCH &mdash;&mdash;&gt; UPDATE（客户端提供改变的属性）</li>\n<li>DELETE &mdash;&mdash;&gt; DELETE （删除资源）</li>\n</ul>\n<h3 id=\"6-资源过滤：\">6. 资源过滤：</h3>\n<p>通过 GET 方法的参数指定过滤条件：</p>\n<figure class=\"highlight plain\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\">\n<pre><code class=\"hljs api\">?id=1<br />?limit=10&amp;offset=1<br />?sortby=username<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"7-状态码\">7. 状态码</h3>\n<table>\n<thead>\n<tr>\n<th>状态码</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>200</td>\n<td>服务器资源请求成功</td>\n</tr>\n<tr>\n<td>201</td>\n<td>服务器新建或创建数据成功</td>\n</tr>\n<tr>\n<td>204</td>\n<td>服务器删除资源成功</td>\n</tr>\n<tr>\n<td>400</td>\n<td>对服务器的请求有错误，无操作</td>\n</tr>\n<tr>\n<td>403</td>\n<td>未授权</td>\n</tr>\n<tr>\n<td>404</td>\n<td>资源不存在</td>\n</tr>\n<tr>\n<td>410</td>\n<td>资源被永久删除</td>\n</tr>\n<tr>\n<td>415</td>\n<td>媒体类型错误</td>\n</tr>\n<tr>\n<td>500</td>\n<td>服务器错误</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"8-错误处理\">8. 错误处理</h3>\n<p>对 4XX 系列的状态码，应该在返回信息中封装 error 作为键名</p>\n<figure class=\"highlight json\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs json\">{<br />  <span class=\"hljs-attr\">\"status\"</span>: <span class=\"hljs-number\">404</span>,<br />  <span class=\"hljs-attr\">\"error\"</span>: <span class=\"hljs-string\">\"NOT FOUND\"</span><br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"9-服务器返回规范\">9. 服务器返回规范</h3>\n<p>服务器向用户返回的结果应该符合以下规范。</p>\n<figure class=\"highlight txt\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs txt\">GET /collection：返回资源对象的列表（数组）<br />GET /collection/resource：返回单个资源对象<br />POST /collection：返回新生成的资源对象<br />PUT /collection/resource：返回完整的资源对象<br />PATCH /collection/resource：返回完整的资源对象<br />DELETE /collection/resource：返回一个空文档<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"其他：\">其他：</h3>\n<p>API 的身份认证应该使用<a href=\"http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html\">OAuth 2.0</a>框架。可以看我的一篇 JWT 文章：<a href=\"https://kilicmu.github.io/2020/07/04/%E8%A7%84%E8%8C%83%E8%AE%BE%E8%AE%A1RESTFUL-API/[https://kilicmu.github.io/2020/06/12/JWT%E5%8E%9F%E7%90%86%E4%B8%8ENESTJS%E7%9A%84JWT%E6%96%B9%E6%A1%88/](https://kilicmu.github.io/2020/06/12/JWT%E5%8E%9F%E7%90%86%E4%B8%8ENESTJS%E7%9A%84JWT%E6%96%B9%E6%A1%88/)\">JWT 原理与 Nestjs 的 JWT 方案</a></p>\n<p>服务器返回的数据格式，应该尽量使用 JSON，避免使用 XML。</p>\n<h2 id=\"参考资源\">参考资源</h2>\n<p><a href=\"http://www.ruanyifeng.com/blog/2011/09/restful.html\">理解 RESTful 架构</a></p>\n<p><a href=\"http://www.ruanyifeng.com/blog/2014/05/restful_api.html\">RESTful API 设计指南</a></p>\n</section>\n<section class=\"extra\">\n<ul class=\"copyright\">\n<li><strong>本文作者：</strong>herin</li>\n<li><strong>本文链接：</strong><a href=\"https://kilicmu.github.io/2020/07/04/%E8%A7%84%E8%8C%83%E8%AE%BE%E8%AE%A1RESTFUL-API/index.html\">https://kilicmu.github.io/2020/07/04/%E8%A7%84%E8%8C%83%E8%AE%BE%E8%AE%A1RESTFUL-API/index.html</a></li>\n<li><strong>版权声明：</strong>本博客所有文章均采用<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh\" target=\"_blank\" rel=\"external nofollow noopener\">&nbsp;BY-NC-SA&nbsp;</a>许可协议，转载请注明出处！</li>\n</ul>\n</section>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-04-24 15:37', '2021-04-24 15:37', 1, 0, 6, 0, 'Http', 0, 0, 0);
INSERT INTO `tb_question` VALUES (83, '213', '<p>&nbsp;</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-04-25 16:19', '2021-04-25 16:19', 2, 0, 1, 0, 'Java', 0, 0, 1);
INSERT INTO `tb_question` VALUES (84, '123', '<p>123</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-04-25 16:20', '2021-04-25 16:20', 2, 3, 10, 0, 'Java', 0, 0, 1);
INSERT INTO `tb_question` VALUES (85, 'Redux到底做了什么？', '<section class=\"content\">\n<h2 id=\"objective-为什么写这篇文章？\">objective 为什么写这篇文章？</h2>\n<p>我希望了解一个状态管理工具，而 Redux 是一个比较知名的且比较简洁的状态管理容器。不考虑作者水平存在的争议性，Redux 仍是具有很多值得学习的东西。并且 Redux 的源码很短，<del>可以快速水一篇文章</del>（大雾）。</p>\n<p>这里简单整理一下这个状态管理容器的实现思路。</p>\n<h2 id=\"section1-使用\">section1 使用</h2>\n<p>文档有点多，直接看官网给的例子好了，这里选了一个比较简单的计数器<a href=\"https://github.com/reduxjs/redux/tree/master/examples/counter/src\">demo 地址</a>，这里使用这个例子讲解 redux 的使用。</p>\n<ol>\n<li>\n<p>定义一个 reducer</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> (state = <span class=\"hljs-number\">0</span>, action) =&gt; {<br />  <span class=\"hljs-keyword\">switch</span> (action.type) {<br />    <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">\"INCREMENT\"</span>:<br />      <span class=\"hljs-keyword\">return</span> state + <span class=\"hljs-number\">1</span>;<br />    <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">\"DECREMENT\"</span>:<br />      <span class=\"hljs-keyword\">return</span> state - <span class=\"hljs-number\">1</span>;<br />    <span class=\"hljs-keyword\">default</span>:<br />      <span class=\"hljs-keyword\">return</span> state;<br />  }<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n</li>\n<li>\n<p>使用这个 reducer 来创建一个 store</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> counter <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"./reducers\"</span>;<br /><span class=\"hljs-keyword\">const</span> store = createStore(counter);<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n</li>\n<li>\n<p>通过这个 store 来 dispatch 相应的 action</p>\n<figure class=\"highlight js\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs js\">store.dispatch({ <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">\"INCREMENT\"</span> });<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>上面的使用方法很简单，不考虑 React 中结合使用和比如异步等情况，Redux 的使用非常简洁，并且会给了你一种你上你也行的感觉。</p>\n</li>\n</ol>\n<p>事实上，真的是你上你也行。</p>\n<h2 id=\"section2-我的看法\">section2 我的看法</h2>\n<p>因为我对 React 使用的不算很多，并且少 React 的我也很少接触 Redux 生态。所以，这里说说我对 Redux 的认知，如果不对可以联系我指正。</p>\n<p>从官网第一句：Redux 是 JavaScript 状态容器，提供<strong>可预测化</strong>的状态管理。</p>\n<p>这个可预测性才是 Redux 的核心。</p>\n<p>Redux 通过以下三点实现了数据的可预测化：</p>\n<ul>\n<li>单一数据源（Single Source of Truth）</li>\n<li>数据 readonly，仅可以通过 action 改变</li>\n<li>action 处理后必须返回一个全新的 state（reducer 必须 pure）</li>\n</ul>\n<p>reducer 保持 pure 的优势：</p>\n<ol>\n<li>方便测试</li>\n<li>减少 state 比较开销</li>\n</ol>\n<p>下面开始看代码：</p>\n<h2 id=\"section3-源码\">section3 源码</h2>\n<p>代码位置哈：<a href=\"https://github.com/reduxjs/redux/blob/master/src/createStore.ts\">createStore</a></p>\n<p>一下代码会去掉一些类型标注，可以自己点上面的链接看源码</p>\n<figure class=\"highlight ts\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs ts\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">createStore</span>(<span class=\"hljs-params\">reducer, preloadedState, enhancer</span>) </span>{<br />  <span class=\"hljs-comment\">// 扩展相关与错误处理。。。</span><br />  <span class=\"hljs-keyword\">let</span> currentReducer = reducer;<br />  <span class=\"hljs-keyword\">let</span> currentState = preloadedState <span class=\"hljs-keyword\">as</span> S;<br />  <span class=\"hljs-keyword\">let</span> currentListeners: (<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-built_in\">void</span>)[] | <span class=\"hljs-literal\">null</span> = [];<br />  <span class=\"hljs-keyword\">let</span> nextListeners = currentListeners;<br />  <span class=\"hljs-keyword\">let</span> isDispatching = <span class=\"hljs-literal\">false</span>;<br /><br />  <span class=\"hljs-comment\">/* ... 先省略这部分直接看这个方法返回了什么*/</span><br /><br />  <span class=\"hljs-keyword\">const</span> store = {<br />    dispatch: dispatch <span class=\"hljs-keyword\">as</span> Dispatch&lt;A&gt;,<br />    subscribe,<br />    getState,<br />    replaceReducer,<br />    [$$observable]: observable,<br />  } <span class=\"hljs-keyword\">as</span> unknown;<br /><br />  <span class=\"hljs-keyword\">return</span> store;<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>这里挺容易理解，返回一个带有一些方法的 store，store 中持有单一数据源（state）</p>\n<p>一个个看吧：</p>\n<p>dispatch：</p>\n<figure class=\"highlight ts\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs ts\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">dispatch</span>(<span class=\"hljs-params\">action: A</span>) </span>{<br />  <span class=\"hljs-comment\">/*handle error*/</span><br />  <span class=\"hljs-keyword\">if</span> (isDispatching) {<br />    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Error</span>(<span class=\"hljs-string\">\"Reducers may not dispatch actions.\"</span>);<br />  }<br />  <span class=\"hljs-keyword\">try</span> {<br />    isDispatching = <span class=\"hljs-literal\">true</span>;<br />    currentState = currentReducer(currentState, action);<br />  } <span class=\"hljs-keyword\">finally</span> {<br />    isDispatching = <span class=\"hljs-literal\">false</span>;<br />  }<br /><br />  <span class=\"hljs-keyword\">const</span> listeners = (currentListeners = nextListeners);<br />  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; listeners.length; i++) {<br />    <span class=\"hljs-keyword\">const</span> listener = listeners[i];<br />    listener();<br />  }<br />  <span class=\"hljs-keyword\">return</span> action;<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>这里简单说说 isDispatching，我猜测这个变量应该是用来防止异步的 Reducer 造成数据的混乱。</p>\n<p>然后就是正常的指定 reducer 获取新的 state，执行所有的 listener 回调。</p>\n<p>subscribe：</p>\n<figure class=\"highlight ts\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs ts\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">subscribe</span>(<span class=\"hljs-params\">listener: () =&gt; <span class=\"hljs-built_in\">void</span></span>) </span>{<br />  <span class=\"hljs-keyword\">if</span> (isDispatching) {<br />    <span class=\"hljs-comment\">/*这里防止非reducer前的listener执行错误*/</span><br />    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Error</span>();<br />  }<br /><br />  <span class=\"hljs-keyword\">let</span> isSubscribed = <span class=\"hljs-literal\">true</span>;<br /><br />  ensureCanMutateNextListeners();<br />  nextListeners.push(listener);<br /><br />  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">unsubscribe</span>() </span>{<br />    <span class=\"hljs-keyword\">if</span> (!isSubscribed) {<br />      <span class=\"hljs-keyword\">return</span>;<br />    }<br /><br />    <span class=\"hljs-keyword\">if</span> (isDispatching) {<br />      <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Error</span>();<br />    }<br /><br />    isSubscribed = <span class=\"hljs-literal\">false</span>;<br /><br />    ensureCanMutateNextListeners();<br />    <span class=\"hljs-keyword\">const</span> index = nextListeners.indexOf(listener);<br />    nextListeners.splice(index, <span class=\"hljs-number\">1</span>);<br />    currentListeners = <span class=\"hljs-literal\">null</span>;<br />  };<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>看一下 ensureCanMutateNextListeners:</p>\n<figure class=\"highlight ts\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs ts\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">ensureCanMutateNextListeners</span>() </span>{<br />  <span class=\"hljs-keyword\">if</span> (nextListeners === currentListeners) {<br />    nextListeners = currentListeners.slice();<br />  }<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>这个方法将用于确保 nextListener 与 currentListeners 两个引用指向不会指向同一空间。</p>\n<p>也就是说 nextListeners 相当于一个缓冲区，如果在 dispatch 前 listener 的监听发生变化，则改变 nextListeners 即可，然后在 dispatch 完成调用回调的时候将 currentListeners 指向 nextListeners 空间。然后继续收集 listener 则会在新的 nextListeners 收集。</p>\n<p>再看 replaceReducer：</p>\n<figure class=\"highlight ts\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs ts\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">replaceReducer</span>&lt;<span class=\"hljs-title\">NewState</span>, <span class=\"hljs-title\">NewActions</span> <span class=\"hljs-title\">extends</span> <span class=\"hljs-title\">A</span>&gt;(</span><br /><span class=\"hljs-function\"><span class=\"hljs-params\">  nextReducer: Reducer&lt;NewState, NewActions&gt;</span></span><br /><span class=\"hljs-function\">): <span class=\"hljs-title\">Store</span>&lt;<span class=\"hljs-title\">ExtendState</span>&lt;<span class=\"hljs-title\">NewState</span>, <span class=\"hljs-title\">StateExt</span>&gt;, <span class=\"hljs-title\">NewActions</span>, <span class=\"hljs-title\">StateExt</span>, <span class=\"hljs-title\">Ext</span>&gt; &amp; <span class=\"hljs-title\">Ext</span> </span>{<br />  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> nextReducer !== <span class=\"hljs-string\">\"function\"</span>) {<br />    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Error</span>(<span class=\"hljs-string\">\"Expected the nextReducer to be a function.\"</span>);<br />  }<br /><br />  <span class=\"hljs-comment\">// <span class=\"hljs-doctag\">TODO:</span> do this more elegantly</span><br />  ((currentReducer <span class=\"hljs-keyword\">as</span> unknown) <span class=\"hljs-keyword\">as</span> Reducer&lt;NewState, NewActions&gt;) = nextReducer;<br /><br />  dispatch({ <span class=\"hljs-attr\">type</span>: ActionTypes.REPLACE } <span class=\"hljs-keyword\">as</span> A);<br />  <span class=\"hljs-comment\">// change the type of the store by casting it to the new store</span><br />  <span class=\"hljs-keyword\">return</span> (store <span class=\"hljs-keyword\">as</span> unknown) <span class=\"hljs-keyword\">as</span> Store&lt;<br />    ExtendState&lt;NewState, StateExt&gt;,<br />    NewActions,<br />    StateExt,<br />    Ext<br />  &gt; &amp;<br />    Ext;<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>可以看到这里用新的 reducer 直接替换的老的 reducer。</p>\n</section>\n<section class=\"extra\">\n<ul class=\"copyright\">\n<li><strong>本文作者：</strong>herin</li>\n</ul>\n</section>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-04-28 19:58', '2021-04-28 19:58', 1, 0, 2, 0, '前端', 0, 0, 0);
INSERT INTO `tb_question` VALUES (86, '详解WebSocket', '<h2 id=\"什么是-WebSocket？\">什么是 WebSocket？</h2>\n<p>以下摘自 MDN：</p>\n<blockquote>\n<p>WebSocket 是一种在客户端与<a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/Server\">服务器</a>之间保持<a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/TCP\">TCP</a>长连接的<a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/Protocol\">网络协议</a>，这样它们就可以随时进行信息交换。</p>\n<p>虽然任何客户端或服务器上的应用都可以使用 WebSocket，但原则上还是指<a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/%E6%B5%8F%E8%A7%88%E5%99%A8\">浏览器</a>与服务器之间使用。通过 WebSocket，服务器可以直接向客户端发送数据，而无须客户端周期性的请求服务器，以动态更新数据内容。</p>\n</blockquote>\n<p>简单的说，WebSocket 是一个基于 TCP，复用 HTTP 通路的，用于客户端服务器之间的持久连接的<strong>轻量协议</strong>。</p>\n<h2 id=\"Why-WebSocket？\">Why WebSocket？</h2>\n<p>为啥要有 WebSocket？这是第一接触 WebSocket 的人首先会疑惑的。</p>\n<p>在项目中，一定会遇到这种情景：我们需要去动态去获取服务器的某些资源。如，抢票的信息，订单的状态，最近做的东西也需要从服务器查询状态。</p>\n<p>这时候，在没有 WebSocket 的情况下，我们该怎么做?</p>\n<p><strong>我们可以使用一个 GET 请求，有如下两种情况：</strong></p>\n<pre><code>1. 如果服务器端有新的数据需要传送，就立即把数据发回给客户端，客户端收到数据后，立即再发送GET请求给服务器。\n2. 如果服务器端没有新的数据需要发送，服务器不立即发送回应给服务器，而是把这个请求保持住，等待有新的数据到来时，再来响应这个请求。</code></pre>\n<p><strong>那么这个方法的问题有什么副作用呢？</strong></p>\n<p>HTTP 作为一个很重的协议，一次请求数据量往往很大（通常有 400 多个字节）。但是很多时候，我们只需要传输极少的数据，这时候使用这种协议真是大材小用了。并且若是服务端的更新速度很慢，使用 HTTP 协议数据的往返时间最短时间也有 2RTT 考虑网络拥塞问题，无疑效果是不尽如人意。</p>\n<p>这时候就需要 WebSocket 了。</p>\n<h2 id=\"使用\">使用</h2>\n<p>本文不会过分拘泥于使用，只是简单的举例，具体服务端可以看<a href=\"https://www.npmjs.com/package/ws#sending-and-receiving-text-data\">ws npm</a>，客户端可以看<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket/WebSocket\">WebSocket MDN</a>。</p>\n<p>此处为方便下面的讲解简单写一个例子：</p>\n<p>服务端：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> { Server } = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"ws\"</span>);<br /><span class=\"hljs-keyword\">const</span> wsServer = <span class=\"hljs-keyword\">new</span> Server({<br />  port: <span class=\"hljs-number\">8808</span>,<br />});<br /><br />wsServer.on(<span class=\"hljs-string\">\"connection\"</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">socket</span>) =&gt;</span> {<br />  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"已建立链接\"</span>);<br />  socket.on(<span class=\"hljs-string\">\"message\"</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">msg</span>) =&gt;</span> {<br />    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"服务器获得text消息：\"</span>, msg);<br />    socket.send(<span class=\"hljs-string\">\"你好，客户端\"</span>); <span class=\"hljs-comment\">//使用当前套接字传回消息</span><br />  });<br />});<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>​ 客户端：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\">&lt;script&gt;<br />        <span class=\"hljs-built_in\">window</span>.onload = <span class=\"hljs-function\">() =&gt;</span>{<br />            <span class=\"hljs-keyword\">let</span> uploadBtn = <span class=\"hljs-built_in\">document</span>.querySelector(<span class=\"hljs-string\">\"#upload\"</span>);<br />            <span class=\"hljs-keyword\">let</span> inputArea = <span class=\"hljs-built_in\">document</span>.querySelector(<span class=\"hljs-string\">\"#inputArea\"</span>);<br /><br />            uploadBtn.addEventListener(<span class=\"hljs-string\">\"click\"</span>, <span class=\"hljs-function\">() =&gt;</span> {<br />                <span class=\"hljs-keyword\">let</span> socket = <span class=\"hljs-keyword\">new</span> WebSocket(<span class=\"hljs-string\">\"ws://127.0.0.1:8808\"</span>);<span class=\"hljs-comment\">//注意，使用的是ws协议</span><br />                socket.onopen = <span class=\"hljs-function\">() =&gt;</span> {<br />                    socket.send(inputArea.value);<br />                }<br /><br />                socket.onmessage = <span class=\"hljs-function\">(<span class=\"hljs-params\">event</span>) =&gt;</span> {<br />                    event.returnValue ? <span class=\"hljs-built_in\">console</span>.log(event.data) : <span class=\"hljs-literal\">null</span>;<br />                }<br />            });<br />        }<br />&lt;/script&gt;<br />&lt;input type=<span class=\"hljs-string\">\"text\"</span> id=<span class=\"hljs-string\">\"inputArea\"</span> /&gt;<br />&lt;button id=<span class=\"hljs-string\">\"upload\"</span>&gt;send message&lt;/button&gt;<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>服务端效果图：</p>\n<p>​&nbsp;<a href=\"https://i.niupic.com/images/2020/05/17/7ShK.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://i.niupic.com/images/2020/05/17/7ShK.png\" alt=\"服务端效果图\" data-original=\"https://i.niupic.com/images/2020/05/17/7ShK.png\" /></a></p>\n<p>客户端效果图：</p>\n<p>​&nbsp;<a href=\"https://i.niupic.com/images/2020/05/17/7ShL.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://i.niupic.com/images/2020/05/17/7ShL.png\" alt=\"客户端效果图\" data-original=\"https://i.niupic.com/images/2020/05/17/7ShL.png\" /></a></p>\n<p>很简单，就把讲解写入注释了，此处不再赘述。</p>\n<h2 id=\"分析：\">分析：</h2>\n<p>我们使用浏览器自带的抓包工具，看看建立一个 ws 链接到底都做了些什么？</p>\n<p>我们看一下这个请求头（此处只截取对本文有意义的）：</p>\n<figure class=\"highlight txt\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs txt\">Sec-WebSocket-Key:f4t2h1c6ShhGdc6awSlX+A==<br />Upgrade:\"websocket\"<br />Sec-WebSocket-Version:\"13\"<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>我们可以看到，客户端向服务器发起了一个升级协议的请求，我们的这个请求依然是基于 http 协议发送，其中 Sec-WebSocket-Key 是一个客户端随机生成的字符串，用来验证服务端是否理解 WebSocket 协议。我们后面会去说他的校验方法。</p>\n<p>再看一下响应头：</p>\n<figure class=\"highlight http\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs http\"><span class=\"hljs-meta\">HTTP/1.1</span> <span class=\"hljs-number\">101</span> Switching Protocols<br /><span class=\"hljs-attribute\">Upgrade</span><span class=\"hljs-punctuation\">: </span>websocket<br /><span class=\"hljs-attribute\">Connection</span><span class=\"hljs-punctuation\">: </span>Upgrade<br /><span class=\"hljs-attribute\">Sec-WebSocket-Accept</span><span class=\"hljs-punctuation\">: </span>vIXWy9ERVK8O90X/sgRPi+Ofmgc=<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>可以看到，服务器给出了 101 状态码，表示服务器应客户端升级协议的请求。同时服务器返回了一个 Sec-WebSocket-Accept，他是根据 Sec-WebSocket-Key 算出的校验码。如果这个码正确，则通信会建立，如果不正确，为了安全，那么就拒绝喽。</p>\n<p>总结一下 Sec-WebSocket-Key/Accept 作用大致归纳如下：</p>\n<ol>\n<li>避免服务端收到非法的 websocket 连接（比如 http 客户端不小心请求连接 websocket 服务，此时服务端可以直接拒绝连接）</li>\n<li>确保服务端理解 websocket 连接。因为 ws 握手阶段采用的是 http 协议，因此可能 ws 连接是被一个 http 服务器处理并返回的，此时客户端可以通过 Sec-WebSocket-Key 来确保服务端认识 ws 协议。（并非百分百保险，比如总是存在那么些无聊的 http 服务器，光处理 Sec-WebSocket-Key，但并没有实现 ws 协议。。。）</li>\n<li>用浏览器里发起 ajax 请求，设置 header 时，Sec-WebSocket-Key 以及其他相关的 header 是被禁止的。这样可以避免客户端发送 ajax 请求时，意外请求协议升级（websocket upgrade）</li>\n<li>可以防止反向代理（不理解 ws 协议）返回错误的数据。比如反向代理前后收到两次 ws 连接的升级请求，反向代理把第一次请求的返回给 cache 住，然后第二次请求到来时直接把 cache 住的请求给返回（无意义的返回）。</li>\n<li>Sec-WebSocket-Key 主要目的并不是确保数据的安全性，因为 Sec-WebSocket-Key、Sec-WebSocket-Accept 的转换计算公式是公开的，而且非常简单，最主要的作用是预防一些常见的意外情况（非故意的）。</li>\n</ol>\n<p>既然这个东西这么重要，我们就看看它到底是怎么算的吧：</p>\n<h3 id=\"Sec-WebSocket-Accept-的计算\">Sec-WebSocket-Accept 的计算</h3>\n<p>其实他的计算方法非常的简单，由于只是启到校验的作用，也用不到过于繁琐的加密手段。</p>\n<p>步骤如下：</p>\n<ol>\n<li>获取 Sec-WebSocket-Key</li>\n<li>将 Sec-WebSocket-Key 的值和&rsquo;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&rsquo;, 拼接</li>\n<li>通过 SHA1 算法获取摘要，并转为 base64 字符串</li>\n</ol>\n<p>接下来看一下 ws 源码的处理：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> digest = createHash(<span class=\"hljs-string\">\"sha1\"</span>)<br />  .update(key + GUID)<br />  .digest(<span class=\"hljs-string\">\"base64\"</span>);<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>试验结果：</p>\n<p><a href=\"https://i.niupic.com/images/2020/05/17/7Si5.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://i.niupic.com/images/2020/05/17/7Si5.png\" alt=\"加密结果\" data-original=\"https://i.niupic.com/images/2020/05/17/7Si5.png\" /></a></p>\n<p>没啥问题，我们继续。</p>\n<h2 id=\"WebSocket-数据帧格式\">WebSocket 数据帧格式</h2>\n<p>先上图：</p>\n<p><a href=\"https://i.niupic.com/images/2020/05/17/7SiT.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://i.niupic.com/images/2020/05/17/7SiT.png\" alt=\"帧格式\" data-original=\"https://i.niupic.com/images/2020/05/17/7SiT.png\" /></a></p>\n<p>这是 RFC 文档定义的帧格式。</p>\n<p>我们分析一下：</p>\n<ol>\n<li>\n<p>FIN：用来标记当前数据帧是不是最后一个数据帧</p>\n</li>\n<li>\n<p>RSV1, RSV2, RSV3：占位，用做扩展用途，默认置 0</p>\n</li>\n<li>\n<p>Opcode：用来描述要传递的数据作用</p>\n<p>0x0 denotes a continuation frame 标示当前数据帧为分片的数据帧，也就是当一个消息需要分成多个数据帧来传送的时候，需要将 opcode 设置位 0x0。</p>\n<p>0x1 denotes a text frame 标示当前数据帧传递的内容是文本</p>\n<p>0x2 denotes a binary frame 标示当前数据帧传递的是二进制内容，不要转换成字符串</p>\n<p>0x8 denotes a connection close 标示请求关闭连接</p>\n<p>0x9 denotes a ping 标示 Ping 请求</p>\n<p>0xA denotes a pong 标示 Pong 数据包，当收到 Ping 请求时自动给回一个 Pong</p>\n<p>目前协议中就规定了这么多，0x3<del>0x7 以及 0xB</del>0xF 都是预留作为其它用途的。</p>\n</li>\n<li>\n<p>MASK：一个字节位，标识数据有没有使用掩码，服务端发送给客户端的数据帧<strong>不能使用</strong>掩码，客户端发送给服务端的数据帧<strong>必须使用</strong>掩码。</p>\n</li>\n<li>\n<p>payload len：</p>\n<p>如果数据的长度小于 125 个字节（注意：是字节）则用默认的 7 个 bit 来标示数据的长度。</p>\n<p>如果数据的长度为 126 个字节，则用后面相邻的 2 个字节来保存一个 16bit 位的无符号整数作为数据的长度。</p>\n<p>如果数据的长度大于 126 个字节，则用后面相邻的 8 个字节来保存一个 64bit 位的无符号整数作为数据的长度。</p>\n</li>\n<li>\n<p>Masking-key：数据掩码，如果 MASK 设置位 0，则该部分可以省略</p>\n</li>\n<li>\n<p>Payload data：帧真正要发送的数据</p>\n</li>\n</ol>\n<p>一旦 WebSocket 客户端、服务端建立连接后，后续的操作都是基于数据帧的传递。</p>\n<p>我们可以封装一个数据帧</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">encodeDataFrame</span>(<span class=\"hljs-params\">e</span>) </span>{<br />  <span class=\"hljs-keyword\">var</span> s = [],<br />    o = <span class=\"hljs-keyword\">new</span> Buffer(e.PayloadData),<br />    l = o.length;<br />  s.push((e.FIN &lt;&lt; <span class=\"hljs-number\">7</span>) + e.Opcode);<br />  <span class=\"hljs-comment\">//服务端发送数据永远不使用掩码</span><br />  <span class=\"hljs-keyword\">if</span> (l &lt; <span class=\"hljs-number\">126</span>) s.push(l);<br />  <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (l &lt; <span class=\"hljs-number\">0x10000</span>) s.push(<span class=\"hljs-number\">126</span>, (l &amp; <span class=\"hljs-number\">0xff00</span>) &gt;&gt; <span class=\"hljs-number\">8</span>, l &amp; <span class=\"hljs-number\">0xff</span>);<br />  <span class=\"hljs-keyword\">else</span><br />    s.push(<br />      <span class=\"hljs-number\">127</span>,<br />      <span class=\"hljs-number\">0</span>,<br />      <span class=\"hljs-number\">0</span>,<br />      <span class=\"hljs-number\">0</span>,<br />      <span class=\"hljs-number\">0</span>, <span class=\"hljs-comment\">//8字节数据，前4字节一般没用留空</span><br />      (l &amp; <span class=\"hljs-number\">0xff000000</span>) &gt;&gt; <span class=\"hljs-number\">24</span>,<br />      (l &amp; <span class=\"hljs-number\">0xff0000</span>) &gt;&gt; <span class=\"hljs-number\">16</span>,<br />      (l &amp; <span class=\"hljs-number\">0xff00</span>) &gt;&gt; <span class=\"hljs-number\">8</span>,<br />      l &amp; <span class=\"hljs-number\">0xff</span><br />    );<br />  <span class=\"hljs-keyword\">return</span> Buffer.concat([<span class=\"hljs-keyword\">new</span> Buffer(s), o]);<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h2 id=\"封装一个简单的-WebSocket-服务器\">封装一个简单的 WebSocket 服务器</h2>\n<p>测试驱动开发，先编写测试：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> ws = <span class=\"hljs-keyword\">new</span> WebSocket({<br />  port: <span class=\"hljs-number\">8000</span>,<br />});<br /><br />ws.on(<span class=\"hljs-string\">\"connection\"</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">socket</span>) =&gt;</span> {<br />  socket.on(<span class=\"hljs-string\">\"message\"</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">msg</span>) =&gt;</span> {<br />    <span class=\"hljs-built_in\">console</span>.log(msg);<br />    socket.send(msg);<br />  });<br />});<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>几个工具方法：</p>\n<p>除了上面的封装数据帧方法外还有以下几个方法：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> { createHash } = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"crypto\"</span>);<br /><span class=\"hljs-keyword\">const</span> GUID = <span class=\"hljs-string\">\"258EAFA5-E914-47DA-95CA-C5AB0DC85B11\"</span>;<br /><br /><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getDigest</span>(<span class=\"hljs-params\">key</span>) </span>{<br />  <span class=\"hljs-keyword\">return</span> createHash(<span class=\"hljs-string\">\"sha1\"</span>)<br />    .update(key + GUID)<br />    .digest(<span class=\"hljs-string\">\"base64\"</span>);<br />}<br /><br /><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">unmask</span>(<span class=\"hljs-params\">buffer, mask</span>) </span>{<br />  <span class=\"hljs-keyword\">const</span> length = buffer.length;<br />  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; length; i++) {<br />    buffer[i] ^= mask[i &amp; <span class=\"hljs-number\">3</span>];<br />  }<br />}<br /><br /><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">parseHttpHeader</span>(<span class=\"hljs-params\">header</span>) </span>{<br />  <span class=\"hljs-keyword\">let</span> headerMap = {};<br />  <span class=\"hljs-keyword\">let</span> headerArray = header.split(<span class=\"hljs-string\">\"\\r\\n\"</span>);<br />  headerArray = headerArray.slice(<span class=\"hljs-number\">1</span>, -<span class=\"hljs-number\">2</span>);<br />  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> item <span class=\"hljs-keyword\">of</span> headerArray) {<br />    <span class=\"hljs-keyword\">const</span> [k, v] = item.split(<span class=\"hljs-string\">\": \"</span>);<br />    headerMap[k] = v;<br />  }<br />  <span class=\"hljs-keyword\">return</span> headerMap;<br />}<br /><br /><span class=\"hljs-built_in\">exports</span>.getDigest = getDigest;<br /><span class=\"hljs-built_in\">exports</span>.unmask = unmask;<br /><span class=\"hljs-built_in\">exports</span>.parseHttpHeader = parseHttpHeader;<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>搭建 WebSocket 类的基本骨架：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> EventEmitter = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"events\"</span>);<br /><span class=\"hljs-keyword\">const</span> net = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"net\"</span>);<br /><span class=\"hljs-keyword\">const</span> { parseHttpHeader, getDigest } = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"./utils\"</span>);<br /><span class=\"hljs-keyword\">const</span> { unmask } = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"ws/lib/buffer-util\"</span>);<br /><br /><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WebSocket</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">EventEmitter</span> </span>{<br />  <span class=\"hljs-function\"><span class=\"hljs-title\">constructor</span>(<span class=\"hljs-params\">options</span>)</span> {<br />    <span class=\"hljs-built_in\">super</span>(options);<br />    <span class=\"hljs-built_in\">this</span>.options = options;<br />    <span class=\"hljs-built_in\">this</span>.server = net.createServer(<span class=\"hljs-built_in\">this</span>.listener);<br />    <span class=\"hljs-built_in\">this</span>.server.listen(options.port || <span class=\"hljs-number\">8808</span>);<br />  }<br /><br />  <span class=\"hljs-comment\">/**</span><br /><span class=\"hljs-comment\">   * 服务器的回调</span><br /><span class=\"hljs-comment\">   * <span class=\"hljs-doctag\">@param <span class=\"hljs-type\">{net.Socket}</span> <span class=\"hljs-variable\">socket</span></span></span><br /><span class=\"hljs-comment\">   */</span><br />  listener = <span class=\"hljs-function\">(<span class=\"hljs-params\">socket</span>) =&gt;</span> {<br />    socket.setKeepAlive = <span class=\"hljs-literal\">true</span>;<br />    <span class=\"hljs-comment\">// 为socket添加send方法，可以用这个方法来发送数据</span><br />    socket.send = <span class=\"hljs-function\">(<span class=\"hljs-params\">payloadData</span>) =&gt;</span> {<br />      <span class=\"hljs-comment\">//TODO send方法实现</span><br />    };<br /><br />    socket.on(<span class=\"hljs-string\">\"data\"</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">chunk</span>) =&gt;</span> {<br />      <span class=\"hljs-keyword\">if</span> (chunk.toString().match(<span class=\"hljs-regexp\">/Upgrade: websocket/</span>)) {<br />        <span class=\"hljs-comment\">// 处理协议升级请求</span><br />        <span class=\"hljs-built_in\">this</span>.toUpgradeProtcol(socket, chunk.toString()); <span class=\"hljs-comment\">//TODO 协议升级处理</span><br />      } <span class=\"hljs-keyword\">else</span> {<br />        <span class=\"hljs-comment\">// 处理非协议升级请求</span><br />        <span class=\"hljs-built_in\">this</span>.toHandleMessage(socket, chunk); <span class=\"hljs-comment\">//TODO 非协议升级处理</span><br />      }<br />    });<br />    <span class=\"hljs-comment\">// 触发一个connection事件</span><br />    <span class=\"hljs-built_in\">this</span>.emit(<span class=\"hljs-string\">\"connection\"</span>, socket);<br />  };<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>实现 send 方法：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\">socket.send = <span class=\"hljs-function\">(<span class=\"hljs-params\">payloadData</span>) =&gt;</span> {<br />  <span class=\"hljs-comment\">//TODO send方法实现</span><br />  <span class=\"hljs-keyword\">let</span> opcode;<br />  <span class=\"hljs-keyword\">if</span> (Buffer.isBuffer(payloadData)) {<br />    opcode = <span class=\"hljs-number\">1</span>;<br />  } <span class=\"hljs-keyword\">else</span> {<br />    opcode = <span class=\"hljs-number\">2</span>;<br />    payloadData = Buffer.from(payloadData);<br />  }<br />  <span class=\"hljs-keyword\">const</span> payloadLength = payloadData.length;<br />  <span class=\"hljs-keyword\">const</span> buffer = Buffer.alloc(payloadLength + <span class=\"hljs-number\">2</span>); <span class=\"hljs-comment\">//开辟包括两个请求头字节的空间</span><br />  buffer[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-number\">0b10000000</span> | opcode;<br />  buffer[<span class=\"hljs-number\">1</span>] = <span class=\"hljs-number\">0b00000000</span> | payloadLength;<br />  payloadData.copy(buffer, <span class=\"hljs-number\">2</span>);<br />  <span class=\"hljs-comment\">//传入客户端</span><br />  socket.write(buffer);<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>这里需要注意，数据包的问题。客户端给服务器端发送数据不需要使用掩码，所以只需要使用 2 字节头即可。此处仅仅实现了当数据长度小于 126 的时候的数据格式。</p>\n<p>接下来是升级协议的处理：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\">toUpgradeProtcol = <span class=\"hljs-function\">(<span class=\"hljs-params\">socket, chunk</span>) =&gt;</span> {<br />  <span class=\"hljs-keyword\">const</span> headerMap = parseHttpHeader(chunk);<br />  <span class=\"hljs-keyword\">const</span> SecWebSocketKey = headerMap[<span class=\"hljs-string\">\"Sec-WebSocket-Key\"</span>];<br />  <span class=\"hljs-keyword\">const</span> swa = getDigest(SecWebSocketKey);<br />  <span class=\"hljs-keyword\">if</span> (headerMap[<span class=\"hljs-string\">\"Upgrade\"</span>] === <span class=\"hljs-string\">\"websocket\"</span>) {<br />    <span class=\"hljs-comment\">// 定义响应头</span><br />    <span class=\"hljs-keyword\">const</span> resp = [<br />      <span class=\"hljs-string\">\"HTTP/1.1 101 Switching Protocols\"</span>,<br />      <span class=\"hljs-string\">\"Upgrade: websocket\"</span>,<br />      <span class=\"hljs-string\">\"Connection: Upgrade\"</span>,<br />      <span class=\"hljs-string\">`Sec-WebSocket-Accept: <span class=\"hljs-subst\">${swa}</span>`</span>,<br />      <span class=\"hljs-string\">\"mark: kilic\"</span>,<br />      <span class=\"hljs-string\">\"\\r\\n\"</span>,<br />    ].join(<span class=\"hljs-string\">\"\\r\\n\"</span>);<br />    socket.write(resp);<br />  }<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>没啥好说的，就是简单的响应了协议升级请求。</p>\n<p>然后是普通请求的处理：</p>\n<figure class=\"highlight javascript\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs javascript\">toHandleMessage = <span class=\"hljs-function\">(<span class=\"hljs-params\">socket, chunk</span>) =&gt;</span> {<br />  <span class=\"hljs-comment\">// 拆分数据帧</span><br />  <span class=\"hljs-keyword\">const</span> FIN = (chunk[<span class=\"hljs-number\">0</span>] &amp; <span class=\"hljs-number\">0b10000000</span>) === <span class=\"hljs-number\">0b10000000</span>; <span class=\"hljs-comment\">//判断结束帧</span><br />  <span class=\"hljs-keyword\">const</span> opcode = chunk[<span class=\"hljs-number\">0</span>] &amp; <span class=\"hljs-number\">0b00001111</span>;<br />  <span class=\"hljs-keyword\">const</span> masked = (chunk[<span class=\"hljs-number\">1</span>] &amp; <span class=\"hljs-number\">0b10000000</span>) === <span class=\"hljs-number\">0b10000000</span>;<br />  <span class=\"hljs-keyword\">const</span> payloadLength = chunk[<span class=\"hljs-number\">1</span>] &amp; <span class=\"hljs-number\">0b01111111</span>;<br />  <span class=\"hljs-keyword\">let</span> payloadData;<br />  <span class=\"hljs-keyword\">if</span> (masked) {<br />    <span class=\"hljs-keyword\">const</span> maskingKey = chunk.slice(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">6</span>);<br />    payloadData = chunk.slice(<span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">6</span> + payloadLength);<br />    unmask(payloadData, maskingKey);<br />  } <span class=\"hljs-keyword\">else</span> {<br />    payloadData = chunk.slice(<span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">6</span> + payloadLength);<br />  }<br />  <span class=\"hljs-comment\">//判断当前数据帧是否是结束帧</span><br />  <span class=\"hljs-keyword\">if</span> (FIN) {<br />    <span class=\"hljs-keyword\">switch</span> (opcode) {<br />      <span class=\"hljs-keyword\">case</span> <span class=\"hljs-number\">1</span>:<br />        socket.emit(<span class=\"hljs-string\">\"message\"</span>, payloadData.toString(<span class=\"hljs-string\">\"utf8\"</span>));<br />        <span class=\"hljs-keyword\">break</span>;<br />      <span class=\"hljs-keyword\">case</span> <span class=\"hljs-number\">2</span>:<br />        socket.emit(<span class=\"hljs-string\">\"message\"</span>, payloadData);<br />        <span class=\"hljs-keyword\">break</span>;<br />      <span class=\"hljs-keyword\">default</span>:<br />        <span class=\"hljs-comment\">//TODO 其他情况略</span><br />        <span class=\"hljs-keyword\">break</span>;<br />    }<br />  }<br />};<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>这样基本就可以使用了<code>node websocketTest.js</code></p>\n<p>服务端：</p>\n<p><a href=\"https://i.niupic.com/images/2020/05/18/7Sud.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://i.niupic.com/images/2020/05/18/7Sud.png\" alt=\"服务端数据\" data-original=\"https://i.niupic.com/images/2020/05/18/7Sud.png\" /></a></p>\n<p>客户端：</p>\n<p><a href=\"https://i.niupic.com/images/2020/05/18/7Sue.png\" data-fancybox=\"images\"><img class=\"lazyload\" src=\"https://i.niupic.com/images/2020/05/18/7Sue.png\" alt=\"客户端数据\" data-original=\"https://i.niupic.com/images/2020/05/18/7Sue.png\" /></a></p>\n<p>以上！</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-04-28 20:01', '2021-04-28 20:01', 11, 0, 3, 0, 'Http', 0, 0, 0);
INSERT INTO `tb_question` VALUES (87, '我的第一篇文章', '<p>啦啦啦啦啦</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-04-28 20:06', '2021-04-28 20:06', 15, 0, 9, 0, 'test', 0, 0, 0);
INSERT INTO `tb_question` VALUES (88, '1', '<p>123</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-05-01 00:42', '2021-05-01 00:42', 1, 0, 1, 0, 'Java', 0, 0, 1);
INSERT INTO `tb_question` VALUES (89, '测试文章', '<p>大sb</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-05-01 01:36', '2021-05-01 01:36', 1, 0, 0, 0, 'Java', 0, 0, 0);
INSERT INTO `tb_question` VALUES (90, '真没问题、哈哈哈', '<p>test</p>', '2021-05-01 01:41', '2021-05-01 18:22', 1, 2, 50, 0, 'C++', 0, 0, 0);
INSERT INTO `tb_question` VALUES (91, '常用排序算法总结', '<h2 id=\"冒泡排序\">冒泡排序</h2>\n<p>这个就很常见了，很多人接触的第一个排序算法。</p>\n<h3 id=\"算法描述：\">算法描述：</h3>\n<ol>\n<li>比较两个相邻元素，如果与目标排序方向相反则交换他们</li>\n<li>对每一对元素执行一样的操作，直到最后一对，它是这组元素的极值</li>\n<li>对除了极值以外的其他值重复上述步骤，循环执行</li>\n</ol>\n<h3 id=\"代码实现\">代码实现</h3>\n<figure class=\"highlight go\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs go\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">BubbleSort</span><span class=\"hljs-params\">(array []<span class=\"hljs-keyword\">int</span>)</span> []<span class=\"hljs-title\">int</span></span> {<br />  <span class=\"hljs-keyword\">for</span> i:= <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-built_in\">len</span>(array) - <span class=\"hljs-number\">1</span>; i++ {<br />    <span class=\"hljs-keyword\">for</span> j := <span class=\"hljs-number\">0</span>; j &lt; <span class=\"hljs-built_in\">len</span>(array) - i - <span class=\"hljs-number\">1</span>; j++ {<br />      <span class=\"hljs-keyword\">if</span>(array[j] &gt; array[j + <span class=\"hljs-number\">1</span>]){<br />        array[j], array[j + <span class=\"hljs-number\">1</span>] = array[j + <span class=\"hljs-number\">1</span>], array[j]<br />      }<br />    }<br />  }<br />  <span class=\"hljs-keyword\">return</span> array;<br />}<br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<h3 id=\"时间复杂度：\">时间复杂度：</h3>\n<p>最好： O(n)</p>\n<p>最坏：O(n<sup>2</sup>)</p>\n<p>平均：O(n<sup>2</sup>)</p>\n<h3 id=\"空间复杂度\">空间复杂度</h3>\n<p>O(1)</p>\n<h3 id=\"稳定性\">稳定性</h3>\n<p>稳定</p>\n<h2 id=\"插入排序\">插入排序</h2>\n<p>插入排序是一种很符合排序直觉的排序方法，他的实现也是否简单</p>\n<h3 id=\"算法描述\">算法描述</h3>\n<ol>\n<li>从第一个元素开始，认定这个元素已经被排序</li>\n<li>用下一个元素与所有已被排序元素扫描（从后到前）</li>\n<li>如果已排序元素大于/小于新元素，则将这个元素后移</li>\n<li>重复 3 直到正确位置</li>\n<li>将元素插入</li>\n<li>while 2-5</li>\n</ol>\n<h3 id=\"代码实现-1\">代码实现</h3>\n<figure class=\"highlight go\">\n<table>\n<tbody>\n<tr>\n<td class=\"code\" style=\"text-align: justify;\">\n<pre><code class=\"hljs go\"><span class=\"hljs-comment\">//从小-&gt;大排序</span><br /><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">InsertionSort</span><span class=\"hljs-params\">(array []<span class=\"hljs-keyword\">int</span>)</span> []<span class=\"hljs-title\">int</span></span> {<br />  <span class=\"hljs-keyword\">for</span> i := <span class=\"hljs-number\">1</span>; i &lt; <span class=\"hljs-built_in\">len</span>(array); i++ { <span class=\"hljs-comment\">//从0开始假设前面的元素都已经排序</span><br />    current := array[i]<br />    j := i - <span class=\"hljs-number\">1</span><br />    <span class=\"hljs-keyword\">for</span> ; j &gt;= <span class=\"hljs-number\">0</span> &amp;&amp; current &lt; array[j]; j-- {<br />      array[j+<span class=\"hljs-number\">1</span>] = array[j]<br />    }<br />    array[j+<span class=\"hljs-number\">1</span>] = current<br />  }<br />  <span class=\"hljs-keyword\">return</span> array<br />}<br /><br /></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>时间复杂度：</p>\n<h3 id=\"时间复杂度：-1\">时间复杂度：</h3>\n<p>最好： O(n)</p>\n<p>最坏：O(n<sup>2</sup>)</p>\n<p>平均：O(n<sup>2</sup>)</p>\n<h3 id=\"空间复杂度-1\">空间复杂度</h3>\n<p>O(1)</p>\n<h3 id=\"稳定性-1\">稳定性</h3>\n<p>稳定</p>\n<h2 id=\"希尔排序\">希尔排序</h2>\n<p>希尔排序是在插入排序基础上的改编，希尔排序又叫<strong>缩小增量排序</strong>。</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-05-01 01:47', '2021-05-01 01:47', 11, 0, 7, 0, '排序', 1, 1, 0);
INSERT INTO `tb_question` VALUES (92, 'test', '<p>123</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-05-03 19:56', '2021-05-03 19:56', 1, 0, 0, 0, 'Java', 0, 0, 0);
INSERT INTO `tb_question` VALUES (93, '123', '<p>123</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-05-03 19:57', '2021-05-03 19:57', 1, 0, 0, 0, 'Java', 0, 0, 0);
INSERT INTO `tb_question` VALUES (94, '1234', '<p>123</p>\n<p><audio style=\"display: none;\" controls=\"controls\"></audio></p>', '2021-05-03 19:59', '2021-05-03 19:59', 1, 0, 0, 0, 'Java', 1, 0, 0);

-- ----------------------------
-- Table structure for tb_question_ding
-- ----------------------------
DROP TABLE IF EXISTS `tb_question_ding`;
CREATE TABLE `tb_question_ding`  (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `q_id` int(11) NOT NULL COMMENT '问题id',
  `end_time` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL COMMENT '置顶结束时间',
  `status` int(11) NOT NULL COMMENT '状态 0-正常 1-不查询',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 3 CHARACTER SET = latin1 COLLATE = latin1_swedish_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_question_ding
-- ----------------------------
INSERT INTO `tb_question_ding` VALUES (1, 93, '2021-05-03 20:09', 1);
INSERT INTO `tb_question_ding` VALUES (2, 94, '2021-05-03 20:10', 0);

-- ----------------------------
-- Table structure for tb_question_report
-- ----------------------------
DROP TABLE IF EXISTS `tb_question_report`;
CREATE TABLE `tb_question_report`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增ID',
  `user_id` int(11) NOT NULL COMMENT '举报用户ID',
  `r_user_id` int(11) NOT NULL COMMENT '被举报用户ID',
  `r_question_id` int(11) NOT NULL COMMENT '被举报问题ID',
  `report_reason` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '举报理由',
  `is_process` int(1) NOT NULL COMMENT '是否已处理，0-否，1-同意，2-驳回',
  `process_result` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '处理结果判决',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 10 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_question_report
-- ----------------------------
INSERT INTO `tb_question_report` VALUES (2, 3, 1, 5, '水文', 1, '同意该举报请求,扣除积分');
INSERT INTO `tb_question_report` VALUES (3, 1, 1, 1, '举报一下试试， 没啥问题', 2, '该举报请求已驳回');
INSERT INTO `tb_question_report` VALUES (4, 3, 1, 2, 'test\n', 2, '该举报请求已驳回');
INSERT INTO `tb_question_report` VALUES (5, 4, 1, 2, '涉嫌违法', 2, '该举报请求已驳回');
INSERT INTO `tb_question_report` VALUES (6, 11, 10, 36, '垃圾文章', 1, '同意该举报请求,扣除积分');
INSERT INTO `tb_question_report` VALUES (7, 1, 2, 81, '水文', 0, '暂未处理');
INSERT INTO `tb_question_report` VALUES (8, 1, 2, 84, '水', 1, '同意该举报请求,扣除积分');
INSERT INTO `tb_question_report` VALUES (9, 15, 2, 84, '123', 1, '同意该举报请求,扣除积分');

-- ----------------------------
-- Table structure for tb_question_tag
-- ----------------------------
DROP TABLE IF EXISTS `tb_question_tag`;
CREATE TABLE `tb_question_tag`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `tag_id` int(11) NOT NULL COMMENT '标签对应的ID',
  `question_id` int(11) NULL DEFAULT NULL COMMENT '问题对应的ID',
  `status` int(11) NULL DEFAULT 0 COMMENT '0-正常，1-问题已经删除',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 120 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_question_tag
-- ----------------------------
INSERT INTO `tb_question_tag` VALUES (1, 12, 1, 0);
INSERT INTO `tb_question_tag` VALUES (2, 4, 2, 0);
INSERT INTO `tb_question_tag` VALUES (3, 4, 3, 0);
INSERT INTO `tb_question_tag` VALUES (4, 4, 4, 0);
INSERT INTO `tb_question_tag` VALUES (5, 29, 5, 1);
INSERT INTO `tb_question_tag` VALUES (6, 29, 5, 1);
INSERT INTO `tb_question_tag` VALUES (7, 30, 6, 0);
INSERT INTO `tb_question_tag` VALUES (8, 30, 6, 0);
INSERT INTO `tb_question_tag` VALUES (9, 30, 34, 0);
INSERT INTO `tb_question_tag` VALUES (10, 8, 35, 0);
INSERT INTO `tb_question_tag` VALUES (11, 31, 36, 1);
INSERT INTO `tb_question_tag` VALUES (12, 31, 36, 1);
INSERT INTO `tb_question_tag` VALUES (13, 32, 37, 1);
INSERT INTO `tb_question_tag` VALUES (14, 33, 37, 1);
INSERT INTO `tb_question_tag` VALUES (15, 32, 37, 1);
INSERT INTO `tb_question_tag` VALUES (16, 1, 37, 1);
INSERT INTO `tb_question_tag` VALUES (17, 33, 37, 1);
INSERT INTO `tb_question_tag` VALUES (104, 1, 81, 0);
INSERT INTO `tb_question_tag` VALUES (105, 34, 82, 0);
INSERT INTO `tb_question_tag` VALUES (106, 34, 82, 0);
INSERT INTO `tb_question_tag` VALUES (107, 1, 83, 1);
INSERT INTO `tb_question_tag` VALUES (108, 1, 84, 1);
INSERT INTO `tb_question_tag` VALUES (109, 30, 85, 0);
INSERT INTO `tb_question_tag` VALUES (110, 34, 86, 0);
INSERT INTO `tb_question_tag` VALUES (111, 29, 87, 0);
INSERT INTO `tb_question_tag` VALUES (112, 1, 88, 1);
INSERT INTO `tb_question_tag` VALUES (113, 1, 89, 0);
INSERT INTO `tb_question_tag` VALUES (114, 3, 90, 0);
INSERT INTO `tb_question_tag` VALUES (115, 35, 91, 0);
INSERT INTO `tb_question_tag` VALUES (116, 35, 91, 0);
INSERT INTO `tb_question_tag` VALUES (117, 1, 92, 0);
INSERT INTO `tb_question_tag` VALUES (118, 1, 93, 0);
INSERT INTO `tb_question_tag` VALUES (119, 1, 94, 0);

-- ----------------------------
-- Table structure for tb_social_user
-- ----------------------------
DROP TABLE IF EXISTS `tb_social_user`;
CREATE TABLE `tb_social_user`  (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `u_id` int(11) NOT NULL COMMENT '系统用户id',
  `uuid` varchar(64) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL COMMENT '第三方系统的唯一ID',
  `source` varchar(64) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL COMMENT '第三方用户来源',
  `access_token` varchar(64) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL COMMENT '用户的授权令牌',
  `is_open` int(11) NOT NULL DEFAULT 0 COMMENT '是否创建用户了',
  `disable` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否禁用',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 5 CHARACTER SET = latin1 COLLATE = latin1_swedish_ci COMMENT = '第三方平台授权用户' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_social_user
-- ----------------------------
INSERT INTO `tb_social_user` VALUES (1, 2, '5657486', 'GITEE', 'a4dd03736ccfefa76b062e68b16eb5b4', 1, b'0');
INSERT INTO `tb_social_user` VALUES (2, 3, '52077234', 'GITHUB', 'b08a9b5acb19be40a2785fd2fa980c4bc7cf9bbe', 1, b'0');
INSERT INTO `tb_social_user` VALUES (3, 4, '7777987', 'GITEE', 'b388fa5989bc36d2fb95b3866dd87f22', 1, b'0');
INSERT INTO `tb_social_user` VALUES (4, 10, '7715387', 'GITEE', '90fd6d101bdd64bf47104621b78fcf35', 1, b'0');

-- ----------------------------
-- Table structure for tb_tags
-- ----------------------------
DROP TABLE IF EXISTS `tb_tags`;
CREATE TABLE `tb_tags`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `tags_name` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '标签名',
  `category_id` int(11) NOT NULL COMMENT '对应的分类ID',
  `is_origin_tag` int(1) NOT NULL COMMENT '是否为默认标签',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 36 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_tags
-- ----------------------------
INSERT INTO `tb_tags` VALUES (1, 'Java', 1, 1);
INSERT INTO `tb_tags` VALUES (2, 'Python', 1, 1);
INSERT INTO `tb_tags` VALUES (3, 'C++', 1, 1);
INSERT INTO `tb_tags` VALUES (4, 'JavaScript', 1, 1);
INSERT INTO `tb_tags` VALUES (5, 'PHP', 1, 1);
INSERT INTO `tb_tags` VALUES (6, 'Golang', 1, 1);
INSERT INTO `tb_tags` VALUES (7, 'SSM', 2, 1);
INSERT INTO `tb_tags` VALUES (8, 'SpringBoot', 2, 1);
INSERT INTO `tb_tags` VALUES (9, 'Flask', 2, 1);
INSERT INTO `tb_tags` VALUES (10, 'ThinkPHP', 2, 1);
INSERT INTO `tb_tags` VALUES (11, 'Laravel', 2, 1);
INSERT INTO `tb_tags` VALUES (12, 'Django', 2, 1);
INSERT INTO `tb_tags` VALUES (13, 'Ubuntu', 3, 1);
INSERT INTO `tb_tags` VALUES (14, 'CentOS', 3, 1);
INSERT INTO `tb_tags` VALUES (15, 'Windows Server', 3, 1);
INSERT INTO `tb_tags` VALUES (16, 'MySQL', 4, 1);
INSERT INTO `tb_tags` VALUES (17, 'Oracle', 4, 1);
INSERT INTO `tb_tags` VALUES (18, 'H2', 4, 1);
INSERT INTO `tb_tags` VALUES (19, 'MongoDB', 4, 1);
INSERT INTO `tb_tags` VALUES (20, 'PostgreSQL', 4, 1);
INSERT INTO `tb_tags` VALUES (21, 'Redis', 4, 1);
INSERT INTO `tb_tags` VALUES (22, 'IntelliJ IDEA', 5, 1);
INSERT INTO `tb_tags` VALUES (23, 'Eclipse', 5, 1);
INSERT INTO `tb_tags` VALUES (24, 'PyCharm', 5, 1);
INSERT INTO `tb_tags` VALUES (25, 'GoLand', 5, 1);
INSERT INTO `tb_tags` VALUES (26, 'PhpStorm', 5, 1);
INSERT INTO `tb_tags` VALUES (27, 'CLion', 5, 1);
INSERT INTO `tb_tags` VALUES (28, 'WebStorm', 5, 1);
INSERT INTO `tb_tags` VALUES (29, 'test', 6, 0);
INSERT INTO `tb_tags` VALUES (30, '前端', 6, 1);
INSERT INTO `tb_tags` VALUES (31, 'TG', 6, 0);
INSERT INTO `tb_tags` VALUES (32, '搜索', 6, 0);
INSERT INTO `tb_tags` VALUES (33, 'sql', 6, 0);
INSERT INTO `tb_tags` VALUES (34, 'Http', 6, 1);
INSERT INTO `tb_tags` VALUES (35, '排序', 6, 0);

-- ----------------------------
-- Table structure for tb_user
-- ----------------------------
DROP TABLE IF EXISTS `tb_user`;
CREATE TABLE `tb_user`  (
  `uid` int(11) NOT NULL AUTO_INCREMENT COMMENT '用户id',
  `username` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  `password` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL COMMENT '用户密码',
  `disable` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否被禁用',
  PRIMARY KEY (`uid`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 16 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_user
-- ----------------------------
INSERT INTO `tb_user` VALUES (1, 'qilihui', 'A19E5747D55E493822A05D5E88BA19758505250D8844670F', b'0');
INSERT INTO `tb_user` VALUES (2, 'giteeuser1', '727A2443675A93565A90BF80636B1BA12250215B43A7D699', b'0');
INSERT INTO `tb_user` VALUES (3, 'xiaoming', '659F17B11C62E1AE4882432752018F77DB1010B85E834530', b'0');
INSERT INTO `tb_user` VALUES (4, 'getjxx', 'D6EC37F6DF0C457296864368E30766C9F946F9AB7B987A69', b'0');
INSERT INTO `tb_user` VALUES (5, 'herin', '35314D76550E58D63CB3077BE2FF7B60705D544A6BA2AD27', b'0');
INSERT INTO `tb_user` VALUES (10, 'kilic', '685B0973C83414CC5F079A6F56594B75AD9211D949946316', b'0');
INSERT INTO `tb_user` VALUES (11, 'test123', '34057457297CB7ED5D26AF4636E635A0A10821D18913BC0B', b'0');
INSERT INTO `tb_user` VALUES (12, 'test124', 'B9C70D833E5100073503286BA4E924F16009B2072777B40B', b'0');
INSERT INTO `tb_user` VALUES (13, 'wdnmd', 'A4481BF6724F81C747652117937C19E4EB2CB4D81467BC8F', b'0');
INSERT INTO `tb_user` VALUES (14, 'testuser', 'E50B33C8764085C468C68A71618008E6536154C522B8FF54', b'0');
INSERT INTO `tb_user` VALUES (15, 'test12', '216064C7C953428F5A63D45942660D994E7E14FE5F385D60', b'0');

-- ----------------------------
-- Table structure for tb_user_info
-- ----------------------------
DROP TABLE IF EXISTS `tb_user_info`;
CREATE TABLE `tb_user_info`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `u_id` int(11) NOT NULL COMMENT '用户ID',
  `login_name` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '登录用户名，不可更改',
  `username` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '昵称，可更改',
  `sex` varchar(5) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT '1' COMMENT '性别 1-男 2-女',
  `birthday` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT '1970-01-01' COMMENT '生日',
  `email` varchar(255) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL COMMENT '邮箱',
  `area` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '所在地',
  `hobby` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '兴趣爱好',
  `comment` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '个人简介',
  `avatar` longtext CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL COMMENT '用户头像',
  `site` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '个人网站',
  `github` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT 'github',
  `weibo` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '微博链接',
  `university` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '毕业学校',
  `majority` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '所学专业',
  `company` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '公司名称',
  `job_title` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '公司职位',
  `register_date` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '注册时间',
  `isOpen` varchar(10) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT '1' COMMENT '是否公开信息，0-不公开，1-公开',
  `disable` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否被禁用',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 16 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_user_info
-- ----------------------------
INSERT INTO `tb_user_info` VALUES (1, 1, 'qilihui', 'qilihui', '1', '1970-01-01', '', '山东省-威海市', '码农', '', 'http://abiao.me:6688/image/2021/04/21/2FJaUwdeB.png', '/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAFA3PEY8MlBGQUZaVVBfeMiCeG5uePWvuZHI////////////////////////////////////////////////////2wBDAVVaWnhpeOuCguv/////////////////////////////////////////////////////////////////////////wAARCAH0AfQDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQE', NULL, NULL, '哈尔滨理工大学', '软件工程', '', '', '2021-03-18', '1', b'0');
INSERT INTO `tb_user_info` VALUES (2, 2, 'giteeuser1', 'giteeuser1', '0', '1970-01-01', NULL, NULL, NULL, NULL, 'http://abiao.me:6688/image/2021/04/21/1ajhodQpL.png', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2021-03-18', '1', b'0');
INSERT INTO `tb_user_info` VALUES (3, 3, 'xiaoming', 'xiaoming', '0', '1970-01-01', 'qlh3306@qq.com', NULL, NULL, NULL, 'https://avatars.githubusercontent.com/u/52077234?v=4', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2021-03-18', '1', b'0');
INSERT INTO `tb_user_info` VALUES (4, 4, 'getjxx', 'getjxx', '0', '1970-01-01', '1254673428@qq.com', NULL, NULL, NULL, 'https://portrait.gitee.com/uploads/avatars/user/2592/7777987_getjxx_1593960669.png', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2021-03-24', '1', b'0');
INSERT INTO `tb_user_info` VALUES (5, 5, 'herin', 'herin', '0', '1970-01-01', NULL, NULL, NULL, NULL, '/static/images/default_avatar.jpg', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2021-03-24', '1', b'0');
INSERT INTO `tb_user_info` VALUES (10, 10, 'kilic', 'kilic', '0', '1970-01-01', NULL, NULL, NULL, NULL, 'https://gitee.com/assets/no_portrait.png', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2021-03-24', '1', b'0');
INSERT INTO `tb_user_info` VALUES (11, 11, 'test123', 'test123', '0', '1970-01-01', NULL, NULL, NULL, NULL, 'http://abiao.me:6688/image/2021/04/28/hUObnjqo2.png', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2021-03-24', '1', b'0');
INSERT INTO `tb_user_info` VALUES (12, 12, 'test124', 'test124', '0', '1970-01-01', NULL, NULL, NULL, NULL, '/static/images/default_avatar.jpg', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2021-03-25', '1', b'0');
INSERT INTO `tb_user_info` VALUES (13, 13, 'wdnmd', 'dsh', '0', '1970-01-01', NULL, NULL, NULL, NULL, '/static/images/default_avatar.jpg', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2021-03-25', '1', b'0');
INSERT INTO `tb_user_info` VALUES (14, 14, 'testuser', 'testuser', '1', '1970-01-01', NULL, NULL, NULL, NULL, '/static/images/default_avatar.jpg', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2021-04-26', '1', b'0');
INSERT INTO `tb_user_info` VALUES (15, 15, 'test12', 'test12', '1', '1970-01-01', '', '', '', '', 'http://abiao.me:6688/image/2021/04/28/2FL7pVHYV.png', NULL, NULL, NULL, '', '', '', '', '2021-04-28', '1', b'0');

-- ----------------------------
-- Table structure for tb_user_rate
-- ----------------------------
DROP TABLE IF EXISTS `tb_user_rate`;
CREATE TABLE `tb_user_rate`  (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `user_id` int(11) NOT NULL COMMENT '用户id',
  `rate` int(11) NOT NULL DEFAULT 0 COMMENT '用户积分',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 16 CHARACTER SET = latin1 COLLATE = latin1_swedish_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of tb_user_rate
-- ----------------------------
INSERT INTO `tb_user_rate` VALUES (1, 1, 25);
INSERT INTO `tb_user_rate` VALUES (2, 2, 0);
INSERT INTO `tb_user_rate` VALUES (3, 3, 31);
INSERT INTO `tb_user_rate` VALUES (4, 4, 21);
INSERT INTO `tb_user_rate` VALUES (5, 5, 0);
INSERT INTO `tb_user_rate` VALUES (6, 7, 0);
INSERT INTO `tb_user_rate` VALUES (7, 9, 0);
INSERT INTO `tb_user_rate` VALUES (8, 6, 0);
INSERT INTO `tb_user_rate` VALUES (9, 8, 0);
INSERT INTO `tb_user_rate` VALUES (10, 10, 0);
INSERT INTO `tb_user_rate` VALUES (11, 11, 36);
INSERT INTO `tb_user_rate` VALUES (12, 12, 0);
INSERT INTO `tb_user_rate` VALUES (13, 13, 4);
INSERT INTO `tb_user_rate` VALUES (14, 14, 0);
INSERT INTO `tb_user_rate` VALUES (15, 15, 6);

SET FOREIGN_KEY_CHECKS = 1;
